# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Marzban Panel

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å Marzban Panel! –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ **"–°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫"** –∏ **"–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞"** —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Marzban, —Ç–∞–∫ –∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Xpert Panel.

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üîÑ –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫"
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/admin/usage/reset/{username}`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ò Marzban —Ç—Ä–∞—Ñ–∏–∫, –ò –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìä –ö–Ω–æ–ø–∫–∞ "–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞"  
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/admin/usage/{username}`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –û–ë–©–ï–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (Marzban + –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫)
- **–£—á–µ—Ç:** –í–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ `users_usage` –∞–¥–º–∏–Ω–∞

### üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/admin/usage/{username}/detailed`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –†–∞–∑–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞
- **–î–∞–Ω–Ω—ã–µ:** Marzban GB + External GB + –ª–∏–º–∏—Ç—ã

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Marzban UI

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
–ö–æ–≥–¥–∞ –≤—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫—É "–°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫" –≤ Marzban UI:

```javascript
// UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞:
POST /api/admin/usage/reset/admin1

// –°–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
1. crud.reset_admin_usage() - —Å–±—Ä–æ—Å Marzban —Ç—Ä–∞—Ñ–∏–∫–∞
2. traffic_service.reset_admin_external_traffic() - —Å–±—Ä–æ—Å –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π admin –æ–±—ä–µ–∫—Ç
```

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
–ö–æ–≥–¥–∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```javascript
// UI –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
GET /api/admin/usage/admin1

// –°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "marzban_usage_bytes": 1073741824,     // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ Marzban
  "external_traffic_gb": 2.456,             // –í–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤ –ì–ë
  "total_usage_bytes": 3640646656,        // –û–ë–©–ò–ô —Ç—Ä–∞—Ñ–∏–∫ –≤ –±–∞–π—Ç–∞—Ö
  "traffic_limit_bytes": 10737418240,       // –õ–∏–º–∏—Ç –∏–∑ –∞–¥–º–∏–Ω–∞
  "limit_check": {                           // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
    "within_limit": false,
    "percentage_used": 33.9
  }
}
```

### 3. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:

```javascript
// UI –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
GET /api/admin/usage/admin1/detailed

// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é —Ä–∞–∑–±–∏–≤–∫—É:
{
  "username": "admin1",
  "marzban_usage_bytes": 1073741824,     // 1.0 GB —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ
  "external_traffic": {                       // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
    "external_traffic_gb": 2.456,           // 2.456 GB –≤–Ω–µ—à–Ω–µ–≥–æ
    "external_unique_users": 15,              // 15 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    "external_unique_servers": 8               // 8 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
  },
  "total_usage_bytes": 3640646656,        // 3.456 GB –≤—Å–µ–≥–æ
  "traffic_limit_bytes": 10737418240,       // 10 GB –ª–∏–º–∏—Ç
  "limit_check": {
    "within_limit": false,                    // –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
    "percentage_used": 34.6                   // 34.6% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
  }
}
```

## üîó –ù–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| **–°–±—Ä–æ—Å –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞** | `POST /api/admin/usage/reset/{username}` | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç Marzban + –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ |
| **–û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | `GET /api/admin/usage/{username}` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | `GET /api/admin/usage/{username}/detailed` | –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞ |

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| **–°–±—Ä–æ—Å –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞** | `POST /api/admin/external-traffic/reset/{username}` | –¢–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ** | `GET /api/admin/external-traffic/stats/{username}` | –¢–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –ª–∏–º–∏—Ç–æ–º 10GB

```bash
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ª–∏–º–∏—Ç:
# traffic_limit = 10737418240  # 10GB –≤ –±–∞–π—Ç–∞—Ö

# –ö–ª–∏–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã:
# - 2.456 GB —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ VPN
# - 1.000 GB —á–µ—Ä–µ–∑ Marzban

# UI –ø–æ–∫–∞–∂–µ—Ç:
# Total: 3.456 GB / 10.000 GB (34.6% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ)
# Status: –õ–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω!
```

### –ü—Ä–∏–º–µ—Ä 2: –°–±—Ä–æ—Å —Ç—Ä–∞—Ñ–∏–∫–∞

```bash
# –ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É "–°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫"

# –ó–∞–ø—Ä–æ—Å:
curl -X POST "https://your-domain.com/api/admin/usage/reset/admin1" \
  -H "Authorization: Bearer YOUR_TOKEN"

# –û—Ç–≤–µ—Ç:
{
  "username": "admin1",
  "users_usage": 0,                          // Marzban —Ç—Ä–∞—Ñ–∏–∫ —Å–±—Ä–æ—à–µ–Ω
  "traffic_limit": 10737418240,
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –í—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞
# - –°—á–µ—Ç—á–∏–∫–∏ –æ–±–Ω—É–ª–µ–Ω—ã
# - UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

```bash
# UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã:
if (total_usage > traffic_limit) {
  showWarning("–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω!");
  disableButton("–ù–æ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è");
}
```

## üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI

### –¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

```css
.traffic-status {
  padding: 8px 12px;
  border-radius: 4px;
  font-weight: bold;
}

.traffic-status.ok {
  background: #10b981;
  color: white;
}

.traffic-status.warning {
  background: #f59e0b;
  color: white;
}

.traffic-status.danger {
  background: #ef4444;
  color: white;
}
```

### JavaScript –ø—Ä–∏–º–µ—Ä—ã

```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
async function fetchAdminUsage(username) {
  const response = await fetch(`/api/admin/usage/${username}`);
  const data = await response.json();
  
  return {
    totalUsageGB: (data.total_usage_bytes / (1024**3)).toFixed(2),
    limitGB: (data.traffic_limit_bytes / (1024**3)).toFixed(2),
    percentageUsed: data.limit_check?.percentage_used || 0,
    withinLimit: data.limit_check?.within_limit || true,
    marzbanUsageGB: (data.marzban_usage_bytes / (1024**3)).toFixed(2),
    externalTrafficGB: data.external_traffic?.external_traffic_gb || 0
  };
}

// –°–±—Ä–æ—Å —Ç—Ä–∞—Ñ–∏–∫–∞
async function resetTraffic(username) {
  const response = await fetch(`/api/admin/usage/reset/${username}`, {
    method: 'POST'
  });
  
  if (response.ok) {
    showNotification('–¢—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω', 'success');
    // –û–±–Ω–æ–≤–∏—Ç—å UI
    await fetchAdminUsage(username);
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
function updateTrafficUI(usage) {
  const progressBar = document.getElementById('traffic-progress');
  const statusElement = document.getElementById('traffic-status');
  
  progressBar.style.width = `${usage.percentageUsed}%`;
  statusElement.textContent = `${usage.totalUsageGB}GB / ${usage.limitGB}GB`;
  
  statusElement.className = `traffic-status ${
    usage.withinLimit ? 'ok' : 
    usage.percentageUsed > 80 ? 'danger' : 'warning'
  }`;
}
```

## üîÑ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –ó–∞–ø–∏—Å—å —Ç—Ä–∞—Ñ–∏–∫–∞
```
–ö–ª–∏–µ–Ω—Ç ‚Üí –ü–æ–¥–ø–∏—Å–∫–∞ ‚Üí Middleware ‚Üí Traffic Service ‚Üí SQLite
    ‚Üì
Webhook ‚Üí API ‚Üí Traffic Service ‚Üí SQLite ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

### 2. –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```
UI ‚Üí API ‚Üí Traffic Service ‚Üí SQLite ‚Üí –ê–≥—Ä–µ–≥–∞—Ü–∏—è
    ‚Üì
UI ‚Üí API ‚Üí Admin Router ‚Üí Traffic Service + Marzban ‚Üí –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

### 3. –°–±—Ä–æ—Å —Ç—Ä–∞—Ñ–∏–∫–∞
```
UI ‚Üí API ‚Üí Admin Router ‚Üí 
  ‚îú‚îÄ‚Üí crud.reset_admin_usage() (Marzban)
  ‚îî‚îÄ‚Üí traffic_service.reset_admin_external_traffic() (Xpert)
```

## üõ†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env

```env
# –í–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
XPERT_TRAFFIC_TRACKING_ENABLED=True

# –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
XPERT_TRAFFIC_DB_PATH=data/traffic_stats.db

# –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (0 = –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ)
XPERT_TRAFFIC_RETENTION_DAYS=0

# –î–æ–º–µ–Ω –¥–ª—è webhook
XPERT_DOMAIN=your-domain.com
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE traffic_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_token TEXT NOT NULL,
    config_server TEXT NOT NULL,
    config_port INTEGER NOT NULL,
    protocol TEXT NOT NULL,
    bytes_uploaded INTEGER DEFAULT 0,
    bytes_downloaded INTEGER DEFAULT 0,
    date_collected DATE NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_token, config_server, config_port, date_collected)
);
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –≤—Å–µ —Ç–µ –∂–µ –∫–Ω–æ–ø–∫–∏ –≤ Marzban UI
- **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - —Å–±—Ä–æ—Å –∏ –ª–∏–º–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏—Ö vs –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
- **–õ–∏–º–∏—Ç—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- **–í–µ–±—Ö—É–∫–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ü–æ–¥–ø–∏—Å–∫–∏** - —Å tracking –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

### ‚úÖ –î–ª—è —Å–∏—Å—Ç–µ–º—ã
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - SQLite —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Marzban
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

## üö® –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `XPERT_TRAFFIC_TRACKING_ENABLED=True`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ webhook
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Xpert Panel
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: `ls -la data/traffic_stats.db`

### –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ (–Ω—É–∂–µ–Ω sudo)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `curl /api/admin/usage/admin1`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ traffic_service –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ admin.py

### –ï—Å–ª–∏ –ª–∏–º–∏—Ç—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –∞–¥–º–∏–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `traffic_limit`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –±–∞–π—Ç ‚Üí –ì–ë
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `total_usage_bytes`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `limit_check` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–¢–µ–ø–µ—Ä—å Marzban Panel –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ VPN —Å–µ—Ä–≤–µ—Ä—ã!**

- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫" –æ—á–∏—â–∞–µ—Ç –í–ï–°–¨ —Ç—Ä–∞—Ñ–∏–∫
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞" —É—á–∏—Ç—ã–≤–∞–µ—Ç –í–ï–°–¨ —Ç—Ä–∞—Ñ–∏–∫  
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–±–∏–≤–∫—É Marzban + –í–Ω–µ—à–Ω–∏–π
- ‚úÖ –í–µ–±—Ö—É–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ —á—É–∂–∏–µ —Å–µ—Ä–≤–µ—Ä–∞!** üöÄ
