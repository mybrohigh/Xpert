# üîß –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É 500 API

## üö® **–ü—Ä–æ–±–ª–µ–º–∞:**
```
api/admin:1 Failed to load resource: the server responded with a status of 500 ()
[API ERR] GET /admin: 500
[API ERR] POST /api/admin/token: 500
```

## üéØ **–ü—Ä–∏—á–∏–Ω–∞:**
Xpert Panel —Ç—Ä–µ–±—É–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã. –ë–µ–∑ –Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å SSL**

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
```bash
cd /opt/xpert_panel
mkdir -p ssl
openssl req -x509 -newkey rsa:4096 -keyout ssl/key.pem -out ssl/cert.pem -days 365 -nodes \
  -subj "/C=US/ST=State/L=City/O=Organization/CN=localhost"
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å SSL:
```bash
cd /opt/xpert_panel
export UVICORN_SSL_CERTFILE=/opt/xpert_panel/ssl/cert.pem
export UVICORN_SSL_KEYFILE=/opt/xpert_panel/ssl/key.pem
python3 main.py
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ UI:
```
https://your-domain.com
```
*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.*

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å**

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–±–µ–∑ SSL):
```bash
cd /opt/xpert_panel
python3 main.py
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å:
```bash
ssh -L 8000:localhost:8000 user@server
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```
http://localhost:8000
```

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**

### 1. –ù–∞–π–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
```bash
find /etc -name "*.pem" -o -name "*.crt" 2>/dev/null | grep -E "(cert|key|ssl)"
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö:
```bash
export UVICORN_SSL_CERTFILE=/path/to/your/cert.pem
export UVICORN_SSL_KEYFILE=/path/to/your/key.pem
python3 main.py
```

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Let's Encrypt**

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot:
```bash
sudo apt update
sudo apt install certbot python3-certbot-nginx
```

### 2. –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
```bash
sudo certbot --nginx -d your-domain.com
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏:
```bash
export UVICORN_SSL_CERTFILE=/etc/letsencrypt/live/your-domain.com/fullchain.pem
export UVICORN_SSL_KEYFILE=/etc/letsencrypt/live/your-domain.com/privkey.pem
python3 main.py
```

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API –æ—Ç–≤–µ—á–∞–µ—Ç:
```bash
curl -k https://your-domain.com/api/admin/token \
  -X POST \
  -d "username=admin&password=admin"
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI:
```
https://your-domain.com
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Traffic Manager:
```
https://your-domain.com/#/traffic/
```

## üéØ **–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç**

### –î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ SSL:
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
cd /opt/xpert_panel
python3 main.py

# 2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ API
curl http://localhost:8000/api/admin/token \
  -X POST \
  -d "username=admin&password=admin"

# 3. –ï—Å–ª–∏ API –æ—Ç–≤–µ—á–∞–µ—Ç, –æ—Ç–∫—Ä–æ–π—Ç–µ UI –ª–æ–∫–∞–ª—å–Ω–æ
http://localhost:8000
```

## üì± **–î–æ—Å—Ç—É–ø –∫ Traffic Manager –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:

### üåê **–ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:**
```
https://your-domain.com/#/traffic/
```

### üì± **–ß–µ—Ä–µ–∑ –º–µ–Ω—é:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://your-domain.com`
2. –ù–∞–∂–º–∏—Ç–µ ‚ò∞ (—Ç—Ä–∏ –ø–æ–ª–æ—Å–∫–∏)
3. –í—ã–±–µ—Ä–∏—Ç–µ "Traffic Manager"

### üîó **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```
GET  /api/xpert/marzban-traffic-stats
GET  /api/xpert/traffic-stats/database/info
POST /api/xpert/traffic-webhook
```

## ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è**

### üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ Nginx

### üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- SSL –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP/2 –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Nginx

### üìä **–¢—Ä–∞—Ñ–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ 500, Traffic Manager –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
- üìà –ì–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞
- üóÑÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- üë§ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üéØ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–æ–º

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ —Ä–µ—à–µ–Ω–∏–π:
- ‚úÖ API –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫ 500
- ‚úÖ UI –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Traffic Manager –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–µ–π —Å—Ä–µ–¥—ã –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º!** üöÄ
