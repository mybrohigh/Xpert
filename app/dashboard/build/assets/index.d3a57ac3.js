import{i as fr,B as Kn,a as ei,b as ti,j as gn,d as le,U as kr,z as ri,r as ni,f as ii,Q as oi,e as si,$ as ai,u as dt,c as L,g as li,C as ci,h as ir,W as fn,k as di,l as ui,m as te,n as r,o as U,p as e,H as I,T as u,q as hi,s as or,t as pi,A as bn,v as je,w as p,M as Le,x as De,y as Ue,D as Me,E as Te,F as Ee,V as J,G as O,I as H,J as X,S as Re,K as xn,N as Ht,L as $t,O as Vt,P as Gt,R as Yt,X as qt,Y as Zt,Z as Qe,_ as we,a0 as Qt,a1 as me,a2 as W,a3 as Ke,a4 as Xe,a5 as wt,a6 as mi,a7 as D,a8 as yn,a9 as sr,aa as gi,ab as fi,ac as kt,ad as Sn,ae as bi,af as Tt,ag as _n,ah as ze,ai as Je,aj as se,ak as Nt,al as It,am as xi,an as br,ao as ut,ap as yi,aq as ht,ar as Si,as as wn,at as kn,au as Ut,av as Xt,aw as _i,ax as Jt,ay as wi,az as Cn,aA as vn,aB as In,aC as Be,aD as ki,aE as Ci,aF as vi,aG as Ii,aH as zi,aI as Li,aJ as Cr,aK as zn,aL as Ln,aM as Di,aN as pt,aO as Oe,aP as Ui,aQ as Mi,aR as xr,aS as Ti,aT as Ei,aU as Kt,aV as Ai,aW as Ni,aX as Ri,aY as Fi,aZ as Rt,a_ as Dn,a$ as Ft,b0 as vr,b1 as Wi,b2 as yt,b3 as St,b4 as yr,b5 as _t,b6 as Pi,b7 as et,b8 as tt,b9 as rt,ba as nt,bb as it,bc as ot,bd as Nr,be as Bi,bf as er,bg as xt,bh as Ir,bi as Oi,bj as ji,bk as Un,bl as Hi,bm as Et,bn as tr,bo as Mn,bp as $i,bq as Vi,br as Tn,bs as gt,bt as Gi,bu as Yi,bv as qi,bw as zr,bx as cr,by as Rr,bz as En,bA as Zi,bB as Qi,bC as Fr,bD as Xi,bE as Wr,bF as An,bG as Ji,bH as Nn,bI as Ki,bJ as eo,bK as Rn,bL as to,bM as ro,bN as Fn,bO as Wn,bP as Pn,bQ as Ce,bR as no,bS as Bn,bT as Mt,bU as io,bV as oo,bW as so,bX as ao,bY as lo,bZ as On,b_ as co,b$ as Pr,c0 as uo,c1 as ho,c2 as po,c3 as mo,c4 as go,c5 as jn,c6 as fo,c7 as bo,c8 as xo,c9 as yo,ca as So,cb as _o,cc as wo,cd as ko,ce as Co,cf as vo,cg as Io,ch as zo,ci as Lo,cj as Do}from"./vendor.d5d3537c.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();fr.use(Kn).use(ei).use(ti).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:gn(["/","statics/locales/{{lng}}.json"])}},function(t,n){le.locale(fr.language)});fr.on("languageChanged",t=>{le.locale(t)});kr("zh-cn",ri);kr("ru",ni);kr("fa",ii);const Sr=new oi,Hn=t=>{const n=document.querySelector('meta[name="theme-color"]');n==null||n.setAttribute("content",t=="dark"?"#1A202C":"#3B81F6")},Uo=si({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{700:"#040609",750:"#040609"}},styles:{global:{":root":{"--lg-edge":"rgba(255,255,255,0.22)","--lg-edge-soft":"rgba(191,219,254,0.18)"},body:{_dark:{bg:"#040609",backgroundImage:"radial-gradient(1200px 500px at 10% -20%, rgba(77,99,255,0.18), transparent), radial-gradient(1000px 450px at 90% -10%, rgba(34,211,238,0.12), transparent)",backgroundAttachment:"fixed"}},".chakra-card, .chakra-modal__content, .chakra-drawer__content, .chakra-menu__menu-list, .chakra-alert":{_dark:{position:"relative",overflow:"hidden",isolation:"isolate",borderColor:"rgba(191, 219, 254, 0.28) !important",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.18), inset 0 -1px 0 rgba(148,163,184,0.14), 0 14px 34px rgba(0,0,0,0.28)"}},".chakra-card::before, .chakra-modal__content::before, .chakra-drawer__content::before, .chakra-menu__menu-list::before, .chakra-alert::before":{content:'""',position:"absolute",inset:"0",pointerEvents:"none",opacity:0,transition:"opacity .25s ease"},".chakra-card::after, .chakra-modal__content::after, .chakra-drawer__content::after, .chakra-menu__menu-list::after, .chakra-alert::after":{content:'""',position:"absolute",inset:"0",pointerEvents:"none",opacity:0,transition:"opacity .25s ease"},".chakra-ui-dark .chakra-card::before, .chakra-ui-dark .chakra-modal__content::before, .chakra-ui-dark .chakra-drawer__content::before, .chakra-ui-dark .chakra-menu__menu-list::before, .chakra-ui-dark .chakra-alert::before":{opacity:1,background:"linear-gradient(145deg, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.02) 38%, rgba(191,219,254,0.10) 100%)"},".chakra-ui-dark .chakra-card::after, .chakra-ui-dark .chakra-modal__content::after, .chakra-ui-dark .chakra-drawer__content::after, .chakra-ui-dark .chakra-menu__menu-list::after, .chakra-ui-dark .chakra-alert::after":{opacity:1,boxShadow:"inset 1px 1px 0 rgba(255,255,255,0.22), inset -1px -1px 0 rgba(148,163,184,0.18), inset 0 0 8px rgba(255,255,255,0.14)"},".chakra-button, .chakra-input, .chakra-select, .chakra-textarea":{_dark:{position:"relative",overflow:"hidden",isolation:"isolate",borderColor:"rgba(191, 219, 254, 0.28) !important",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.14), inset 0 -1px 0 rgba(148,163,184,0.12)"}},".chakra-button::after, .chakra-input::after, .chakra-select::after, .chakra-textarea::after":{content:'""',position:"absolute",inset:"0",pointerEvents:"none",opacity:0,transition:"opacity .2s ease"},".chakra-ui-dark .chakra-input, .chakra-ui-dark .chakra-textarea, .chakra-ui-dark .chakra-select":{bg:"rgba(19, 24, 45, 0.5) !important",borderColor:"rgba(148, 163, 184, 0.5) !important",color:"#dbe7ff"},".chakra-ui-dark .chakra-numberinput__field":{bg:"rgba(19, 24, 45, 0.5) !important",borderColor:"rgba(148, 163, 184, 0.5) !important",color:"#dbe7ff"},".chakra-ui-dark .chakra-accordion__item":{bg:"rgba(13, 18, 36, 0.46)",border:"1px solid rgba(191, 219, 254, 0.2)",borderRadius:"10px",backdropFilter:"blur(14px)",WebkitBackdropFilter:"blur(14px)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), inset 0 -1px 0 rgba(148,163,184,0.1), 0 10px 22px rgba(0,0,0,0.24)"},".chakra-ui-dark .chakra-accordion__button":{borderRadius:"10px"},".chakra-ui-dark .chakra-accordion__panel":{borderTop:"1px solid rgba(191, 219, 254, 0.14)"},".chakra-ui-dark .chakra-button::after, .chakra-ui-dark .chakra-input::after, .chakra-ui-dark .chakra-select::after, .chakra-ui-dark .chakra-textarea::after":{opacity:1,boxShadow:"inset 1px 1px 0 rgba(255,255,255,0.14), inset -1px -1px 0 rgba(148,163,184,0.12)"},".chakra-ui-dark .chakra-toast .chakra-alert::before, .chakra-ui-dark .chakra-toast .chakra-alert::after":{opacity:0},".chakra-ui-dark .chakra-toast .chakra-alert":{border:"1px solid rgba(148, 163, 184, 0.4) !important",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.1), 0 14px 34px rgba(0,0,0,0.36)",backdropFilter:"blur(14px)",WebkitBackdropFilter:"blur(14px)"},".chakra-ui-dark .chakra-toast .chakra-alert[data-status='success']":{bg:"rgba(16, 185, 129, 0.18)",borderColor:"rgba(16, 185, 129, 0.55) !important",color:"#d1fae5"},".chakra-ui-dark .chakra-toast .chakra-alert[data-status='error']":{bg:"rgba(244, 63, 94, 0.2)",borderColor:"rgba(251, 113, 133, 0.55) !important",color:"#ffe4e6"},".chakra-ui-dark .chakra-toast .chakra-alert[data-status='warning']":{bg:"rgba(245, 158, 11, 0.22)",borderColor:"rgba(251, 191, 36, 0.55) !important",color:"#ffedd5"},".chakra-ui-dark .chakra-toast .chakra-alert[data-status='info'], .chakra-ui-dark .chakra-toast .chakra-alert[data-status='loading']":{bg:"rgba(59, 130, 246, 0.22)",borderColor:"rgba(96, 165, 250, 0.55) !important",color:"#dbeafe"},".chakra-ui-dark .chakra-toast .chakra-alert .chakra-alert__icon, .chakra-ui-dark .chakra-toast .chakra-alert .chakra-alert__title, .chakra-ui-dark .chakra-toast .chakra-alert .chakra-alert__desc":{color:"inherit"},".chakra-ui-dark .chakra-toast .chakra-alert .chakra-close-button":{color:"inherit",opacity:.9},".chakra-ui-dark .chakra-toast .chakra-alert .chakra-close-button:hover":{bg:"rgba(15, 23, 42, 0.35)",opacity:1},".xpert-page-shift":{transition:"padding .25s ease"},"@media (min-width: 48em)":{".xpert-side-open main":{paddingRight:"calc(var(--xpert-side-menu-width, 240px) + var(--xpert-side-menu-right, 10px) + var(--xpert-side-menu-content-gap, 16px))",transition:"padding-right .25s ease"},".xpert-side-open .xpert-page-shift":{transform:"none"}}}},components:{Button:{baseStyle:{_dark:{bg:"rgba(23, 28, 52, 0.42)",color:"#dbe7ff",border:"1px solid rgba(191, 219, 254, 0.3)",backdropFilter:"blur(14px)",WebkitBackdropFilter:"blur(14px)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.2), inset 0 -1px 0 rgba(148,163,184,0.12), 0 10px 26px rgba(0,0,0,0.28)",transition:"all .2s ease",_hover:{bg:"rgba(30, 37, 67, 0.52)",borderColor:"rgba(96, 165, 250, 0.42)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.24), 0 0 14px rgba(77,99,255,0.24)"},_active:{bg:"rgba(36, 43, 78, 0.58)"}}}},Card:{baseStyle:{container:{_dark:{bg:"rgba(15, 20, 40, 0.46)",border:"1px solid rgba(191, 219, 254, 0.28)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.2), inset 0 -1px 0 rgba(148,163,184,0.12), 0 14px 34px rgba(0,0,0,0.3)"}}}},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm",bg:"var(--chakra-alert-bg)",color:"var(--chakra-alert-fg)",_dark:{border:"1px solid rgba(191, 219, 254, 0.28)",backdropFilter:"blur(14px)",WebkitBackdropFilter:"blur(14px)"}}}},Menu:{baseStyle:{list:{_dark:{bg:"rgba(11, 16, 31, 0.74)",borderColor:"rgba(191, 219, 254, 0.3)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.2), inset 0 -1px 0 rgba(148,163,184,0.12), 0 14px 34px rgba(0,0,0,0.3)"}},item:{_dark:{bg:"transparent",_hover:{bg:"rgba(77, 99, 255, 0.18)"},_focus:{bg:"rgba(77, 99, 255, 0.2)"}}}}},Modal:{baseStyle:{dialog:{_dark:{bg:"rgba(11, 16, 31, 0.74)",border:"1px solid rgba(191, 219, 254, 0.3)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"}}}},Drawer:{baseStyle:{dialog:{_dark:{bg:"rgba(11, 16, 31, 0.74)",borderLeft:"1px solid rgba(191, 219, 254, 0.3)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"}}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px",bg:"rgba(19, 24, 45, 0.5)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",bg:"rgba(19, 24, 45, 0.5)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Textarea:{baseStyle:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",bg:"rgba(19, 24, 45, 0.5)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}},NumberInput:{baseStyle:{field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",bg:"rgba(19, 24, 45, 0.5)",color:"#dbe7ff",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",_placeholder:{color:"gray.500"}}},stepperGroup:{_dark:{bg:"rgba(19, 24, 45, 0.35)",borderColor:"rgba(148, 163, 184, 0.45)"}},stepper:{_dark:{borderColor:"rgba(148, 163, 184, 0.35)",color:"#dbe7ff",_hover:{bg:"rgba(77, 99, 255, 0.18)"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"rgba(37, 55, 112, 0.34)",boxShadow:"none"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const rr=()=>localStorage.getItem("token"),Mo=t=>{localStorage.setItem("token",t)},To=()=>{localStorage.removeItem("token")},Eo=ai.create({baseURL:"/api/"}),Ao=t=>{if(!t)return t;const n={...t};return n.Authorization&&(n.Authorization="REDACTED"),n.authorization&&(n.authorization="REDACTED"),n},No=(t,n={})=>{rr()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${rr()}`});const s=((n==null?void 0:n.method)||"GET").toString().toUpperCase();return console.log("[API]",s,t,{...n,headers:Ao(n.headers)}),Eo(t,n).then(a=>(console.log("[API OK]",s,t,a),a)).catch(a=>{throw console.error("[API ERR]",s,t,a),a})},R=No,Ro=async()=>await R("/admin"),Lr=()=>{const{data:t,isError:n,isLoading:i,isSuccess:s,error:a}=dt({queryFn:()=>Ro()});return{userData:t||{discord_webook:"",is_sudo:!1,telegram_id:"",username:""},getUserIsPending:i,getUserIsSuccess:s,getUserIsError:n,getUserError:a}};function Ie(t,n=2,i=!1){if(!+t)return"0 B";const s=1024,a=n<0?0:n,o=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(t)/Math.log(s));return i?[parseFloat((t/Math.pow(s,l)).toFixed(a)),o[l]]:`${parseFloat((t/Math.pow(s,l)).toFixed(a))} ${o[l]}`}const dr=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Fo=1800,Wo=t=>{if(t==null)return null;if(typeof t=="number")return Number.isFinite(t)?t>1e12?Math.floor(t/1e3):t>1e9?Math.floor(t):null:null;const n=String(t).trim();if(!n)return null;const i=Number(n);if(Number.isFinite(i)){if(i>1e12)return Math.floor(i/1e3);if(i>1e9)return Math.floor(i)}let s=new Date(n).getTime();return Number.isFinite(s)||(s=new Date(`${n}Z`).getTime()),Number.isFinite(s)?Math.floor(s/1e3):null},Po=L(li,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),Bo=L(ci,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),Oo=L(ir,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),jo=L(fn,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),Ho=L(di,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),$o=L(ui,{baseStyle:{w:{base:4,md:5},h:{base:4,md:5},position:"relative",zIndex:"2",color:"#4d63ff",filter:"drop-shadow(0 0 4px rgba(77,99,255,0.72)) drop-shadow(0 0 10px rgba(59,130,246,0.36))"}}),bt=({title:t,content:n,icon:i})=>r(hi,{p:{base:3,md:4},borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{bg:"rgba(13, 18, 36, 0.56)",borderColor:"rgba(148, 163, 184, 0.24)",backdropFilter:"blur(14px)",WebkitBackdropFilter:"blur(14px)",boxShadow:"inset 0 1px 0 rgba(148,163,184,0.12), inset 0 -1px 0 rgba(15,23,42,0.28), 0 12px 28px rgba(0,0,0,0.3)"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",minH:{base:"96px",md:"86px"},alignSelf:"stretch",display:"flex",justifyContent:"space-between",flexDirection:"row",alignItems:"center",position:"relative",overflow:"hidden",children:[r(I,{alignItems:"center",columnGap:{base:3,md:3},flex:"1",children:[e(U,{p:{base:"1.5",md:"1.5"},position:"relative",color:"#4d63ff",_before:{content:'""',position:"absolute",top:0,left:0,bg:"rgba(77, 99, 255, 0.16)",display:"block",w:"full",h:"full",borderRadius:"5px",border:"1px solid rgba(96, 165, 250, 0.4)",opacity:".9",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"rgba(77, 99, 255, 0.08)",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",filter:"blur(1px)",opacity:".8",z:"1"},children:i}),e(u,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:{base:"2xs",md:"xs"},textAlign:"left",children:t})]}),e(U,{fontSize:{base:"sm",md:"2xl"},fontWeight:"semibold",mt:0,lineHeight:"1.1",textAlign:"right",w:"auto",minW:{base:"40%",md:"34%"},children:n})]}),_r="statistics-query-key",Vo=t=>{var ae,pe,de,ke,Ae,S,q,re,xe;const{userData:n,getUserIsSuccess:i}=Lr(),{version:s,filters:a}=V(),o=i?!!(n!=null&&n.is_sudo):!1,l=o?a==null?void 0:a.admin:"",b=!!l&&l!=="__all__",y=async ne=>{const[ie,ue,he]=await Promise.all([R("/users",{query:{...ne,limit:1}}),R("/users",{query:{...ne,status:"active",limit:1}}),R("/users",{query:{...ne,limit:5e3,sort:"-created_at"}})]),Ve=Array.isArray(he==null?void 0:he.users)?he.users.reduce((_,j)=>_+Number((j==null?void 0:j.used_traffic)||0),0):0,Fe=Array.isArray(he==null?void 0:he.users)?he.users.filter(_=>{if(String((_==null?void 0:_.status)||"").toLowerCase()==="connected")return!0;const ee=Wo(_==null?void 0:_.online_at);return ee?Math.floor(Date.now()/1e3)-ee<=Fo:!1}).length:0;return{users_active:Number((ue==null?void 0:ue.total)||0),total_user:Number((ie==null?void 0:ie.total)||0),users_online:Number(Fe||0),usage:Ve}},{data:f,error:w}=dt({queryKey:_r,queryFn:()=>R("/system"),refetchInterval:3e4,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1,staleTime:2e4,retry:3,retryDelay:1e3,onSuccess:({version:ne})=>{s!==ne&&V.setState({version:ne})},onError:ne=>{console.error("Statistics query failed:",ne)}}),{data:x}=dt({queryKey:["statistics-admin-scope-all",o?"__all__":"__self__",(n==null?void 0:n.username)||""],enabled:!o||!b,staleTime:6e4,refetchInterval:1e4,refetchIntervalInBackground:!1,refetchOnWindowFocus:!0,keepPreviousData:!1,queryFn:()=>y({})}),{data:c}=dt({queryKey:["statistics-admin-scope-selected",l||"__none__",(n==null?void 0:n.username)||""],enabled:o&&b,staleTime:6e4,refetchInterval:1e4,refetchIntervalInBackground:!1,refetchOnWindowFocus:!0,keepPreviousData:!1,queryFn:()=>y({admin:l})}),{data:g}=dt({queryKey:["statistics-admin-limits",l||"__all__"],enabled:o&&b,staleTime:6e4,refetchOnWindowFocus:!1,queryFn:async()=>(await R("/admins")||[]).find(ie=>(ie==null?void 0:ie.username)===l)||null}),{data:z}=dt({queryKey:["statistics-today-traffic",o?l||"__all__":"__self__"],staleTime:6e4,refetchOnWindowFocus:!1,queryFn:async()=>{const ie={start:le().utc().startOf("day").format("YYYY-MM-DDTHH:00:00")};o&&b&&(ie.admin=l);const ue=await R("/users/usage",{query:ie});return Array.isArray(ue==null?void 0:ue.usages)?ue.usages.reduce((Ve,Fe)=>Ve+Number((Fe==null?void 0:Fe.used_traffic)||0),0):0}}),T=o&&b?c:x,d=!!T?{users_active:Number((T==null?void 0:T.users_active)||0),total_user:Number((T==null?void 0:T.total_user)||0),users_online:Number((T==null?void 0:T.users_online)||0),data_usage:Number((T==null?void 0:T.usage)||0)}:null,h=(pe=(ae=d==null?void 0:d.users_active)!=null?ae:f==null?void 0:f.users_active)!=null?pe:0,G=(ke=(de=d==null?void 0:d.total_user)!=null?de:f==null?void 0:f.total_user)!=null?ke:0,E=Number(d==null?void 0:d.users_online),F=[Number(f==null?void 0:f.users_online),Number(f==null?void 0:f.online_users),Number(f==null?void 0:f.users_connected)].filter(ne=>Number.isFinite(ne)&&ne>=0),M=Number.isFinite(E)&&E>=0?E:F.length?Math.max(...F):0,P=Number((Ae=d==null?void 0:d.data_usage)!=null?Ae:0),v=Number((S=g==null?void 0:g.traffic_limit)!=null?S:0),B=Number((re=(q=d==null?void 0:d.data_usage)!=null?q:n==null?void 0:n.users_usage)!=null?re:0),Y=Number((xe=n==null?void 0:n.traffic_limit)!=null?xe:0),ce=Number((f==null?void 0:f.incoming_bandwidth)||0)+Number((f==null?void 0:f.outgoing_bandwidth)||0),A=o?b?P:ce:B,Q=o?b?v:0:Y,oe=Number(z||0),{t:$}=te();return r(U,{display:"grid",gridTemplateColumns:{base:"repeat(2, minmax(0, 1fr))",lg:"repeat(3, minmax(0, 1fr))"},gap:{base:2,md:4},w:"full",sx:{direction:"ltr"},...t,children:[e(U,{order:{base:1,lg:1},children:e(bt,{title:$("activeUsers"),content:(f||d)&&r(I,{alignItems:"flex-end",spacing:1,flexWrap:"wrap",justifyContent:"flex-end",children:[e(u,{children:dr(h)}),r(u,{fontWeight:"normal",fontSize:{base:"xs",md:"lg"},as:"span",display:"inline-block",pb:{base:"2px",md:"5px"},children:["/ ",dr(G)]})]}),icon:e(Po,{})})}),e(U,{order:{base:2,lg:4},children:e(bt,{title:$("onlineNow"),content:(f||d)&&dr(M),icon:e(jo,{})})}),e(U,{order:{base:3,lg:2},children:e(bt,{title:$("dataUsage"),content:(f||d)&&(Q>0?r(I,{alignItems:"flex-end",spacing:1,flexWrap:"wrap",justifyContent:"flex-end",children:[e(u,{children:Ie(A)}),r(u,{fontWeight:"normal",fontSize:{base:"xs",md:"lg"},as:"span",display:"inline-block",pb:{base:"2px",md:"5px"},children:["/ ",Ie(Q)]})]}):Ie(A)),icon:e(Bo,{})})}),e(U,{order:{base:4,lg:5},children:e(bt,{title:$("todayUsage"),content:(f||z)&&Ie(oe),icon:e(Ho,{})})}),e(U,{order:{base:5,lg:3},children:e(bt,{title:$("memoryUsage"),content:f&&r(I,{alignItems:"flex-end",spacing:1,flexWrap:"wrap",justifyContent:"flex-end",children:[e(u,{children:Ie(f.mem_used,1,!0)[0]}),r(u,{fontWeight:"normal",fontSize:{base:"xs",md:"lg"},as:"span",display:"inline-block",pb:{base:"2px",md:"5px"},children:[Ie(f.mem_used,1,!0)[1]," /"," ",Ie(f.mem_total,1)]})]}),icon:e(Oo,{})})}),e(U,{order:{base:6,lg:6},children:e(bt,{title:$("cpuUsage"),content:f?`${Math.round(Number(f.cpu_usage||0))}%`:"-",icon:e($o,{})})})]})},$n="marzban-num-users-per-page",Br=10,Go=()=>{const t=localStorage.getItem($n)||Br.toString();return parseInt(t)||Br},Yo=t=>localStorage.setItem($n,t),qo=t=>{for(const n in t)t[n]||delete t[n];return V.setState({loading:!0}),R("/users",{query:t}).then(n=>(V.setState({users:n}),n)).catch(n=>(console.error("Failed to fetch users:",n),V.setState({users:{users:[],total:0}}),{users:[],total:0})).finally(()=>{V.setState({loading:!1})})},Zo=()=>R("/inbounds").then(t=>{V.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{V.setState({loading:!1})}),V=or(pi((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isShowingNodesUsage:!1,isEditingAdminLimits:!1,isEditingCrypto:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Go(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{try{qo(n().filters)}catch(i){console.error("refetchUsers failed:",i)}},resetAllUsage:()=>R("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers()}),onResetAllUsage:i=>t({isResetingAllUsage:i}),onCreateUser:i=>t({isCreatingNewUser:i}),onEditingUser:i=>{t({editingUser:i})},onDeletingUser:i=>{t({deletingUser:i})},onFilterChange:i=>{t({filters:{...n().filters,...i}}),n().refetchUsers()},setQRCode:i=>{t({QRcodeLinks:i})},deleteUser:i=>(t({editingUser:null}),R(`/user/${i.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(),Sr.invalidateQueries(_r)})),createUser:i=>R("/user",{method:"POST",body:i}).then(()=>{t({editingUser:null}),n().refetchUsers(),Sr.invalidateQueries(_r)}),editUser:i=>R(`/user/${i.username}`,{method:"PUT",body:i}).then(()=>{n().onEditingUser(null),n().refetchUsers()}),fetchUserUsage:(i,s)=>{for(const a in s)s[a]||delete s[a];return R(`/user/${i.username}/usage`,{method:"GET",query:s})},onEditingHosts:i=>{t({isEditingHosts:i})},onEditingNodes:i=>{t({isEditingNodes:i})},onShowingNodesUsage:i=>{t({isShowingNodesUsage:i})},onEditingAdminLimits:i=>{t({isEditingAdminLimits:i})},onEditingCrypto:i=>{t({isEditingCrypto:i})},setSubLink:i=>{t({subscribeUrl:i})},resetDataUsage:i=>R(`/user/${i.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers()}),revokeSubscription:i=>R(`/user/${i.username}/revoke_sub`,{method:"POST"}).then(s=>{t({revokeSubscriptionUser:null,editingUser:s}),n().refetchUsers()})}))),$e=({children:t,color:n})=>e(U,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(u,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})}),Qo=L(bn,{baseStyle:{w:5,h:5}}),Xo=()=>{const{isEditingAdminLimits:t,onEditingAdminLimits:n}=V(),{t:i}=te(),{userData:s,getUserIsSuccess:a,getUserIsPending:o}=Lr(),l=je(),[b,y]=p.exports.useState([]),[f,w]=p.exports.useState(""),[x,c]=p.exports.useState(!1),[g,z]=p.exports.useState(!1),[T,k]=p.exports.useState(""),[d,h]=p.exports.useState(""),[G,E]=p.exports.useState("GB"),[F,M]=p.exports.useState(""),[P,v]=p.exports.useState("GB"),[B,Y]=p.exports.useState(0),ce=p.exports.useMemo(()=>b.filter(S=>!S.is_sudo),[b]),A=p.exports.useMemo(()=>ce.find(S=>S.username===f)||null,[ce,f]),Q=S=>{if(S==null)return"-";const q=Math.abs(S);return q>=1024**4?(S/1024**4).toFixed(2)+" TB":q>=1024**3?(S/1024**3).toFixed(2)+" GB":q>=1024**2?(S/1024**2).toFixed(2)+" MB":q>=1024?(S/1024).toFixed(2)+" KB":S+" B"},oe=(S,q)=>Math.floor(q==="TB"?S*1024**4:S*1024**3),$=S=>S==null?{value:"",unit:"GB"}:S>=1024**4?{value:String(Math.floor(S/1024**4)),unit:"TB"}:{value:String(Math.floor(S/1024**3)),unit:"GB"},ae=()=>{n(!1)};p.exports.useEffect(()=>{if(!!t){if(!o&&a&&!s.is_sudo){n(!1);return}c(!0),R("/admins").then(S=>{y(S||[]);const q=(S||[]).find(re=>!re.is_sudo);q&&w(q.username)}).catch(()=>{l({title:i("adminLimits.loadError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>c(!1))}},[t]),p.exports.useEffect(()=>{var q;if(!A){k(""),h(""),E("GB"),M(""),v("GB"),Y(0);return}const S=$((q=A.traffic_limit)!=null?q:null);h(S.value),E(S.unit),k(A.users_limit!==null&&A.users_limit!==void 0?String(A.users_limit):""),R(`/xpert/admin-user-traffic-limit/${encodeURIComponent(A.username)}`).then(re=>{var ne;const xe=$((ne=re==null?void 0:re.limit_bytes)!=null?ne:null);M(xe.value),v(xe.unit)}).catch(()=>{M(""),v("GB")}),R("/users",{query:{admin:[A.username],limit:1}}).then(re=>Y((re==null?void 0:re.total)||0)).catch(()=>Y(0))},[A]);const pe=S=>{const q=S.trim();if(!q)return null;const re=Number(q);return Number.isNaN(re)||re<0?null:Math.floor(re)},de=S=>{!S||(z(!0),R(`/admin/usage/reset/${S}`,{method:"POST"}).then(q=>{y(re=>re.map(xe=>xe.username===q.username?q:xe)),l({title:i("adminLimits.resetSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:i("adminLimits.resetError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>z(!1)))},ke=S=>!S.traffic_limit||S.users_usage===void 0||S.users_usage===null?!1:S.users_usage>=S.traffic_limit,Ae=()=>{if(!A)return;const S=pe(d),q=pe(F),re={is_sudo:A.is_sudo,traffic_limit:S===null?null:oe(S,G),users_limit:pe(T)},xe={admin_username:A.username,limit_bytes:q===null?null:oe(q,P)};z(!0),Promise.all([R(`/admin/${A.username}`,{method:"PUT",body:re}),R("/xpert/admin-user-traffic-limit",{method:"POST",body:xe})]).then(([ne,ie])=>{y(ue=>ue.map(he=>he.username===ne.username?ne:he)),typeof(ie==null?void 0:ie.updated_users)=="number"&&l({title:i("adminLimits.userTrafficApplied",{count:ie.updated_users}),status:"info",isClosable:!0,position:"top",duration:2500}),l({title:i("adminLimits.saveSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:i("adminLimits.saveError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>z(!1))};return r(Le,{isCentered:!0,isOpen:t,onClose:ae,size:"xl",scrollBehavior:"inside",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",w:{base:"calc(100vw - 24px)",md:"auto"},maxW:{base:"calc(100vw - 24px)",md:"3xl"},children:[e(Me,{pt:6,children:e($e,{color:"primary",children:e(Qo,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:i("adminLimits.title")}),e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:i("adminLimits.subtitle")}),r(J,{spacing:4,mt:4,align:"stretch",children:[A&&r(I,{spacing:3,wrap:"wrap",children:[r(O,{colorScheme:"blue",children:[i("adminLimits.usersCount"),": ",B]}),r(O,{colorScheme:"purple",children:[i("adminLimits.usedTraffic"),": ",Q(A.users_usage)]})]}),r(H,{children:[e(X,{fontSize:"sm",children:i("adminLimits.selectAdmin")}),e(Re,{size:"sm",value:f,onChange:S=>w(S.target.value),isDisabled:x,children:ce.map(S=>e("option",{value:S.username,children:S.username},S.username))})]}),r(xn,{spacing:3,align:"flex-start",direction:{base:"column",md:"row"},children:[r(H,{children:[e(X,{fontSize:"sm",children:i("adminLimits.usersLimit")}),r(Ht,{size:"sm",min:0,value:T,onChange:S=>k(S),children:[e($t,{placeholder:i("adminLimits.usersLimitPlaceholder")}),r(Vt,{children:[e(Gt,{}),e(Yt,{})]})]})]}),r(H,{children:[e(X,{fontSize:"sm",children:i("adminLimits.trafficLimit")}),r(I,{children:[r(Ht,{size:"sm",min:0,value:d,onChange:S=>h(S),children:[e($t,{placeholder:i("adminLimits.trafficLimitPlaceholder")}),r(Vt,{children:[e(Gt,{}),e(Yt,{})]})]}),r(Re,{size:"sm",value:G,onChange:S=>E(S.target.value),width:"90px",children:[e("option",{value:"GB",children:"GB"}),e("option",{value:"TB",children:"TB"})]})]})]})]}),r(H,{children:[e(X,{fontSize:"sm",children:i("adminLimits.userTrafficLimit")}),r(I,{children:[r(Ht,{size:"sm",min:0,value:F,onChange:S=>M(S),children:[e($t,{placeholder:i("adminLimits.userTrafficLimitPlaceholder")}),r(Vt,{children:[e(Gt,{}),e(Yt,{})]})]}),r(Re,{size:"sm",value:P,onChange:S=>v(S.target.value),width:"90px",children:[e("option",{value:"GB",children:"GB"}),e("option",{value:"TB",children:"TB"})]})]})]}),r(J,{spacing:2,align:"stretch",children:[e(u,{fontWeight:"semibold",fontSize:"sm",children:i("adminLimits.tableTitle")}),e(U,{display:{base:"none",md:"block"},overflowX:"auto",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"rgba(191, 219, 254, 0.24)",bg:"rgba(12, 16, 32, 0.5)"},borderRadius:"md",p:2,children:r(qt,{size:"sm",variant:"simple",children:[e(Zt,{bg:"gray.50",_dark:{bg:"rgba(24, 30, 58, 0.62)"},children:r(Qe,{children:[e(we,{children:i("adminLimits.tableAdmin")}),e(we,{isNumeric:!0,children:i("adminLimits.tableUsers")}),e(we,{isNumeric:!0,children:i("adminLimits.tableUsersLimit")}),e(we,{isNumeric:!0,children:i("adminLimits.tableTrafficUsed")}),e(we,{isNumeric:!0,children:i("adminLimits.tableTrafficLimit")}),e(we,{textAlign:"right",children:i("adminLimits.tableActions")})]})}),e(Qt,{children:ce.map(S=>{var q;return r(Qe,{bg:ke(S)?"red.50":void 0,_dark:ke(S)?{bg:"red.900"}:void 0,children:[e(me,{whiteSpace:"nowrap",children:S.username}),e(me,{isNumeric:!0,children:S.username===f?B:"-"}),e(me,{isNumeric:!0,children:(q=S.users_limit)!=null?q:"-"}),e(me,{isNumeric:!0,whiteSpace:"nowrap",children:Q(S.users_usage)}),e(me,{isNumeric:!0,whiteSpace:"nowrap",children:S.traffic_limit?Q(S.traffic_limit):"-"}),e(me,{textAlign:"right",children:e(W,{size:"xs",variant:"outline",onClick:()=>de(S.username),isDisabled:g,children:i("adminLimits.resetUsage")})})]},S.username)})})]})}),e(J,{display:{base:"flex",md:"none"},spacing:2,align:"stretch",children:ce.map(S=>{var q;return r(U,{border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"rgba(191, 219, 254, 0.24)",bg:"rgba(12, 16, 32, 0.5)"},borderRadius:"md",p:3,children:[r(I,{justify:"space-between",mb:2,children:[e(u,{fontWeight:"semibold",fontSize:"sm",children:S.username}),e(W,{size:"xs",variant:"outline",onClick:()=>de(S.username),isDisabled:g,children:i("adminLimits.resetUsage")})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"xs",children:i("adminLimits.tableUsers")}),e(u,{fontSize:"xs",children:S.username===f?B:"-"})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"xs",children:i("adminLimits.tableUsersLimit")}),e(u,{fontSize:"xs",children:(q=S.users_limit)!=null?q:"-"})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"xs",children:i("adminLimits.tableTrafficUsed")}),e(u,{fontSize:"xs",children:Q(S.users_usage)})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"xs",children:i("adminLimits.tableTrafficLimit")}),e(u,{fontSize:"xs",children:S.traffic_limit?Q(S.traffic_limit):"-"})]})]},S.username)})})]})]})]}),r(Ke,{display:"flex",flexDirection:{base:"column",md:"row"},gap:2,children:[e(W,{size:"sm",onClick:ae,mr:{base:0,md:3},w:"full",variant:"outline",children:i("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"primary",onClick:Ae,leftIcon:g?e(Xe,{size:"xs"}):void 0,isDisabled:x||!A,children:i("save")})]})]})]})},Jo=or(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{t({isLoading:!0}),Promise.all([R("/core").then(({version:n,started:i,logs_websocket:s})=>t({version:n,started:i,logs_websocket:s})),R("/core/config").then(n=>t({config:n}))]).finally(()=>t({isLoading:!1}))},updateConfig:n=>(t({isPostLoading:!0}),R("/core/config",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})})),restartCore:()=>R("/core/restart",{method:"POST"})}));window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(t,n,i)=>{n.isDark=!0,n.cssClass="ace-nord-dark",t("../lib/dom").importCssString(n.cssText,n.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(t,n,i)=>{n.isDark=!1,n.cssClass="ace-dawn",t("../lib/dom").importCssString(n.cssText,n.cssClass)});const Ko=p.exports.forwardRef(({json:t,onChange:n,mode:i="code"},s)=>{const{colorMode:a}=wt(),o={mode:i,onChangeText:n,statusBar:!1,mainMenuBar:!1,theme:a==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},l=p.exports.useRef(null),b=p.exports.useRef(null);return p.exports.useEffect(()=>(b.current=new mi(l.current,o),()=>{b.current&&b.current.destroy()}),[]),p.exports.useEffect(()=>{b.current&&b.current.update(t)},[t]),e(U,{ref:s,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(U,{height:"full",ref:l})})}),Vn=D.object({name:D.string().min(1),address:D.string().min(1),port:D.number().min(1).or(D.string().transform(t=>parseFloat(t))),api_port:D.number().min(1).or(D.string().transform(t=>parseFloat(t))),xray_version:D.string().nullable().optional(),id:D.number().nullable().optional(),status:D.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:D.string().nullable().optional(),add_as_new_host:D.boolean().optional(),usage_coefficient:D.number().or(D.string().transform(t=>parseFloat(t)))}),es=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1}),At="fetch-nodes-query-key",Gn=()=>{const{isEditingNodes:t}=V();return dt({queryKey:At,queryFn:Wt.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Wt=or((t,n)=>({nodes:[],addNode(i){return R("/node",{method:"POST",body:i})},fetchNodes(){return R("/nodes")},fetchNodesUsage(i){return R("/nodes/usage",{query:i})},updateNode(i){return R(`/node/${i.id}`,{method:"PUT",body:i})},setDeletingNode(i){t({deletingNode:i})},reconnectNode(i){return R(`/node/${i.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var i;return R(`/node/${(i=n().deletingNode)==null?void 0:i.id}`,{method:"DELETE"})}})),Or=500,ts=L(yn,{baseStyle:{w:5,h:5}}),rs=L(sr,{baseStyle:{w:4,h:4}}),ns=L(gi,{baseStyle:{w:4,h:4}}),is=L(fi,{baseStyle:{w:3,h:3}}),os=t=>({[It.ReadyState.CONNECTING]:"connecting",[It.ReadyState.OPEN]:"connected",[It.ReadyState.CLOSING]:"closed",[It.ReadyState.CLOSED]:"closed",[It.ReadyState.UNINSTANTIATED]:"closed"})[t],ss=t=>{try{let n=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(n.protocol==="https:"?"wss://":"ws://")+gn([n.host+n.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+rr()}catch(n){return console.error("Unable to generate websocket url"),console.error(n),null}};let mt=[];const as=()=>{const{colorMode:t}=wt(),{data:n}=Gn(),i=!1,[s,a]=p.exports.useState(""),o=($,ae)=>{$!==s&&($==="host"?(a(""),k([])):(a($),k([])))},{isEditingCore:l}=V(),{fetchCoreSettings:b,updateConfig:y,isLoading:f,config:w,isPostLoading:x,version:c,restartCore:g}=Jo(),z=p.exports.useRef(null),[T,k]=p.exports.useState([]),{t:d}=te(),h=je(),G=kt({defaultValues:{config:w||{}}});p.exports.useEffect(()=>{w&&G.setValue("config",w)},[w]),p.exports.useEffect(()=>{l&&b()},[l]);const E=p.exports.useRef(!0),F=p.exports.useCallback(Sn($=>{var pe,de,ke;const ae=Math.abs((((pe=z.current)==null?void 0:pe.scrollTop)||0)-(((de=z.current)==null?void 0:de.scrollHeight)||0)+(((ke=z.current)==null?void 0:ke.offsetHeight)||0))<10;z.current&&ae?E.current=!0:E.current=!1,$.length<40&&k($)},300),[]),{readyState:M}=bi(ss(s),{onMessage:$=>{mt.push($.data),mt.length>Or&&(mt=mt.splice(0,mt.length-Or)),F([...mt])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});p.exports.useEffect(()=>{var $;z.current&&E.current&&(z.current.scrollTop=($=z.current)==null?void 0:$.scrollHeight)},[T]),p.exports.useEffect(()=>()=>{mt=[]},[]);const P=os(M.toString()),{mutate:v,isLoading:B}=Tt(g),Y=({config:$})=>{y($).then(()=>{h({title:d("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(ae=>{let pe=d("core.generalErrorMessage");typeof ae.response._data.detail=="object"&&(pe=ae.response._data.detail[Object.keys(ae.response._data.detail)[0]]),typeof ae.response._data.detail=="string"&&(pe=ae.response._data.detail),h({title:pe,status:"error",isClosable:!0,position:"top",duration:3e3})})},ce=p.exports.useRef(null),[A,Q]=p.exports.useState(!1),oe=()=>{var $;document.fullscreenElement?(document.exitFullscreen(),Q(!1)):(($=ce.current)==null||$.requestFullscreen(),Q(!0))};return r("form",{onSubmit:G.handleSubmit(Y),children:[r(Ee,{children:[r(H,{children:[r(I,{justifyContent:"space-between",alignItems:"flex-start",children:[r(X,{children:[d("core.configuration")," ",f&&e(_n,{isIndeterminate:!0,size:"15px"})]}),e(I,{gap:0,children:e(ze,{label:"Xray Version",placement:"top",children:e(O,{height:"100%",textTransform:"lowercase",children:c&&`v${c}`})})})]}),r(U,{position:"relative",ref:ce,minHeight:"300px",children:[e(Je,{control:G.control,name:"config",render:({field:$})=>e(Ko,{json:w,onChange:$.onChange})}),e(se,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:oe,children:A?e(is,{}):e(ns,{})})]})]}),r(H,{mt:"4",children:[r(I,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[r(I,{children:[(n==null?void 0:n[0])&&r(Re,{size:"sm",style:{width:"auto"},disabled:i,bg:"transparent",_dark:{bg:"transparent"},sx:{option:{backgroundColor:t==="dark"?"#222C3B":"white"}},onChange:$=>o($.currentTarget.value,$.currentTarget.selectedOptions[0].text),children:[e("option",{value:"host",defaultChecked:!0,children:"Master"},"host"),n&&n.map($=>e("option",{value:String($.id),children:d($.name)},$.address))]}),e(X,{className:"w-au",children:d("core.logs")})]}),e(u,{as:X,children:d(`core.socket.${P}`)})]}),e(U,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:z,children:T.map(($,ae)=>e(u,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:$},ae))})]})]}),e(Ke,{children:r(I,{w:"full",justifyContent:"space-between",children:[e(I,{children:e(U,{children:e(W,{size:"sm",leftIcon:e(rs,{className:Nt({"animate-spin":B})}),onClick:()=>v(),children:d(B?"core.restarting":"core.restartCore")})})}),e(I,{children:e(W,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:f||x,isLoading:x,children:d("core.save")})})]})})]})},ls=()=>{const{isEditingCore:t}=V(),n=V.setState.bind(null,{isEditingCore:!1}),{t:i}=te();return r(Le,{isOpen:t,onClose:n,size:"3xl",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",w:"full",children:[e(Me,{pt:6,children:r(I,{gap:2,children:[e($e,{color:"primary",children:e(ts,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:i("core.title")})]})}),e(Te,{mt:3}),e(as,{})]})]})};function cs(){const{t}=te(),n=je(),{isEditingCrypto:i,onEditingCrypto:s}=V(),[a,o]=p.exports.useState(""),[l,b]=p.exports.useState(""),[y,f]=p.exports.useState(""),[w,x]=p.exports.useState(""),[c,g]=p.exports.useState(!1),[z,T]=p.exports.useState(""),[k,d]=p.exports.useState(!0),{onCopy:h,hasCopied:G}=xi(z),E=()=>{s(!1),o(""),b(""),f(""),x(""),g(!1),T("")};p.exports.useEffect(()=>{!i||R("/admin").then(P=>{const v=!!(P!=null&&P.is_sudo);d(v),!v&&y&&y!=="1"&&f("1")}).catch(()=>{d(!0)})},[i]);const F=async()=>{var P;try{const v=w.trim();if(!v){n({title:t("cryptoLink.hwidResetEmpty"),status:"warning",duration:2e3,isClosable:!0});return}g(!0);const B=await R("/xpert/hwid/reset",{method:"POST",body:{username:v}});B&&B.cleared?n({title:t("cryptoLink.hwidResetDone"),status:"success",duration:1500,isClosable:!0}):n({title:t("cryptoLink.hwidResetNoData"),status:"info",duration:2500,isClosable:!0})}catch(v){n({title:t("cryptoLink.hwidResetFailed"),description:String((P=v==null?void 0:v.message)!=null?P:v),status:"error",duration:3e3,isClosable:!0})}finally{g(!1)}},M=async()=>{var P;try{if(!a.trim()){n({title:t("cryptoLink.empty"),status:"warning",duration:2e3,isClosable:!0});return}const v={url:a.trim()};l.trim()&&(v.hwid=l.trim()),y&&(v.hwid_limit=Number(y));const B=await R("/xpert/crypto-link",{method:"POST",body:v}),Y=B&&(B.encrypted_link||B.link||B.url||B.result||B.data||B.encrypted)||B;if(!Y||typeof Y!="string")throw new Error("Invalid response");T(Y),B&&typeof B.notice=="string"&&B.notice.trim()&&n({title:B.notice,status:"info",duration:3500,isClosable:!0}),n({title:t("cryptoLink.done"),status:"success",duration:1500,isClosable:!0})}catch(v){n({title:t("cryptoLink.failed"),description:String((P=v==null?void 0:v.message)!=null?P:v),status:"error",duration:3e3,isClosable:!0})}};return r(Le,{isOpen:i,onClose:E,size:"xl",isCentered:!0,children:[e(De,{}),r(Ue,{children:[e(Me,{children:t("cryptoLink.title")}),e(Te,{}),r(Ee,{children:[r(H,{children:[e(X,{children:t("cryptoLink.input")}),e(br,{value:a,onChange:P=>o(P.target.value),placeholder:t("cryptoLink.inputPlaceholder"),minH:"120px"})]}),r(H,{mt:4,children:[e(X,{children:t("cryptoLink.hwid")}),e(ut,{value:l,onChange:P=>b(P.target.value),placeholder:t("cryptoLink.hwidPlaceholder")})]}),r(H,{mt:4,children:[e(X,{children:t("cryptoLink.hwidLimit")}),r(Re,{value:y,onChange:P=>f(P.target.value),children:[e("option",{value:"",children:t("cryptoLink.hwidLimitPlaceholder")}),e("option",{value:"1",children:"1"}),k?e("option",{value:"2",children:"2"}):null,k?e("option",{value:"3",children:"3"}):null,k?e("option",{value:"4",children:"4"}):null,k?e("option",{value:"5",children:"5"}):null]})]}),r(H,{mt:4,children:[e(X,{children:t("cryptoLink.hwidResetTitle")}),r(I,{spacing:3,align:"stretch",children:[e(ut,{value:w,onChange:P=>x(P.target.value),placeholder:t("cryptoLink.hwidResetPlaceholder")}),e(W,{onClick:F,isLoading:c,variant:"outline",children:t("cryptoLink.hwidResetButton")})]})]}),r(H,{mt:4,children:[e(X,{children:t("cryptoLink.output")}),e(br,{value:z,isReadOnly:!0,placeholder:t("cryptoLink.outputPlaceholder"),minH:"120px"})]})]}),r(Ke,{children:[e(W,{onClick:M,colorScheme:"blue",mr:3,children:t("cryptoLink.encrypt")}),e(W,{onClick:h,isDisabled:!z,variant:"outline",mr:3,children:t(G?"cryptoLink.copied":"cryptoLink.copy")}),e(W,{variant:"ghost",onClick:E,children:t("general.cancel")})]})]})]})}const Pt=L(yi,{baseStyle:{w:5,h:5}}),ds=()=>{const[t,n]=p.exports.useState(!1),{deletingUser:i,onDeletingUser:s,deleteUser:a}=V(),{t:o}=te(),l=je(),b=()=>{s(null)},y=()=>{i&&(n(!0),a(i).then(()=>{l({title:o("deleteUser.deleteSuccess",{username:i.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(b).finally(n.bind(null,!1)))};return r(Le,{isCentered:!0,isOpen:!!i,onClose:b,size:"sm",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",children:[e(Me,{pt:6,children:e($e,{color:"red",children:e(Pt,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:o("deleteUser.title")}),i&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ht,{components:{b:e("b",{})},children:o("deleteUser.prompt",{username:i.username})})})]}),r(Ke,{display:"flex",children:[e(W,{size:"sm",onClick:b,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:t?e(Xe,{size:"xs"}):void 0,children:o("delete")})]})]})]})},Dr={baseStyle:{w:4,h:4}},us=L(Si,Dr),hs=L(wn,Dr),Ur=L(sr,Dr),ps=Sn(t=>{V.getState().onFilterChange({...V.getState().filters,offset:0,search:t})},300),ms=({...t})=>{const{loading:n,filters:i,onFilterChange:s,refetchUsers:a,onCreateUser:o}=V(),{t:l}=te(),[b,y]=p.exports.useState(""),[f,w]=p.exports.useState([]),[x,c]=p.exports.useState(null),[g,z]=p.exports.useState(!1);p.exports.useEffect(()=>{const E=()=>{z(window.scrollY>0)};return E(),window.addEventListener("scroll",E,{passive:!0}),()=>{window.removeEventListener("scroll",E)}},[]),p.exports.useEffect(()=>{let E=!0;return(async()=>{try{const F=await R("/admin");if(!E)return;if(c({username:F.username,is_sudo:!!F.is_sudo}),F!=null&&F.is_sudo)try{const M=await R("/admins");if(!E)return;const P=Array.isArray(M)?M:[],v=P.some(B=>(B==null?void 0:B.username)===F.username);w(v?P:[{username:F.username,is_sudo:!!F.is_sudo},...P])}catch{w([{username:F.username,is_sudo:!!F.is_sudo}])}else w([{username:F.username,is_sudo:!!F.is_sudo}])}catch{w([])}})(),()=>{E=!1}},[]);const T=E=>{y(E.target.value),ps(E.target.value)},k=()=>{y(""),s({...i,offset:0,search:""})},d=E=>{const F=E.target.value;s({...i,offset:0,admin:F==="__all__"?void 0:F})},h=i.admin||"__all__",G=x!=null&&x.is_sudo?"minmax(0, 1fr) minmax(0, 1fr)":"1fr";return r(kn,{id:"filters",templateColumns:{base:"1fr",md:"minmax(0, 1fr) minmax(0, 1fr) auto"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:g?"rgba(255, 255, 255, 0.42)":"transparent",_dark:{bg:g?"rgba(4, 6, 9, 0.44)":"transparent",borderColor:g?"rgba(148, 163, 184, 0.35)":"transparent"},borderBottomWidth:"1px",borderColor:g?"rgba(210, 210, 212, 0.7)":"transparent",backdropFilter:g?"blur(12px)":"none",WebkitBackdropFilter:g?"blur(12px)":"none",boxShadow:g?"0 10px 24px rgba(0, 0, 0, 0.12)":"none",transition:"background-color .18s ease, backdrop-filter .18s ease, border-color .18s ease, box-shadow .18s ease",py:4,zIndex:"docked",...t,children:[e(Ut,{colSpan:{base:1,md:2},order:{base:2,md:1},display:"flex",justifyContent:"stretch",children:r(U,{display:"grid",gridTemplateColumns:{base:"1fr",md:G},gap:3,w:"full",minW:0,children:[r(Xt,{w:"full",children:[e(_i,{pointerEvents:"none",children:e(us,{})}),e(ut,{placeholder:l("search"),value:b,borderColor:"light-border",_dark:{bg:"gray.750",borderColor:"gray.600"},onChange:T}),r(Jt,{children:[n&&e(Xe,{size:"xs"}),i.search&&i.search.length>0&&e(se,{onClick:k,"aria-label":"clear",size:"xs",variant:"ghost",children:e(hs,{})})]})]}),x!=null&&x.is_sudo?r(Re,{size:"md",borderColor:"light-border",_dark:{bg:"gray.750",borderColor:"gray.600"},value:h,onChange:d,w:"full",children:[e("option",{value:"__all__",children:l("filters.adminAll")}),r("option",{value:"__sudo_self__",children:[x.username," (sudo)"]}),f.filter(E=>E.username!==(x==null?void 0:x.username)).map(E=>r("option",{value:E.username,children:[E.username,E.is_sudo?" (sudo)":""]},E.username))]}):null]})}),e(Ut,{colSpan:{base:1,md:1},order:{base:1,md:2},children:r(I,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(se,{"aria-label":"refresh users",disabled:n,onClick:a,size:"sm",variant:"outline",children:e(Ur,{className:Nt({"animate-spin":n})})}),e(W,{variant:"solid",size:"sm",onClick:()=>o(!0),px:5,_dark:{bg:"rgba(77, 99, 255, 0.16)",color:"#dbe7ff",border:"1px solid rgba(96, 165, 250, 0.38)",backdropFilter:"blur(6px)",boxShadow:"0 0 8px rgba(77,99,255,0.28)",_hover:{bg:"rgba(77, 99, 255, 0.22)",boxShadow:"0 0 12px rgba(77,99,255,0.36)",transform:"translateY(-1px)"},_active:{bg:"rgba(77, 99, 255, 0.26)",transform:"translateY(0)"}},children:l("createUser")})]})})]})},Mr=t=>e(I,{w:"full",py:"0",position:"relative",...t,children:e(u,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:"Xpert (v1.0) from Ashgabat"})}),jr="https://github.com/mybrohigh/Xpert",gs=L(wi,{baseStyle:{w:4,h:4}}),Yn=({actions:t})=>{const{i18n:n}=te();var i=s=>{n.changeLanguage(s)};return r(Cn,{placement:"bottom-end",children:[e(vn,{as:se,size:"sm",variant:"outline",icon:e(gs,{}),position:"relative"}),r(In,{minW:"100px",zIndex:9999,children:[e(Be,{maxW:"100px",fontSize:"sm",onClick:()=>i("en"),children:"English"}),e(Be,{maxW:"100px",fontSize:"sm",onClick:()=>i("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Be,{maxW:"100px",fontSize:"sm",onClick:()=>i("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"}),e(Be,{maxW:"100px",fontSize:"sm",onClick:()=>i("ru"),children:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"})]})]})},ar={baseStyle:{w:4,h:4}},fs={baseStyle:{w:4,h:4,color:"#67e8f9",filter:"drop-shadow(0 0 2px rgba(103,232,249,0.85))"}},bs={baseStyle:{w:4,h:4,color:"#a78bfa",filter:"drop-shadow(0 0 2px rgba(167,139,250,0.85))"}},xs={baseStyle:{w:4,h:4,color:"#f472b6",filter:"drop-shadow(0 0 2px rgba(244,114,182,0.85))"}},ys={baseStyle:{w:4,h:4,color:"#fb7185",filter:"drop-shadow(0 0 2px rgba(251,113,133,0.85))"}},Ss={baseStyle:{w:4,h:4,color:"#facc15",filter:"drop-shadow(0 0 2px rgba(250,204,21,0.85))"}},_s={baseStyle:{w:4,h:4,color:"#34d399",filter:"drop-shadow(0 0 2px rgba(52,211,153,0.85))"}},ws={baseStyle:{w:4,h:4,color:"#22d3ee",filter:"drop-shadow(0 0 2px rgba(34,211,238,0.85))"}},ks={baseStyle:{w:4,h:4,color:"#f59e0b",filter:"drop-shadow(0 0 2px rgba(245,158,11,0.85))"}},Cs={baseStyle:{w:4,h:4,color:"#60a5fa",filter:"drop-shadow(0 0 2px rgba(96,165,250,0.85))"}},vs=L(ki,ar),Is=L(Ci,ar),zs=L(yn,ar),Hr=L(vi,ws),$r=L(Ii,ar),Vr=L(zi,Cs),Gr=L(Li,ks),Yr=L(Cr,fs),qr=L(zn,bs),Zr=L(ir,xs),Qr=L(Ln,ys),Xr=L(bn,Ss),Jr=L(Di,_s),jt=L(U,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),qn="xpert-menu-notification",Kr="240px",en="82px",tn="10px",st="46px",Ls="16px",Ds=()=>{const t=localStorage.getItem(qn);if(!t)return!0;try{return t&&Ui(parseInt(t))?Mi(new Date,new Date(parseInt(t)))>=7:!0}catch{return!0}},Zn=({actions:t})=>{const{userData:n,getUserIsSuccess:i,getUserIsPending:s}=Lr(),a=()=>!s&&i?n.is_sudo:!1,{onEditingHosts:o,onResetAllUsage:l,onEditingNodes:b,onShowingNodesUsage:y,onEditingAdminLimits:f,onEditingCrypto:w}=V(),{t:x}=te(),{colorMode:c,toggleColorMode:g}=wt(),[z,T]=p.exports.useState(Ds()),[k,d]=p.exports.useState(!1),[h,G]=p.exports.useState(!0),E=()=>{localStorage.setItem(qn,new Date().getTime().toString()),T(!1)},F=()=>d(!1);return p.exports.useEffect(()=>{const M=document.body;return window.matchMedia("(min-width: 48em)").matches&&k?(M.classList.add("xpert-side-open"),M.style.setProperty("--xpert-side-menu-width",Kr),M.style.setProperty("--xpert-side-menu-right",tn),M.style.setProperty("--xpert-side-menu-content-gap",Ls)):(M.classList.remove("xpert-side-open"),M.style.removeProperty("--xpert-side-menu-width"),M.style.removeProperty("--xpert-side-menu-right"),M.style.removeProperty("--xpert-side-menu-content-gap")),()=>{M.classList.remove("xpert-side-open"),M.style.removeProperty("--xpert-side-menu-width"),M.style.removeProperty("--xpert-side-menu-right"),M.style.removeProperty("--xpert-side-menu-content-gap")}},[k]),p.exports.useEffect(()=>{if(!window.matchMedia("(min-width: 48em)").matches)return;if(k){G(!0);return}let P=window.scrollY||0;const v=()=>{const B=window.scrollY||0,Y=B-P;B<24||Y<-6?G(!0):B>80&&Y>8&&G(!1),P=B};return window.addEventListener("scroll",v,{passive:!0}),()=>window.removeEventListener("scroll",v)},[k]),r(I,{gap:2,justifyContent:"space-between",position:"relative",children:[e(I,{children:e(pt,{to:"/",children:e(u,{as:"h1",fontWeight:"semibold",fontSize:{base:"xl",md:"2xl"},cursor:"pointer",_hover:{color:"primary.500"},children:"Xpert"})})}),e(U,{overflow:"visible",css:{direction:"rtl"},position:{base:"static",md:"fixed"},top:{base:"auto",md:"16px"},right:{base:"auto",md:"24px"},zIndex:{base:"auto",md:1300},opacity:{base:1,md:h?1:0},transform:{base:"none",md:h?"none":"translateY(-12px)"},pointerEvents:{base:"auto",md:h?"auto":"none"},transition:"opacity .2s ease, transform .2s ease",children:r(I,{alignItems:"center",children:[r(Cn,{placement:"bottom-end",children:[r(U,{position:"relative",display:{base:"inline-flex",md:"none"},children:[e(vn,{as:se,size:"sm",variant:"outline",icon:e($r,{}),position:"relative",display:{base:"inline-flex",md:"none"}}),z&&e(jt,{top:"1",right:"1",zIndex:2})]}),r(In,{minW:"170px",zIndex:99999,sx:{direction:"ltr"},children:[a()&&r(Oe,{children:[e(Be,{maxW:"170px",fontSize:"sm",icon:e(Yr,{}),onClick:o.bind(null,!0),children:x("header.hostSettings")}),e(Be,{maxW:"170px",fontSize:"sm",icon:e(qr,{}),onClick:b.bind(null,!0),children:x("header.nodeSettings")}),e(Be,{maxW:"170px",fontSize:"sm",icon:e(Zr,{}),onClick:y.bind(null,!0),children:x("header.nodesUsage")}),e(Be,{maxW:"170px",fontSize:"sm",icon:e(Qr,{}),onClick:l.bind(null,!0),children:x("resetAllUsage")}),e(Be,{maxW:"170px",fontSize:"sm",icon:e(Xr,{}),onClick:f.bind(null,!0),children:x("adminLimits.menu")}),e(pt,{to:"/admin-manager/",children:e(Be,{maxW:"170px",fontSize:"sm",icon:e(Jr,{}),onClick:E,children:x("adminManager.menu")})})]}),e(Be,{maxW:"170px",fontSize:"sm",icon:e(Hr,{}),onClick:w.bind(null,!0),children:x("cryptoLink.menu")}),e(pt,{to:jr,target:"_blank",children:r(Be,{maxW:"170px",fontSize:"sm",icon:e(Gr,{}),position:"relative",onClick:E,children:[x("header.donation"),z&&e(jt,{top:"3",right:"2"})]})}),e(pt,{to:"/login",children:e(Be,{maxW:"170px",fontSize:"sm",icon:e(Vr,{}),children:x("header.logout")})})]})]}),r(U,{position:"relative",display:{base:"none",md:"inline-flex"},children:[e(se,{size:"sm",variant:"outline",icon:e($r,{}),position:"relative","aria-label":"open side menu",display:{base:"none",md:"inline-flex"},onClick:()=>d(M=>!M)}),z&&e(jt,{top:"1",right:"1",zIndex:2})]}),e(U,{display:{base:"none",md:k?"flex":"none"},position:"fixed",top:en,right:tn,h:"auto",maxH:`calc(100vh - ${en})`,w:Kr,zIndex:1200,flexDirection:"column",p:0,overflowY:"auto",overflowX:"hidden",_dark:{bg:"transparent",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},children:r(U,{display:"grid",gridTemplateColumns:"1fr",gap:2,w:"full",sx:{direction:"ltr"},children:[a()&&r(Oe,{children:[e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(Yr,{}),onClick:()=>{o(!0),F()},children:x("header.hostSettings")}),e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(qr,{}),onClick:()=>{b(!0),F()},children:x("header.nodeSettings")}),e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(Zr,{}),onClick:()=>{y(!0),F()},children:x("header.nodesUsage")}),e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(Qr,{}),onClick:()=>{l(!0),F()},children:x("resetAllUsage")}),e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(Xr,{}),onClick:()=>{f(!0),F()},children:x("adminLimits.menu")}),e(pt,{to:"/admin-manager/",onClick:F,style:{display:"block",width:"100%"},children:e(W,{size:"sm",h:st,px:4,w:"full",textAlign:"left",justifyContent:"flex-start",leftIcon:e(Jr,{}),children:x("adminManager.menu")})})]}),e(W,{size:"sm",h:st,w:"full",px:4,textAlign:"left",justifyContent:"flex-start",leftIcon:e(Hr,{}),onClick:()=>{w(!0),F()},children:x("cryptoLink.menu")}),e(pt,{to:jr,target:"_blank",onClick:()=>{E(),F()},style:{display:"block",width:"100%"},children:r(W,{size:"sm",h:st,px:4,w:"full",textAlign:"left",justifyContent:"flex-start",leftIcon:e(Gr,{}),position:"relative",children:[x("header.donation"),z&&e(jt,{top:"2",right:"2"})]})}),e(pt,{to:"/login",onClick:F,style:{display:"block",width:"100%"},children:e(W,{size:"sm",h:st,px:4,w:"full",textAlign:"left",justifyContent:"flex-start",leftIcon:e(Vr,{}),children:x("header.logout")})})]})}),a()&&e(se,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{V.setState({isEditingCore:!0})},children:e(zs,{})}),e(Yn,{}),e(se,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{Hn(c=="dark"?"light":"dark"),g()},children:c==="light"?e(vs,{}):e(Is,{})}),e(U,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}}})]})})]})},Us=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Ms=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Ts=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Es=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],As=["aes-128-gcm","aes-256-gcm","chacha20-ietf-poly1305"],Ns=or(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),R("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),R("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))}));const Rs=L(wn,{baseStyle:{w:4,h:4}}),lt=xr.forwardRef(({disabled:t,step:n,label:i,className:s,startAdornment:a,endAdornment:o,type:l="text",placeholder:b,onChange:y,onBlur:f,name:w,value:x,onClick:c,error:g,clearable:z=!1,...T},k)=>{const d=()=>{y&&y({target:{value:"",name:w}})},{size:h="md"}=T,G=l=="number"?$t:ut,E=l=="number"?Ht:xr.Fragment,F=l=="number"?{keepWithinRange:!0,precision:5,format:M=>isNaN(parseFloat(String(M)))||Number(parseFloat(String(M)).toFixed(5))===0?M:Number(parseFloat(String(M)).toFixed(5)),min:0,step:n,name:w,type:l,placeholder:b,onChange:M=>{y&&y({target:{value:M,name:w}})},onBlur:f,value:x,onClick:c,disabled:t,flexGrow:1,size:h}:{};return r(H,{isInvalid:!!g,children:[i&&e(X,{children:i}),r(Xt,{size:h,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[a&&e(Ti,{children:a}),r(E,{...F,children:[e(G,{name:w,ref:k,step:n,className:Nt(s),type:l,placeholder:b,onChange:l=="number"?void 0:y,onBlur:l=="number"?void 0:f,value:l=="number"?void 0:x,onClick:c,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...T,roundedLeft:a?"0":"md",roundedRight:o?"0":"md"}),l=="number"&&e(Oe,{children:r(Vt,{children:[e(Gt,{}),e(Yt,{})]})})]}),o&&e(Ei,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:o}),z&&x&&x.length&&e(Jt,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:d,cursor:"pointer",children:e(Rs,{})})]}),!!g&&e(Kt,{children:g})]})}),Fs=L(Ai,{baseStyle:{w:5,h:5}}),Ws=L(Ni,{baseStyle:{w:5,h:5}}),Ps=L(Ri,{baseStyle:{w:5,h:5}}),ur=L(Re,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),ct=L(lt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Bs=L(Cr,{baseStyle:{w:5,h:5}}),at=L(Fi,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Os=D.record(D.string().min(1),D.array(D.object({remark:D.string().min(1,"Remark is required"),address:D.string().min(1,"Address is required"),port:D.string().or(D.number()).nullable().transform(t=>typeof t=="number"?t:t!==null&&!isNaN(parseInt(t))?Number(parseInt(t)):null),path:D.string().nullable(),sni:D.string().nullable(),host:D.string().nullable(),mux_enable:D.boolean().default(!1),allowinsecure:D.boolean().nullable().default(!1),is_disabled:D.boolean().default(!0),fragment_setting:D.string().nullable(),noise_setting:D.string().nullable(),random_user_agent:D.boolean().default(!1),security:D.string(),alpn:D.string(),fingerprint:D.string(),use_sni_as_host:D.boolean().default(!1)}))),Ze=L(Kt,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),js=({hostKey:t,isOpen:n,toggleAccordion:i})=>{const{inbounds:s}=V(),a=[...s.values()].flat().filter(d=>d.tag===t)[0],o=vr(),{fields:l,append:b,remove:y,insert:f,move:w}=Wi({control:o.control,name:t}),{errors:x}=o.formState,{t:c}=te(),g=x[t],z=()=>{b({host:"",sni:"",port:null,path:null,address:"",remark:"",mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1})},T=d=>{if(d<0||d>=l.length)return;const h=l[d];f(d+1,h)};p.exports.useEffect(()=>{g&&!n&&i()},[g]);const k=(d,h)=>{h==="up"&&d>0?w(d,d-1):h==="down"&&d<l.length-1&&w(d,d+1)};return r(yt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(St,{px:2,borderRadius:"3px",onClick:i,children:[e(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:t}),e(yr,{})]}),e(_t,{px:2,pb:2,children:r(J,{gap:3,children:[l.map((d,h)=>{var G,E,F,M,P,v,B,Y,ce,A,Q,oe,$,ae,pe,de,ke,Ae,S,q,re,xe,ne,ie,ue,he,Ve,Fe,_,j,ee,ge,ye,Ne,He,Ge,m,C,N,K,Se,_e,Ye,fe,We;return e(Pi.div,{layout:!0,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{layout:{type:"spring",stiffness:500,damping:30},opacity:{duration:.1}},id:d.id,whileDrag:{scale:1.05,zIndex:10},style:{width:"100%"},children:r(J,{id:d.id,border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(I,{w:"100%",alignItems:"flex-start",children:r(H,{position:"relative",zIndex:10,isInvalid:!!(g&&((G=g[h])==null?void 0:G.remark)),children:[r(Xt,{children:[e(ct,{...o.register(t+"."+h+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(Jt,{children:r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(U,{mt:"-8px",children:e(at,{})})}),e(rt,{children:r(nt,{children:[e(it,{}),e(ot,{}),e(Nr,{children:r(U,{fontSize:"xs",children:[e(u,{pr:"20px",children:c("hostsDialog.desc")}),r(u,{children:[r(O,{children:["{","SERVER_IP","}"]})," ",c("hostsDialog.currentServer")]}),r(u,{mt:1,children:[r(O,{children:["{","SERVER_IPV6","}"]})," ",c("hostsDialog.currentServerv6")]}),r(u,{mt:1,children:[r(O,{children:["{","USERNAME","}"]})," ",c("hostsDialog.username")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_USAGE","}"]})," ",c("hostsDialog.dataUsage")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_LEFT","}"]})," ",c("hostsDialog.remainingData")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_LIMIT","}"]})," ",c("hostsDialog.dataLimit")]}),r(u,{mt:1,children:[r(O,{children:["{","DAYS_LEFT","}"]})," ",c("hostsDialog.remainingDays")]}),r(u,{mt:1,children:[r(O,{children:["{","EXPIRE_DATE","}"]})," ",c("hostsDialog.expireDate")]}),r(u,{mt:1,children:[r(O,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",c("hostsDialog.jalaliExpireDate")]}),r(u,{mt:1,children:[r(O,{children:["{","TIME_LEFT","}"]})," ",c("hostsDialog.remainingTime")]}),r(u,{mt:1,children:[r(O,{children:["{","STATUS_TEXT","}"]})," ",c("hostsDialog.statusText")]}),r(u,{mt:1,children:[r(O,{children:["{","STATUS_EMOJI","}"]})," ",c("hostsDialog.statusEmoji")]}),r(u,{mt:1,children:[r(O,{children:["{","PROTOCOL","}"]})," ",c("hostsDialog.proxyProtocol")]}),r(u,{mt:1,children:[r(O,{children:["{","TRANSPORT","}"]})," ",c("hostsDialog.proxyMethod")]})]})})]})})]})})]}),g&&((E=g[h])==null?void 0:E.remark)&&e(Ze,{children:(M=(F=g[h])==null?void 0:F.remark)==null?void 0:M.message})]})}),r(H,{isInvalid:!!(g&&((P=g[h])==null?void 0:P.address)),children:[r(Xt,{children:[e(ct,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...o.register(t+"."+h+".address")}),e(Jt,{children:r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(U,{mt:"-8px",children:e(at,{})})}),e(rt,{children:r(nt,{children:[e(it,{}),e(ot,{}),e(Nr,{children:r(U,{fontSize:"xs",children:[e(u,{pr:"20px",children:c("hostsDialog.desc")}),r(u,{children:[r(O,{children:["{","SERVER_IP","}"]})," ",c("hostsDialog.currentServer")]}),r(u,{mt:1,children:[r(O,{children:["{","SERVER_IPV6","}"]})," ",c("hostsDialog.currentServerv6")]}),r(u,{mt:1,children:[r(O,{children:["{","USERNAME","}"]})," ",c("hostsDialog.username")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_USAGE","}"]})," ",c("hostsDialog.dataUsage")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_LEFT","}"]})," ",c("hostsDialog.remainingData")]}),r(u,{mt:1,children:[r(O,{children:["{","DATA_LIMIT","}"]})," ",c("hostsDialog.dataLimit")]}),r(u,{mt:1,children:[r(O,{children:["{","DAYS_LEFT","}"]})," ",c("hostsDialog.remainingDays")]}),r(u,{mt:1,children:[r(O,{children:["{","EXPIRE_DATE","}"]})," ",c("hostsDialog.expireDate")]}),r(u,{mt:1,children:[r(O,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",c("hostsDialog.jalaliExpireDate")]}),r(u,{mt:1,children:[r(O,{children:["{","TIME_LEFT","}"]})," ",c("hostsDialog.remainingTime")]}),r(u,{mt:1,children:[r(O,{children:["{","STATUS_TEXT","}"]})," ",c("hostsDialog.statusText")]}),r(u,{mt:1,children:[r(O,{children:["{","STATUS_EMOJI","}"]})," ",c("hostsDialog.statusEmoji")]}),r(u,{mt:1,children:[r(O,{children:["{","PROTOCOL","}"]})," ",c("hostsDialog.proxyProtocol")]}),r(u,{mt:1,children:[r(O,{children:["{","TRANSPORT","}"]})," ",c("hostsDialog.proxyMethod")]})]})})]})})]})})]}),g&&((v=g[h])==null?void 0:v.address)&&e(Ze,{children:(Y=(B=g[h])==null?void 0:B.address)==null?void 0:Y.message})]}),e(Ft,{w:"full",allowToggle:!0,children:r(yt,{border:"0",children:[r("div",{style:{display:"flex",alignItems:"center"},children:[r(St,{display:"flex",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[r(u,{flex:"3",align:"start",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[c("hostsDialog.advancedOptions"),e(yr,{fontSize:"sm",ml:1})]}),r(Bi,{flex:"1",px:"0",display:"contents",children:[e(Je,{control:o.control,name:`${t}.${h}.is_disabled`,render:({field:be})=>e(er,{mx:"1.5",colorScheme:"primary",...be,value:void 0,isChecked:!be.value,onChange:vt=>{console.log(vt.target.checked),be.onChange(!vt.target.checked)}})}),e(ze,{label:"Delete",placement:"top",children:e(se,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:y.bind(null,h),children:e(Pt,{})})})]})]}),e(ze,{label:"Duplicate",placement:"top",children:e(se,{"aria-label":"Duplicate",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>T(h),children:e(Fs,{})})}),h<l.length-1&&e(ze,{label:"Move Down",placement:"top",children:e(se,{"aria-label":"DownIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>k(h,"down"),children:e(Ps,{})})}),h>0&&e(ze,{label:"Move Up",placement:"top",children:e(se,{"aria-label":"UpIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>k(h,"up"),children:e(Ws,{})})})]}),e(_t,{w:"full",p:1,children:r(J,{w:"full",borderRadius:"4px",children:[r(H,{isInvalid:!!(g&&((ce=g[h])==null?void 0:ce.port)),children:[r(X,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:c("hostsDialog.port")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.port.info")})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:String(a.port||"8080"),type:"number",...o.register(t+"."+h+".port")})]}),r(H,{isInvalid:!!(g&&((A=g[h])==null?void 0:A.sni)),children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.sni")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.sni.info")}),e(u,{fontSize:"xs",mt:"2",children:e(ht,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(O,{})}})}),e(u,{fontSize:"xs",children:e(ht,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(O,{})}})})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...o.register(t+"."+h+".sni")}),g&&((Q=g[h])==null?void 0:Q.sni)&&e(Ze,{children:($=(oe=g[h])==null?void 0:oe.sni)==null?void 0:$.message})]}),r(H,{isInvalid:!!(g&&((ae=g[h])==null?void 0:ae.host)),children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.host")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.host.info")}),e(u,{fontSize:"xs",mt:"2",children:e(ht,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(O,{})}})}),e(u,{fontSize:"xs",children:e(ht,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(O,{})}})})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...o.register(t+"."+h+".host")}),g&&((pe=g[h])==null?void 0:pe.host)&&e(Ze,{children:(ke=(de=g[h])==null?void 0:de.host)==null?void 0:ke.message})]}),r(H,{isInvalid:!!(g&&((Ae=g[h])==null?void 0:Ae.path)),children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.path")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.path.info")})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:"path (e.g. /vless)",...o.register(t+"."+h+".path")}),g&&((S=g[h])==null?void 0:S.path)&&e(Ze,{children:(re=(q=g[h])==null?void 0:q.path)==null?void 0:re.message})]}),r(H,{height:"66px",children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.security")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.security.info")})]})})]})]}),e(ur,{size:"sm",...o.register(t+"."+h+".security"),children:Us.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),r(H,{height:"66px",children:[e(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:c("hostsDialog.alpn")})}),e(ur,{size:"sm",...o.register(t+"."+h+".alpn"),children:Ms.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),r(H,{height:"66px",children:[e(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:c("hostsDialog.fingerprint")})}),e(ur,{size:"sm",...o.register(t+"."+h+".fingerprint"),children:Ts.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),r(H,{isInvalid:!!(g&&((xe=g[h])==null?void 0:xe.fragment_setting)),children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.fragment")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.fragment.info")}),e(u,{fontSize:"xs",pr:5,pt:2,pb:1,children:c("hostsDialog.fragment.info.examples")}),e(u,{fontSize:"xs",pr:5,children:"100-200,10-20,tlshello"}),e(u,{fontSize:"xs",pr:5,children:"100-200,10-20,1-3"}),e(u,{fontSize:"xs",pr:5,pt:"3",children:c("hostsDialog.fragment.info.attention")})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:"Fragment settings by pattern",...o.register(t+"."+h+".fragment_setting")}),g&&((ne=g[h])==null?void 0:ne.fragment_setting)&&e(Ze,{children:(ue=(ie=g[h])==null?void 0:ie.fragment_setting)==null?void 0:ue.message})]}),r(H,{isInvalid:!!(g&&((he=g[h])==null?void 0:he.noise_setting)),children:[r(X,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.noise")}),r(et,{isLazy:!0,placement:"right",children:[e(tt,{children:e(at,{})}),e(rt,{children:r(nt,{p:2,children:[e(it,{}),e(ot,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.noise.info")}),e(u,{fontSize:"xs",pr:5,pt:2,pb:1,children:c("hostsDialog.noise.info.examples")}),e(u,{fontSize:"xs",pr:5,children:"rand:10-20,10-20"}),e(u,{fontSize:"xs",pr:5,children:"rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25"}),e(u,{fontSize:"xs",pr:5,pt:"3",children:c("hostsDialog.noise.info.attention")})]})})]})]}),e(ct,{size:"sm",borderRadius:"4px",placeholder:"Noise settings by pattern",...o.register(t+"."+h+".noise_setting")}),g&&((Ve=g[h])==null?void 0:Ve.noise_setting)&&e(Ze,{children:(_=(Fe=g[h])==null?void 0:Fe.noise_setting)==null?void 0:_.message})]}),r(H,{isInvalid:!!(g&&((j=g[h])==null?void 0:j.use_sni_as_host)),children:[e(xt,{...o.register(t+"."+h+".use_sni_as_host"),children:e(X,{children:c("hostsDialog.useSniAsHost")})}),g&&((ee=g[h])==null?void 0:ee.use_sni_as_host)&&e(Ze,{children:(ye=(ge=g[h])==null?void 0:ge.use_sni_as_host)==null?void 0:ye.message})]}),e(H,{isInvalid:!!(g&&((Ne=g[h])==null?void 0:Ne.allowinsecure)),children:r(xt,{...o.register(t+"."+h+".allowinsecure"),name:t+"."+h+".allowinsecure",children:[e(X,{children:c("hostsDialog.allowinsecure")}),g&&((He=g[h])==null?void 0:He.allowinsecure)&&e(Ze,{children:(m=(Ge=g[h])==null?void 0:Ge.allowinsecure)==null?void 0:m.message})]})}),r(H,{isInvalid:!!(g&&((C=g[h])==null?void 0:C.mux_enable)),children:[e(xt,{...o.register(t+"."+h+".mux_enable"),children:e(X,{children:c("hostsDialog.muxEnable")})}),g&&((N=g[h])==null?void 0:N.mux_enable)&&e(Ze,{children:(Se=(K=g[h])==null?void 0:K.mux_enable)==null?void 0:Se.message})]}),r(H,{isInvalid:!!(g&&((_e=g[h])==null?void 0:_e.random_user_agent)),children:[e(xt,{...o.register(t+"."+h+".random_user_agent"),children:e(X,{children:c("hostsDialog.randomUserAgent")})}),g&&((Ye=g[h])==null?void 0:Ye.random_user_agent)&&e(Ze,{children:(We=(fe=g[h])==null?void 0:fe.random_user_agent)==null?void 0:We.message})]})]},h)})]})})]},d.id)},d.id)}),e(W,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:z,children:c("hostsDialog.addHost")})]})})]})},Hs=()=>{const{isEditingHosts:t,onEditingHosts:n,refetchUsers:i,inbounds:s}=V(),{isLoading:a,hosts:o,fetchHosts:l,isPostLoading:b,setHosts:y}=Ns(),f=je(),{t:w}=te(),[x,c]=p.exports.useState({});p.exports.useEffect(()=>{t&&l()},[t]);const g=kt({resolver:Rt(Os)});p.exports.useEffect(()=>{o&&t&&g.reset(o)},[o]);const z=()=>{c({}),n(!1)},T=d=>{y(d).then(()=>{f({title:w("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),i()}).catch(h=>{var G,E,F,M,P;(((G=h==null?void 0:h.response)==null?void 0:G.status)===409||((E=h==null?void 0:h.response)==null?void 0:E.status)===400)&&f({title:(M=(F=h.response)==null?void 0:F._data)==null?void 0:M.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((P=h==null?void 0:h.response)==null?void 0:P.status)===422&&Object.keys(h.response._data.detail).forEach(v=>{f({title:h.response._data.detail[v]+" ("+v+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},k=d=>{x[String(d)]?delete x[String(d)]:x[String(d)]={},c({...x})};return r(Le,{isOpen:t,onClose:z,children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:{base:2,md:3},w:{base:"calc(100vw - 16px)",md:"fit-content"},maxW:{base:"calc(100vw - 16px)",md:"3xl"},children:[e(Me,{pt:6,children:e($e,{color:"primary",children:e(Bs,{color:"white"})})}),e(Te,{mt:3}),e(Ee,{w:{base:"full",md:"440px"},maxW:"full",pb:3,pt:3,maxH:{base:"calc(100vh - 140px)",md:"70vh"},overflowY:"auto",children:e(Dn,{...g,children:r("form",{onSubmit:g.handleSubmit(T),children:[e(u,{mb:3,opacity:.8,fontSize:"sm",children:w("hostsDialog.title")}),a&&w("hostsDialog.loading"),!a&&o&&(Object.keys(o).length>0?e(Ft,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(x).map(d=>parseInt(d)),children:e(J,{w:"full",children:Object.keys(o).map((d,h)=>e(js,{toggleAccordion:()=>k(h),isOpen:x[String(h)],hostKey:d},d))})}):"No inbound found. Please check your Xray config file."),e(I,{justifyContent:"flex-end",py:2,children:e(W,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:b,disabled:b,children:w("hostsDialog.apply")})})]})})})]})]})},Tr=(t,n,i)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&i){Object.keys(t.response._data.detail).forEach(s=>i.setError(s,{message:t.response._data.detail[s]}));return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Er=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),$s=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:i,setDeletingNode:s}=Wt(),{t:a}=te(),o=je(),l=Ir(),b=()=>{s(null)},{isLoading:y,mutate:f}=Tt(n,{onSuccess:()=>{Er(a("deleteNode.deleteSuccess",{name:i&&i.name}),o),s(null),l.invalidateQueries(At),t&&t()},onError:w=>{Tr(w,o)}});return r(Le,{isCentered:!0,isOpen:!!i,onClose:b,size:"sm",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",children:[e(Me,{pt:6,children:e($e,{color:"red",children:e(Pt,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("deleteNode.title")}),i&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ht,{components:{b:e("b",{})},children:a("deleteNode.prompt",{name:i.name})})})]}),r(Ke,{display:"flex",children:[e(W,{size:"sm",onClick:b,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"red",onClick:()=>f(),leftIcon:y?e(Xe,{size:"xs"}):void 0,children:a("delete")})]})]})]})},Bt={baseStyle:{strokeWidth:"2px",w:4,h:4}},rn=L(fn,Bt),Vs=L(Oi,Bt),nn=L(ji,Bt),on=L(Un,Bt),Gs=L(Un,Bt),wr=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],ft={active:{statusColor:"green",bandWidthColor:"primary",icon:rn},connected:{statusColor:"green",bandWidthColor:"primary",icon:rn},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Vs},expired:{statusColor:"orange",bandWidthColor:"orange",icon:on},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Gs},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:on},limited:{statusColor:"red",bandWidthColor:"red",icon:nn},error:{statusColor:"red",bandWidthColor:"red",icon:nn}},lr=t=>{let n={status:"",time:""};if(t){le(t*1e3).utc().isAfter(le().utc())?n.status="expires":n.status="expired";const i=[],s=le.duration(le(t*1e3).utc().diff(le()));s.years()!=0&&i.push(Math.abs(s.years())+" year"+(Math.abs(s.years())!=1?"s":"")),s.months()!=0&&i.push(Math.abs(s.months())+" month"+(Math.abs(s.months())!=1?"s":"")),s.days()!=0&&i.push(Math.abs(s.days())+" day"+(Math.abs(s.days())!=1?"s":"")),i.length===0&&(s.hours()!=0&&i.push(Math.abs(s.hours())+" hour"+(Math.abs(s.hours())!=1?"s":"")),s.minutes()!=0&&i.push(Math.abs(s.minutes())+" min"+(Math.abs(s.minutes())!=1?"s":""))),n.time=i.join(", ")}return n},Ys=({expiryDate:t,status:n,compact:i=!1,showDetail:s=!0,extraText:a})=>{const{t:o}=te(),l=lr(t),b=ft[n].icon;return r(Oe,{children:[r(O,{colorScheme:ft[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:i?1:2,alignItems:"center",children:[e(b,{w:i?3:4}),s&&r(u,{textTransform:"capitalize",fontSize:i?".7rem":".875rem",lineHeight:i?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&o(`nodeModal.status.${n}`),a&&`: ${a}`]})]}),s&&t&&e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o(l.status,{time:l.time})})]})},zt=L(lt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),qs=L(zn,{baseStyle:{w:5,h:5}}),Zs=L(Hi,{baseStyle:{w:5,h:5,strokeWidth:2}}),Qs=({toggleAccordion:t,node:n})=>{const{updateNode:i,reconnectNode:s,setDeletingNode:a}=Wt(),{t:o}=te(),l=Ir(),b=je(),y=kt({defaultValues:n,resolver:Rt(Vn)}),f=a.bind(null,n),{isLoading:w,mutate:x}=Tt(i,{onSuccess:()=>{Er("Node updated successfully",b),l.invalidateQueries(At)},onError:T=>{Tr(T,b,y)}}),{isLoading:c,mutate:g}=Tt(s.bind(null,n),{onSuccess:()=>{l.invalidateQueries(At)}}),z=c?"connecting":n.status?n.status:"error";return r(yt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(St,{px:2,borderRadius:"3px",onClick:t,children:[r(I,{w:"full",justifyContent:"space-between",pr:2,children:[e(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:n.name}),r(I,{children:[n.xray_version&&e(O,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:r(u,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",n.xray_version]})}),n.status&&e(Ys,{status:z,compact:!0})]})]}),e(yr,{})]}),r(_t,{px:2,pb:2,children:[e(J,{pb:3,alignItems:"flex-start",children:z==="error"&&e(Et,{status:"error",size:"xs",children:r(U,{children:[r(I,{w:"full",children:[e(tr,{w:4}),e(u,{marginInlineEnd:0,children:n.message})]}),e(I,{justifyContent:"flex-end",w:"full",children:e(W,{size:"sm","aria-label":"reconnect node",leftIcon:e(Ur,{}),onClick:()=>g(),disabled:c,children:o(c?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(Qn,{form:y,mutate:x,isLoading:w,submitBtnText:o("nodes.editNode"),btnLeftAdornment:e(ze,{label:o("delete"),placement:"top",children:e(se,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:f,children:e(Pt,{})})})})]})]})},Xs=({toggleAccordion:t,resetAccordions:n})=>{const i=je(),{t:s}=te(),a=Ir(),{addNode:o}=Wt(),l=kt({resolver:Rt(Vn),defaultValues:{...es(),add_as_new_host:!1}}),{isLoading:b,mutate:y}=Tt(o,{onSuccess:()=>{Er(s("nodes.addNodeSuccess",{name:l.getValues("name")}),i),a.invalidateQueries(At),l.reset(),n()},onError:f=>{Tr(f,i,l)}});return r(yt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(St,{px:2,borderRadius:"3px",onClick:t,children:r(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(Zs,{display:"inline-block"})," ",e("span",{children:s("nodes.addNewMarzbanNode")})]})}),e(_t,{px:2,py:4,children:e(Qn,{form:l,mutate:y,isLoading:b,submitBtnText:s("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},Qn=({form:t,mutate:n,isLoading:i,submitBtnText:s,btnProps:a={},btnLeftAdornment:o,addAsHost:l=!1})=>{var g,z,T,k,d,h,G,E,F,M,P,v,B,Y,ce;const{t:b}=te(),[y,f]=p.exports.useState(!1),{data:w,isLoading:x}=dt({queryKey:"node-settings",queryFn:()=>R("/node/settings")});function c(A){if(document.body.createTextRange){const Q=document.body.createTextRange();Q.moveToElementText(A),Q.select()}else if(window.getSelection){const Q=window.getSelection(),oe=document.createRange();oe.selectNodeContents(A),Q.removeAllRanges(),Q.addRange(oe)}else console.warn("Could not select text in node: Unsupported browser.")}return e("form",{onSubmit:t.handleSubmit(A=>n(A)),children:r(J,{children:[w&&w.certificate&&e(Et,{status:"info",alignItems:"start",children:r(Mn,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e("span",{children:b("nodes.connection-hint")}),r(I,{justify:"end",py:2,children:[e(W,{as:"a",colorScheme:"primary",size:"xs",download:"ssl_client_cert.pem",href:URL.createObjectURL(new Blob([w.certificate],{type:"text/plain"})),children:b("nodes.download-certificate")}),e(ze,{placement:"top",label:b("nodes.show-certificate"),children:e(se,{"aria-label":b("nodes.show-certificate"),onClick:f.bind(null,!y),colorScheme:"whiteAlpha",color:"primary",size:"xs",children:y?e(Vi,{width:"15px"}):e($i,{width:"15px"})})})]}),e(Tn,{in:y,animateOpacity:!0,children:e(u,{bg:"rgba(255,255,255,.5)",_dark:{bg:"rgba(255,255,255,.2)"},rounded:"md",p:"2",lineHeight:"1.2",fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",onClick:A=>{c(A.target)},children:w.certificate})})]})}),r(I,{w:"full",children:[e(H,{children:e(zt,{label:b("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...t.register("name"),error:(T=(z=(g=t.formState)==null?void 0:g.errors)==null?void 0:z.name)==null?void 0:T.message})}),e(I,{px:1,children:e(Je,{name:"status",control:t.control,render:({field:A})=>e(ze,{placement:"top",label:`${b("usersTable.status")}: `+(A.value!=="disabled"?b("active"):b("disabled")),textTransform:"capitalize",children:e(U,{mt:"6",children:e(er,{colorScheme:"primary",isChecked:A.value!=="disabled",onChange:Q=>{Q.target.checked?A.onChange("connecting"):A.onChange("disabled")}})})},A.value)})})]}),e(I,{alignItems:"flex-start",w:"100%",children:e(U,{w:"100%",children:e(zt,{label:b("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...t.register("address"),error:(h=(d=(k=t.formState)==null?void 0:k.errors)==null?void 0:d.address)==null?void 0:h.message})})}),r(I,{alignItems:"flex-start",w:"100%",children:[e(U,{children:e(zt,{label:b("nodes.nodePort"),size:"sm",placeholder:"62050",...t.register("port"),error:(F=(E=(G=t.formState)==null?void 0:G.errors)==null?void 0:E.port)==null?void 0:F.message})}),e(U,{children:e(zt,{label:b("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...t.register("api_port"),error:(v=(P=(M=t.formState)==null?void 0:M.errors)==null?void 0:P.api_port)==null?void 0:v.message})}),e(U,{children:e(zt,{label:b("nodes.usageCoefficient"),size:"sm",placeholder:"1",...t.register("usage_coefficient"),error:(ce=(Y=(B=t.formState)==null?void 0:B.errors)==null?void 0:Y.usage_coefficient)==null?void 0:ce.message})})]}),l&&e(H,{py:1,children:e(xt,{...t.register("add_as_new_host"),children:e(X,{m:0,children:b("nodes.addHostForEveryInbound")})})}),r(I,{w:"full",children:[o,e(W,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:i,...a,children:s})]})]})})},Js=()=>{const{isEditingNodes:t,onEditingNodes:n}=V(),{t:i}=te(),[s,a]=p.exports.useState({}),{data:o,isLoading:l}=Gn(),b=()=>{a({}),n(!1)},y=f=>{s[String(f)]?delete s[String(f)]:s[String(f)]={},a({...s})};return r(Oe,{children:[r(Le,{isOpen:t,onClose:b,children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:{base:2,md:3},w:{base:"calc(100vw - 16px)",md:"fit-content"},maxW:{base:"calc(100vw - 16px)",md:"3xl"},children:[e(Me,{pt:6,children:e($e,{color:"primary",children:e(qs,{color:"white"})})}),e(Te,{mt:3}),r(Ee,{w:{base:"full",md:"440px"},maxW:"full",pb:6,pt:3,maxH:{base:"calc(100vh - 140px)",md:"70vh"},overflowY:"auto",children:[e(u,{mb:3,opacity:.8,fontSize:"sm",children:i("nodes.title")}),l&&"loading...",e(Ft,{w:"full",allowToggle:!0,index:Object.keys(s).map(f=>parseInt(f)),children:r(J,{w:"full",children:[!l&&o&&o.map((f,w)=>e(Qs,{toggleAccordion:()=>y(w),node:f},f.name)),e(Xs,{toggleAccordion:()=>y((o||[]).length),resetAccordions:()=>a({})})]})})]})]})]}),e($s,{deleteCallback:()=>a({})})]})};function Ks(t){const n=360/t,i=90,s=47,a=[];for(let o=0;o<t;o++){const l=o*n%360+140,b=ea(l,i,s);a.push(b)}return a}function ea(t,n,i){t/=360,n/=100,i/=100;let s,a,o;if(n===0)s=a=o=i;else{const b=(w,x,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?w+(x-w)*6*c:c<.5?x:c<.6666666666666666?w+(x-w)*(.6666666666666666-c)*6:w),y=i<.5?i*(1+n):i+n-i*n,f=2*i-y;s=Math.round(b(f,y,t+1/3)*255),a=Math.round(b(f,y,t)*255),o=Math.round(b(f,y,t-1/3)*255)}const l=b=>{const y=b.toString(16);return y.length===1?"0"+y:y};return`#${l(s)}${l(a)}${l(o)}`}const sn=({border:t,...n})=>{const{getInputProps:i,getRadioProps:s}=Ji(n),a=gt({base:"xs",md:"sm"});return r(U,{as:"label",children:[e("input",{...i()}),e(U,{...s(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:a,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},Xn=({onChange:t,defaultValue:n,...i})=>{const{t:s,i18n:a}=te();wt();const o=gt({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),l={h:"hour",d:"day",w:"week",m:"month",y:"year"},b=gt({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:y,getRadioProps:f,setValue:w}=Gi({name:"filter",defaultValue:n,onChange:A=>{if(A==="custom")return;g(),o.indexOf(A)>=0?(k(s("userDialog.custom")),h(!1)):(k(s("userDialog.custom")+` (${A})`),h(!0));const Q=Number(A.substring(0,A.length-1)),oe=l[A[A.length-1]];t(A,{start:le().utc().subtract(Q,oe).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:x,onOpen:c,onClose:g}=Yi(),z=p.exports.useRef(null);qi({ref:z,handler:g});const[T,k]=p.exports.useState(s("userDialog.custom")),[d,h]=p.exports.useState(!1),[G,E]=p.exports.useState(0),F=gt({base:1,md:2}),M=gt({base:"xs",md:"sm"}),[P,v]=p.exports.useState(null),[B,Y]=p.exports.useState(null),ce=A=>{const[Q,oe]=A;B&&!oe?(v(null),Y(null)):(v(Q),Y(oe),Q&&oe&&(g(),t("custom",{start:le(Q).format("YYYY-MM-DDT00:00:00"),end:le(oe).format("YYYY-MM-DDT23:59:59")})))};return r(J,{...i,children:[G==0&&r(zr,{...y(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[o.map(A=>e(sn,{...f({value:A}),children:A},A)),e(U,{onClick:()=>{v(null),Y(null),c()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:M,px:3,py:1,bg:d?"primary.500":"unset",color:d?"white":"unset",borderColor:d?"primary.500":"unset",children:r(I,{children:[e(u,{children:T}),e(cr,{as:Rr,boxSize:"18px"})]})})]}),G==1&&r(I,{onClick:c,cursor:"pointer",fontSize:M,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(u,{w:"full",color:P?"unset":"gray.500",children:P?le(P).format("YYYY-MM-DD (00:00)"):s("userDialog.startDate")}),e(cr,{as:En,boxSize:"18px"}),e(u,{w:"full",color:B?"unset":"gray.500",children:B?le(B).format("YYYY-MM-DD (23:59)"):s("userDialog.endDate")}),e(cr,{as:Rr,boxSize:"18px"})]}),e(J,{ref:z,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:x?"unset":"none",children:r(Zi,{onChange:A=>E(A),children:[r(Qi,{children:[e(Fr,{fontSize:M,children:s("userDialog.relative")}),e(Fr,{fontSize:M,children:s("userDialog.absolute")})]}),r(Xi,{children:[e(Wr,{children:b.map(A=>e(J,{alignItems:"start",pl:2,pr:2,children:r(I,{justifyItems:"flex-start",mb:4,children:[e(u,{fontSize:M,minW:"60px",children:s("userDialog."+A.title)}),A.options.map(Q=>e(sn,{border:!0,...f({value:Q}),children:Q},Q+".custom"))]})},A.title))}),e(Wr,{className:"datepicker-panel",children:e(J,{children:e(An,{locale:a.language.toLocaleLowerCase(),selected:P,onChange:ce,startDate:P,endDate:B,selectsRange:!0,maxDate:new Date,monthsShown:F,peekNextMonth:!1,inline:!0})})})]})]})})]})};function nr(t,n,i=[],s=[]){const a=Ie(i.reduce((o,l)=>o+=l,0));return{series:i,options:{labels:s,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${a}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(o,{seriesIndex:l,w:b})=>Ie(b.config.series[l],1)},tooltip:{custom:({series:o,seriesIndex:l,dataPointIndex:b,w:y})=>{const f=Ie(o[l],1),w=Math.max(o.reduce((c,g)=>c+=g),1),x=Math.round(o[l]/w*1e3)/10+"%";return`
            <div style="
                    background-color: ${y.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${y.config.labels[l]}: <b>${x}, ${f}</b>
            </div>
          `}},colors:Ks(i.length)}}}const ta=L(ir,{baseStyle:{w:5,h:5}}),ra=()=>{const{isShowingNodesUsage:t,onShowingNodesUsage:n}=V(),{fetchNodesUsage:i}=Wt(),{t:s}=te(),[a,o]=p.exports.useState(!1),{colorMode:l}=wt(),b=s("userDialog.total"),[y,f]=p.exports.useState(nr(l,b)),[w,x]=p.exports.useState("1m"),c=T=>{i(T).then(k=>{const d=[],h=[];for(const G in k.usages){const E=k.usages[G];h.push(E.uplink+E.downlink),d.push(E.node_name)}f(nr(l,b,h,d))})};p.exports.useEffect(()=>{t&&c({start:le().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[t]);const g=()=>{n(!1),x("1m")},z=a;return r(Le,{isOpen:t,onClose:g,size:"2xl",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",w:"full",children:[e(Me,{pt:6,children:r(I,{gap:2,children:[e($e,{color:"primary",children:e(ta,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:s("header.nodesUsage")})]})}),e(Te,{mt:3,disabled:z}),e(Ee,{children:r(J,{gap:4,children:[e(Xn,{defaultValue:w,onChange:(T,k)=>{x(T),c(k)}}),e(U,{justifySelf:"center",w:"full",maxW:"300px",mt:"4",children:e(p.exports.Suspense,{fallback:e(_n,{isIndeterminate:!0}),children:e(Nn,{options:y.options,series:y.series,type:"donut",height:"500px"})})})]})}),e(Ke,{mt:"3"})]})]})},an=L(Ki),na=L(En,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),ia=L(eo,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),oa=L(Rn,{baseStyle:{w:5,h:5}}),sa=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:i,subscribeUrl:s}=V(),a=t!==null,[o,l]=p.exports.useState(0),{t:b}=te(),y=()=>{n(null),i(null)},f=String(s).startsWith("/")?window.location.origin+s:String(s);return r(Le,{isOpen:a,onClose:y,children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Me,{pt:6,children:e($e,{color:"primary",children:e(oa,{color:"white"})})}),e(Te,{mt:3}),t&&r(Ee,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[s&&r(J,{children:[e(an,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:f,bg:"white"}),e(u,{display:"block",textAlign:"center",pb:3,mt:1,children:b("qrcodeDialog.sublink")})]}),r(U,{w:"300px",children:[e(to,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:l,onInit:()=>l(0),nextArrow:e(se,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(na,{})}),prevArrow:e(se,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(ia,{})}),children:t.map((w,x)=>e(I,{children:e(an,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:w,bg:"white"})},x))}),r(u,{display:"block",textAlign:"center",pb:3,mt:1,children:[o+1," / ",t.length]})]})]})]})]})},aa=L(Ln,{baseStyle:{w:5,h:5}}),la=()=>{const[t,n]=p.exports.useState(!1),{isResetingAllUsage:i,onResetAllUsage:s,resetAllUsage:a}=V(),{t:o}=te(),l=je(),b=()=>{s(!1)},y=()=>{n(!0),a().then(()=>{l({title:o("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:o("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)})};return r(Le,{isCentered:!0,isOpen:i,onClose:b,size:"sm",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",children:[e(Me,{pt:6,children:e($e,{color:"red",children:e(aa,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:o("resetAllUsage.title")}),i&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:o("resetAllUsage.prompt")})]}),r(Ke,{display:"flex",children:[e(W,{size:"sm",onClick:b,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:t?e(Xe,{size:"xs"}):void 0,children:o("reset")})]})]})]})},ca=L(sr,{baseStyle:{w:5,h:5}}),da=()=>{const[t,n]=p.exports.useState(!1),{resetUsageUser:i,resetDataUsage:s}=V(),{t:a}=te(),o=je(),l=()=>{V.setState({resetUsageUser:null})},b=()=>{i&&(n(!0),s(i).then(()=>{o({title:a("resetUserUsage.success",{username:i.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{o({title:a("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return r(Le,{isCentered:!0,isOpen:!!i,onClose:l,size:"sm",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",children:[e(Me,{pt:6,children:e($e,{color:"blue",children:e(ca,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("resetUserUsage.title")}),i&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ht,{components:{b:e("b",{})},children:a("resetUserUsage.prompt",{username:i.username})})})]}),r(Ke,{display:"flex",children:[e(W,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"blue",onClick:b,leftIcon:t?e(Xe,{size:"xs"}):void 0,children:a("reset")})]})]})]})},ua=L(sr,{baseStyle:{w:5,h:5}}),ha=()=>{const[t,n]=p.exports.useState(!1),{revokeSubscriptionUser:i,revokeSubscription:s}=V(),{t:a}=te(),o=je(),l=()=>{V.setState({revokeSubscriptionUser:null})},b=()=>{i&&(n(!0),s(i).then(()=>{o({title:a("revokeUserSub.success",{username:i.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{o({title:a("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return r(Le,{isCentered:!0,isOpen:!!i,onClose:l,size:"sm",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(Ue,{mx:"3",children:[e(Me,{pt:6,children:e($e,{color:"blue",children:e(ua,{})})}),e(Te,{mt:3}),r(Ee,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:a("revokeUserSub.title")}),i&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ht,{components:{b:e("b",{})},children:a("revokeUserSub.prompt",{username:i.username})})})]}),r(Ke,{display:"flex",children:[e(W,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(W,{size:"sm",w:"full",colorScheme:"blue",onClick:b,leftIcon:t?e(Xe,{size:"xs"}):void 0,children:a("revoke")})]})]})]})},pa=L(ro,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),ma=({inbound:t,...n})=>{const{getCheckboxProps:i,getInputProps:s,getLabelProps:a,htmlProps:o}=Wn(n),l=s();return r(U,{as:"label",children:[e("input",{...l}),r(U,{w:"fll",position:"relative",...o,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...i(),children:[e(xt,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:l.checked,pointerEvents:"none",flexGrow:1,children:e(I,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:r(u,{isTruncated:!0,...a(),fontSize:"xs",children:[t.tag," ",r(u,{as:"span",children:["(",t.network,")"]})]})})}),t.tls&&t.tls!="none"&&e(O,{fontSize:"xs",opacity:".8",size:"xs",children:t.tls})]})]})},ga=({disabled:t,title:n,description:i,toggleAccordion:s,isSelected:a,...o})=>{const l=vr(),{inbounds:b}=V(),{getCheckboxProps:y,getInputProps:f,getLabelProps:w,htmlProps:x}=Wn(o),c=f(),[g]=Pn({name:[`inbounds.${n}`],control:l.control}),{getCheckboxProps:z}=Fn({value:g,onChange:h=>{if(l.setValue(`inbounds.${n}`,h),h.length===0){const G=l.getValues("selected_proxies");l.setValue("selected_proxies",G.filter(E=>E!==n)),s()}}}),T=g&&a&&(V.getState().inbounds.get(n)||[]).length!==g.length,k=(V.getState().inbounds.get(n)||[]).length>0,d=!a&&!k;return r(yt,{isDisabled:!k,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:d?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:d?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...y(),children:[r(U,{as:d?"span":"label",position:"relative",children:[T&&e(U,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{...c}),r(U,{w:"fll",position:"relative",...x,borderRadius:"md",cursor:d?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...y(),children:[e(St,{display:c.checked&&k?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:s,children:e(se,{size:"sm","aria-label":"inbound settings",children:e(pa,{})})}),e(u,{fontSize:"sm",color:d?"gray.400":"gray.700",_dark:{color:d?"gray.500":"gray.300"},...w(),children:n}),e(u,{fontWeight:"medium",color:d?"gray.400":"gray.600",_dark:{color:d?"gray.500":"gray.400"},fontSize:"xs",children:i})]})]}),e(_t,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:c.checked&&"gray.750"},children:r(J,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[r(J,{alignItems:"flex-start",w:"full",children:[e(u,{fontSize:"sm",children:Ce("inbound")}),e(zr,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(b.get(n)||[]).map(h=>e(ma,{...z({value:h.tag}),inbound:h},h.tag))})]}),n==="vmess"&&a&&e(J,{alignItems:"flex-start",w:"full",children:r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"ID"}),e(ut,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ce("userDialog.generatedByDefault"),...l.register("proxies.vmess.id")})]})}),n==="vless"&&a&&r(J,{alignItems:"flex-start",w:"full",children:[r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"ID"}),e(ut,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ce("userDialog.generatedByDefault"),...l.register("proxies.vless.id")})]}),r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"Flow"}),e(Re,{fontSize:"xs",size:"sm",borderRadius:"6px",...l.register("proxies.vless.flow"),children:Es.map(h=>e("option",{value:h.value,children:h.title},h.title))})]})]}),n==="trojan"&&a&&e(J,{alignItems:"flex-start",w:"full",children:r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Ce("password")}),e(ut,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ce("userDialog.generatedByDefault"),...l.register("proxies.trojan.password")})]})}),n==="shadowsocks"&&a&&r(J,{alignItems:"flex-start",w:"full",children:[r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Ce("password")}),e(ut,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ce("userDialog.generatedByDefault"),...l.register("proxies.shadowsocks.password")})]}),r(H,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Ce("userDialog.method")}),e(Re,{fontSize:"xs",size:"sm",borderRadius:"6px",...l.register("proxies.shadowsocks.method"),children:As.map(h=>e("option",{value:h,children:h},h))})]})]})]})})]})},fa=p.exports.forwardRef(({name:t,list:n,onChange:i,disabled:s,...a},o)=>{const l=vr(),[b,y]=p.exports.useState([]),f=x=>{b.includes(x)?b.splice(b.indexOf(x),1):b.push(x),y([...b])},{getCheckboxProps:w}=Fn({value:a.value,onChange:x=>{var g;const c=x.filter(z=>!a.value.includes(z));c[0]&&l.setValue(`inbounds.${c[0]}`,(g=V.getState().inbounds.get(c[0]))==null?void 0:g.map(z=>z.tag)),y(b.filter(z=>x.find(T=>T===n[z].title))),i({target:{value:x,name:t}})}});return e(Ft,{allowToggle:!0,index:b,children:e(zr,{ref:o,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:n.map((x,c)=>e(ga,{toggleAccordion:f.bind(null,c),disabled:s,title:x.title,description:x.description,isSelected:!!a.value.find(g=>g===x.title),...w({value:x.title})},x.title))})})}),ba=L(no,{baseStyle:{w:5,h:5}}),xa=L(Bn,{baseStyle:{w:5,h:5}}),ya=L(ir,{baseStyle:{w:5,h:5}}),Sa=t=>({...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,selected_proxies:Object.keys(t.proxies),unique_ip_limit:"3",v2box_hwid:""}),hr=()=>{const t=Object.fromEntries(V.getState().inbounds),n={};for(const i in t)n[i]=t[i].map(s=>s.tag);return{selected_proxies:Object.keys(t),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",unique_ip_limit:"3",v2box_hwid:"",inbounds:n,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}}}},_a=(t,n)=>{const i=t.reduce((s,a)=>({...s,[a]:{}}),{});return n&&t.forEach(s=>{n[s]&&(i[s]=n[s])}),i},Lt={username:D.string().min(1,{message:"Required"}),selected_proxies:D.array(D.string()).refine(t=>t.length>0,{message:"userDialog.selectOneProtocol"}),note:D.string().nullable(),unique_ip_limit:D.string().default("3"),v2box_hwid:D.string().default(""),proxies:D.record(D.string(),D.record(D.string(),D.any())).transform(t=>{const n=(i,s)=>{i&&i[s]===""&&delete i[s]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:D.string().min(0).or(D.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:D.number().nullable(),data_limit_reset_strategy:D.string(),inbounds:D.record(D.string(),D.array(D.string())).transform(t=>(Object.keys(t).forEach(n=>{var i;Array.isArray(t[n])&&!((i=t[n])!=null&&i.length)&&delete t[n]}),t))},wa=D.discriminatedUnion("status",[D.object({status:D.literal("active"),...Lt}),D.object({status:D.literal("disabled"),...Lt}),D.object({status:D.literal("limited"),...Lt}),D.object({status:D.literal("expired"),...Lt}),D.object({status:D.literal("on_hold"),on_hold_expire_duration:D.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...Lt})]),ka=()=>{var ie,ue,he,Ve,Fe;const{editingUser:t,isCreatingNewUser:n,onCreateUser:i,editUser:s,fetchUserUsage:a,onEditingUser:o,createUser:l,onDeletingUser:b,refetchUsers:y}=V(),f=!!t,w=n||f,[x,c]=p.exports.useState(!1),[g,z]=p.exports.useState(""),T=je(),{t:k,i18n:d}=te(),{colorMode:h}=wt(),[G,E]=p.exports.useState(!1),[F,M]=p.exports.useState(3),P=()=>{E(_=>!_)},v=kt({defaultValues:hr(),resolver:Rt(wa)});p.exports.useEffect(()=>V.subscribe(_=>_.inbounds,()=>{v.reset(hr())}),[]);const[B,Y]=Pn({control:v.control,name:["data_limit","status"]}),ce=k("userDialog.total"),[A,Q]=p.exports.useState(nr(h,ce)),[oe,$]=p.exports.useState("1m"),ae=_=>{a(t,_).then(j=>{const ee=[],ge=[];for(const ye in j.usages)ge.push(j.usages[ye].used_traffic),ee.push(j.usages[ye].node_name);Q(nr(h,ce,ge,ee))})};p.exports.useEffect(()=>{!w||Promise.allSettled([R("/xpert/ip-limit-cap"),R("/admin"),R("/admins")]).then(_=>{const j=_[0].status==="fulfilled"?_[0].value:null,ee=_[1].status==="fulfilled"?_[1].value:null,ge=_[2].status==="fulfilled"?_[2].value:null,ye=Number((j==null?void 0:j.max_limit)||3),Ne=String((ee==null?void 0:ee.username)||""),He=Array.isArray(ge)?ge.find(Ge=>String((Ge==null?void 0:Ge.username)||"")===Ne):null;if(He&&(He==null?void 0:He.is_sudo)===!1){M(3);return}if(ye>=5&&(ee==null?void 0:ee.is_sudo)===!0){M(5);return}M(3)}).catch(()=>M(3))},[w]),p.exports.useEffect(()=>{t&&(v.reset(Sa(t)),R(`/xpert/ip-limit/${encodeURIComponent(t.username)}`).then(_=>{var ye;const j=Number((_==null?void 0:_.max_limit)||3),ee=Number((ye=_==null?void 0:_.limit)!=null?ye:3);M(j);const ge=Math.min(Math.max(1,ee),j);v.setValue("unique_ip_limit",String(ge))}).catch(()=>{M(3),v.setValue("unique_ip_limit","3")}),R(`/xpert/v2box-hwid/${encodeURIComponent(t.username)}`).then(_=>{v.setValue("v2box_hwid",(_==null?void 0:_.device_id)||"")}).catch(()=>{v.setValue("v2box_hwid","")}),ae({start:le().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t]);const pe=_=>{c(!0);const j={edited:s,created:l},ee=f?"edited":"created";z(null);const{selected_proxies:ge,unique_ip_limit:ye,v2box_hwid:Ne,...He}=_;let Ge={...He,data_limit:_.data_limit,proxies:_a(ge,_.proxies),data_limit_reset_strategy:_.data_limit&&_.data_limit>0?_.data_limit_reset_strategy:"no_reset",status:_.status==="active"||_.status==="disabled"||_.status==="on_hold"?_.status:"active"};j[ee](Ge).then(async()=>{const m=Number(ye||"3");try{await R("/xpert/ip-limit",{method:"POST",body:{username:_.username,limit:m}})}catch{T({title:k("userDialog.uniqueIpLimitFailed"),status:"warning",isClosable:!0,position:"top",duration:3e3})}try{await R("/xpert/v2box-hwid",{method:"POST",body:{username:_.username,device_id:(Ne||"").trim()||null}})}catch{T({title:k("userDialog.v2boxHwidLimitFailed"),status:"warning",isClosable:!0,position:"top",duration:3e3})}y(),T({title:k(f?"userDialog.userEdited":"userDialog.userCreated",{username:_.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),de()}).catch(m=>{var C,N,K,Se,_e,Ye,fe;(((C=m==null?void 0:m.response)==null?void 0:C.status)===409||((N=m==null?void 0:m.response)==null?void 0:N.status)===400)&&z((Se=(K=m==null?void 0:m.response)==null?void 0:K._data)==null?void 0:Se.detail),((_e=m==null?void 0:m.response)==null?void 0:_e.status)===422?Object.keys(m.response._data.detail).forEach(We=>{z(m==null?void 0:m.response._data.detail[We]),v.setError(We,{type:"custom",message:m==null?void 0:m.response._data.detail[We]})}):z(((fe=(Ye=m==null?void 0:m.response)==null?void 0:Ye._data)==null?void 0:fe.detail)||"Unknown error occurred")}).finally(()=>{c(!1)})},de=()=>{v.reset(hr()),i(!1),o(null),z(null),E(!1),$("1m")},ke=()=>{V.setState({resetUsageUser:t})},Ae=()=>{V.setState({revokeSubscriptionUser:t})},S=x,q=Y==="on_hold",[re,xe]=p.exports.useState(!1),ne=()=>{xe(!0);let _="";const j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ee=j.length;let ge=0;for(;ge<6;)_+=j.charAt(Math.floor(Math.random()*ee)),ge+=1;return _};return r(Le,{isOpen:w,onClose:de,size:"2xl",children:[e(De,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Dn,{...v,children:e(Ue,{mx:"3",children:r("form",{onSubmit:v.handleSubmit(pe),children:[e(Me,{pt:6,children:r(I,{gap:2,children:[e($e,{color:"primary",children:f?e(xa,{color:"white"}):e(ba,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:k(f?"userDialog.editUserTitle":"createNewUser")})]})}),e(Te,{mt:3,disabled:S}),r(Ee,{children:[r(kn,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(Ut,{children:r(J,{justifyContent:"space-between",children:[r(Mt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[r(Mt,{flexDirection:"row",w:"full",gap:2,children:[r(H,{mb:"10px",children:[e(X,{children:r(Mt,{gap:2,alignItems:"center",children:[k("username"),!f&&e(Ur,{cursor:"pointer",className:Nt({"animate-spin":re}),onClick:()=>{const _=ne();v.setValue("username",_),setTimeout(()=>{xe(!1)},350)}})]})}),r(I,{children:[e(lt,{size:"sm",type:"text",borderRadius:"6px",error:(ie=v.formState.errors.username)==null?void 0:ie.message,disabled:S||f,...v.register("username")}),f&&e(I,{px:1,children:e(Je,{name:"status",control:v.control,render:({field:_})=>e(ze,{placement:"top",label:"status: "+k(`status.${_.value}`),textTransform:"capitalize",children:e(U,{children:e(er,{colorScheme:"primary",isChecked:_.value==="active",onChange:j=>{j.target.checked?_.onChange("active"):_.onChange("disabled")}})})})})})]})]}),!f&&r(H,{flex:"1",children:[e(X,{whiteSpace:"nowrap",children:k("userDialog.onHold")}),e(Je,{name:"status",control:v.control,render:({field:_})=>{const j=_.value;return e(Oe,{children:j?e(er,{colorScheme:"primary",isChecked:j==="on_hold",onChange:ee=>{ee.target.checked?_.onChange("on_hold"):_.onChange("active")}}):""})}})]})]}),r(H,{mb:"10px",children:[e(X,{children:k("userDialog.dataLimit")}),e(Je,{control:v.control,name:"data_limit",render:({field:_})=>{var j;return e(lt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:_.onChange,disabled:S,error:(j=v.formState.errors.data_limit)==null?void 0:j.message,value:_.value?String(_.value):""})}})]}),e(Tn,{in:!!(B&&B>0),animateOpacity:!0,style:{width:"100%"},children:r(H,{height:"66px",children:[e(X,{children:k("userDialog.periodicUsageReset")}),e(Je,{control:v.control,name:"data_limit_reset_strategy",render:({field:_})=>e(Re,{size:"sm",..._,disabled:S,bg:S?"gray.100":"transparent",_dark:{bg:S?"gray.600":"transparent"},sx:{option:{backgroundColor:h==="dark"?"#222C3B":"white"}},children:wr.map(j=>e("option",{value:j.value,children:k("userDialog.resetStrategy"+j.title)},j.value))})})]})}),r(H,{mb:"10px",children:[e(X,{children:k(q?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),q&&e(Je,{control:v.control,name:"on_hold_expire_duration",render:({field:_})=>{var j;return e(lt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:ee=>{v.setValue("expire",null),_.onChange({target:{value:ee}})},disabled:S,error:(j=v.formState.errors.on_hold_expire_duration)==null?void 0:j.message,value:_.value?String(_.value):""})}}),!q&&e(Je,{name:"expire",control:v.control,render:({field:_})=>{var ye;function j(Ne){return le(le(Ne*1e3).utc()).toDate()}const{status:ee,time:ge}=lr(_.value);return r(Oe,{children:[e(An,{locale:d.language.toLocaleLowerCase(),dateFormat:k("dateFormat"),minDate:new Date,selected:_.value?j(_.value):void 0,onChange:Ne=>{v.setValue("on_hold_expire_duration",null),_.onChange({target:{value:Ne?le(le(Ne).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(lt,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:S,error:(ye=v.formState.errors.expire)==null?void 0:ye.message})}),_.value?e(io,{children:k(ee,{time:ge})}):""]})}})]}),r(H,{mb:"10px",isInvalid:!!v.formState.errors.note,children:[e(X,{children:k("userDialog.note")}),e(br,{...v.register("note"),minH:"70px"}),e(Kt,{children:(he=(ue=v.formState.errors)==null?void 0:ue.note)==null?void 0:he.message})]}),r(H,{mb:"10px",children:[e(X,{children:k("userDialog.uniqueIpLimit")}),e(Re,{size:"sm",...v.register("unique_ip_limit"),children:Array.from({length:F},(_,j)=>j+1).map(_=>e("option",{value:String(_),children:_},_))})]})]}),g&&r(Et,{status:"error",display:{base:"none",md:"flex"},children:[e(tr,{}),g]})]})}),r(Ut,{children:[r(H,{isInvalid:!!((Ve=v.formState.errors.selected_proxies)!=null&&Ve.message),children:[e(X,{children:k("userDialog.protocols")}),e(Je,{control:v.control,name:"selected_proxies",render:({field:_})=>e(fa,{list:[{title:"vmess",description:k("userDialog.vmessDesc")},{title:"vless",description:k("userDialog.vlessDesc")},{title:"trojan",description:k("userDialog.trojanDesc")},{title:"shadowsocks",description:k("userDialog.shadowsocksDesc")}],disabled:S,..._})}),e(Kt,{children:k((Fe=v.formState.errors.selected_proxies)==null?void 0:Fe.message)})]}),r(H,{mt:3,mb:"10px",children:[e(X,{children:k("userDialog.v2boxHwidLimit")}),e(lt,{mt:2,size:"sm",placeholder:k("userDialog.v2boxHwidPlaceholder"),...v.register("v2box_hwid")}),f&&e(W,{mt:2,size:"xs",variant:"outline",onClick:async()=>{try{await R("/xpert/v2box-hwid/reset",{method:"POST",body:{username:v.getValues("username")}}),T({title:k("userDialog.v2boxHwidResetDone"),status:"success",isClosable:!0,position:"top",duration:2500})}catch{T({title:k("userDialog.v2boxHwidResetFailed"),status:"warning",isClosable:!0,position:"top",duration:2500})}},children:k("userDialog.v2boxHwidReset")})]})]}),f&&G&&e(Ut,{pt:6,colSpan:{base:1,md:2},children:r(J,{gap:4,children:[e(Xn,{defaultValue:oe,onChange:(_,j)=>{$(_),ae(j)}}),e(U,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Nn,{options:A.options,series:A.series,type:"donut"})})]})})]}),g&&r(Et,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(tr,{}),g]})]}),e(Ke,{mt:"3",children:r(I,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(I,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:f&&r(Oe,{children:[e(ze,{label:k("delete"),placement:"top",children:e(se,{"aria-label":"Delete",size:"sm",onClick:()=>{b(t),de()},children:e(Pt,{})})}),e(ze,{label:k("userDialog.usage"),placement:"top",children:e(se,{"aria-label":"usage",size:"sm",onClick:P,children:e(ya,{})})}),e(W,{onClick:ke,size:"sm",children:k("userDialog.resetUsage")}),e(W,{onClick:Ae,size:"sm",children:k("userDialog.revokeSubscription")})]})}),e(I,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(W,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:x?e(Xe,{size:"xs"}):void 0,disabled:S,children:k(f?"userDialog.editUser":"createUser")})})]})})]})})})]})},Ca=t=>p.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},p.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),p.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),p.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),p.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),p.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),p.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),p.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),p.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),p.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),pr=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},ln=({lastOnline:t,lastFetch:n,firstFetch:i})=>{const s=Math.floor(Date.now()/1e3),a=pr(t),o=pr(n),l=pr(i);return!t&&!n&&!i?e(U,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):a!==null&&s-a<=60?e(U,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):l!==null&&o!==null&&l===o?e(U,{bg:"blue.400",_dark:{bg:"blue.500"},className:"circle"}):o!==null?e(U,{bg:"cyan.300",_dark:{bg:"cyan.500"},className:"circle"}):e(U,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},va=t=>{if(!t)return null;const n=new Date(t+"Z");return Math.floor(n.getTime()/1e3)},cn=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),i=va(t),s=i?n-i:null,a=i?lr(i):{status:"",time:"Not Connected Yet"};return e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:s&&s<=60?"Online":s?`${a.time} ago`:a.time})},Ia=t=>{if(!t)return null;const n=new Date(t+"Z");return Math.floor(n.getTime()/1e3)},za=(t,n)=>{const i=Math.max(0,t),s=Math.floor(i/86400),a=Math.floor(i%86400/3600),o=Math.floor(i%3600/60),l=n.startsWith("ru"),b=n.startsWith("fa"),y=n.startsWith("zh"),f=l?{d:"\u0434",h:"\u0447",m:"\u043C"}:b?{d:"\u0631\u0648\u0632",h:"\u0633",m:"\u062F"}:y?{d:"\u5929",h:"\u65F6",m:"\u5206"}:{d:"d",h:"h",m:"m"};return s>0?`${s}${f.d} ${a}${f.h}`:a>0?`${a}${f.h} ${o}${f.m}`:`${Math.max(1,o)}${f.m}`},dn=({lastFetch:t})=>{const{t:n,i18n:i}=te(),s=i.language||"en",a="usersTable.lastSubscriptionFetch",o="usersTable.never",l=s.startsWith("ru")?"\u0417\u0430\u043F\u0440\u043E\u0441 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0438":s.startsWith("fa")?"\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0634\u062A\u0631\u0627\u06A9":s.startsWith("zh")?"\u8BA2\u9605\u83B7\u53D6":"Sub fetch",b=s.startsWith("ru")?"\u041D\u0435\u0442":s.startsWith("fa")?"\u0647\u06CC\u0686\u200C\u0648\u0642\u062A":s.startsWith("zh")?"\u4ECE\u672A":"Never",y=n(a)===a?l:n(a),f=n(o)===o?b:n(o),w=Ia(t),x=Math.floor(Date.now()/1e3),c=w?x-w:null,g=c===null?f:za(c,s);return r(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:[y,": ",g]})},La=L(oo,{baseStyle:{w:4,h:4}}),Da=L(so,{baseStyle:{w:4,h:4}}),un=5;function Ua(t,n,i){if(i<un)throw new Error(`Must allow at least ${un} page items`);if(i%2===0)throw new Error("Must allow odd number of page items");if(t<i)return[...new Array(t).keys()];const s=Math.max(0,Math.min(t-i,n-Math.floor(i/2))),a=new Array(i);for(let o=0;o<i;o+=1)a[o]=o+s;return a[0]>0&&(a[0]=0,a[1]="prev-more"),a[a.length-1]<t-1&&(a[a.length-1]=t-1,a[a.length-2]="next-more"),a}const Ma=()=>{const{filters:t,onFilterChange:n,users:{total:i}}=V(),{limit:s,offset:a}=t,o=(a||0)/(s||1),l=Math.ceil(i/(s||1)),b=Ua(l,o,7),y=x=>{n({...t,offset:x*s})},f=x=>{n({...t,limit:parseInt(x.target.value)}),Yo(x.target.value)},{t:w}=te();return r(I,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(U,{order:{base:2,md:1},children:r(I,{children:[r(Re,{minW:"60px",value:s,onChange:f,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(u,{whiteSpace:"nowrap",fontSize:"sm",children:w("itemsPerPage")})]})}),r(ao,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(W,{leftIcon:e(La,{}),onClick:y.bind(null,o-1),isDisabled:o===0||l===0,children:w("previous")}),b.map(x=>typeof x=="string"?e(W,{children:"..."},x):e(W,{variant:x===o?"solid":"outline",onClick:y.bind(null,x),children:x+1},x)),e(W,{rightIcon:e(Da,{}),onClick:y.bind(null,o+1),isDisabled:o+1===l||l===0,children:w("next")})]})]})},mr=({expiryDate:t,status:n,compact:i=!1,showDetail:s=!0,extraText:a})=>{const{t:o}=te(),l=lr(t),b=ft[n].icon;return r(Oe,{children:[r(O,{colorScheme:ft[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:i?1:2,alignItems:"center",_dark:n==="active"||n==="connected"?{bg:"rgba(34,197,94,0.14)",color:"#86efac",border:"1px solid rgba(74,222,128,0.35)",boxShadow:"0 0 4px rgba(74,222,128,0.34), 0 0 10px rgba(34,197,94,0.2)"}:n==="expired"?{bg:"rgba(251,146,60,0.14)",color:"#fdba74",border:"1px solid rgba(251,146,60,0.35)",boxShadow:"0 0 4px rgba(251,146,60,0.34), 0 0 10px rgba(249,115,22,0.2)"}:void 0,children:[e(b,{w:i?3:4}),s&&r(u,{textTransform:"capitalize",fontSize:i?".7rem":".875rem",lineHeight:i?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&o(`status.${n}`),a&&`: ${a}`]})]}),s&&t&&e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o(l.status,{time:l.time})})]})},Ta=L(Ca),Ct={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Ea=L(lo,Ct),Aa=L(On,Ct),hn=L(co,Ct),Na=L(Cr,Ct),Ra=L(Rn,Ct),Fa=L(Bn,Ct),Wa=L(On,{baseStyle:{width:"15px",height:"15px"}}),Pa=t=>{for(var n=0;n<wr.length;n++){const i=wr[n];if(i.value==t)return i.title}return"No"},Ba=t=>{const{used:n,total:i,dataLimitResetStrategy:s,totalUsedTraffic:a}=t,o=i===0||i===null;return e(I,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:r(u,{children:[Ie(n)," /"," ",o?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ie(i)]})})},pn=t=>{const{used:n,total:i,dataLimitResetStrategy:s,totalUsedTraffic:a,...o}=t,l=i===0||i===null,b=!l&&n/i*100>=100;return r(Oe,{children:[e(uo,{orientation:"horizontal",value:l?100:Math.min(n/i*100,100),colorScheme:b?"red":"primary",...o,children:e(ho,{h:"6px",borderRadius:"full",children:e(po,{borderRadius:"full"})})}),r(I,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[r(u,{children:[Ie(n)," /"," ",l?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ie(i)+(s&&s!=="no_reset"?" "+Ce("userDialog.resetStrategy"+Pa(s)):"")]}),r(u,{children:[Ce("usersTable.total"),": ",Ie(a)]})]})]})},Dt=({sort:t,column:n})=>t.includes(n)?e(Wa,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Oa=t=>{const{filters:n,users:{users:i,total:s},onEditingUser:a,onFilterChange:o}=V(),{t:l}=te(),[b,y]=p.exports.useState(void 0),f=gt({base:120,lg:72})||72,[w,x]=p.exports.useState(`${f}px`),c=gt({base:!1,md:!0});p.exports.useEffect(()=>{const d=()=>{const h=document.querySelector("#filters");!h||x(`${h.offsetHeight}px`)};return d(),window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]);const g=(i==null?void 0:i.length)!==s,z=d=>{let h=n.sort;h.includes(d)?h.startsWith("-")?h="-created_at":h="-"+d:h=d,o({sort:h})},T=d=>{o({status:d.target.value.length>0?d.target.value:void 0})},k=d=>{y(d===b?void 0:d)};return r(U,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Ft,{allowMultiple:!0,display:{base:"block",md:"none"},index:b,children:r(qt,{orientation:"vertical",zIndex:"docked",...t,children:[e(Zt,{zIndex:"docked",position:"relative",children:r(Qe,{children:[e(we,{position:"sticky",top:w,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:z.bind(null,"username"),children:r(I,{children:[e("span",{children:l("users")}),e(Dt,{sort:n.sort,column:"username"})]})}),e(we,{position:"sticky",top:w,minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:r(I,{spacing:0,position:"relative",children:[r(u,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[l("usersTable.status"),n.status?": "+n.status:""]}),r(Re,{value:n.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Oe,{}),_focusVisible:{border:"0 !important"},onChange:T,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(we,{position:"sticky",top:w,minW:"100px",cursor:"pointer",pr:0,onClick:z.bind(null,"used_traffic"),children:r(I,{children:[e("span",{children:l("usersTable.dataUsage")}),e(Dt,{sort:n.sort,column:"used_traffic"})]})}),e(we,{position:"sticky",top:w,minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Qt,{children:!c&&(i==null?void 0:i.map((d,h)=>r(p.exports.Fragment,{children:[r(Qe,{onClick:k.bind(null,h),cursor:"pointer",children:[e(me,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:r("div",{className:"flex-status",children:[e(ln,{lastOnline:d.online_at,lastFetch:d.sub_updated_at,firstFetch:d.first_sub_fetch_at}),e(u,{isTruncated:!0,children:d.username})]})}),e(me,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(mr,{compact:!0,showDetail:!1,expiryDate:d.expire,status:d.status})}),e(me,{borderBottom:0,minW:"100px",pr:0,children:e(Ba,{totalUsedTraffic:d.lifetime_used_traffic,dataLimitResetStrategy:d.data_limit_reset_strategy,used:d.used_traffic,total:d.data_limit,colorScheme:ft[d.status].bandWidthColor})}),e(me,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Aa,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:b===h?"rotate(180deg)":"0deg"})})]}),e(Qe,{className:"collapsible",onClick:k.bind(null,h),children:e(me,{p:0,colSpan:4,children:r(yt,{border:0,children:[e(St,{display:"none"}),e(_t,{border:0,cursor:"pointer",px:6,py:3,children:r(J,{justifyContent:"space-between",spacing:"4",children:[r(J,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(u,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:l("usersTable.dataUsage")}),e(U,{width:"full",minW:"230px",children:e(pn,{totalUsedTraffic:d.lifetime_used_traffic,dataLimitResetStrategy:d.data_limit_reset_strategy,used:d.used_traffic,total:d.data_limit,colorScheme:ft[d.status].bandWidthColor})})]}),r(I,{w:"full",justifyContent:"space-between",children:[r(U,{width:"full",children:[e(mr,{compact:!0,expiryDate:d.expire,status:d.status}),e(cn,{lastOnline:d.online_at}),e(dn,{lastFetch:d.sub_updated_at})]}),r(I,{children:[e(mn,{user:d}),e(ze,{label:l("userDialog.editUser"),placement:"top",children:e(se,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:G=>{G.stopPropagation(),a(d)},children:e(Fa,{})})})]})]})]})})]})})})]},d.username)))})]})}),r(qt,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Zt,{zIndex:"docked",position:"relative",children:r(Qe,{children:[e(we,{position:"sticky",top:{base:"unset",md:w},minW:"140px",cursor:"pointer",onClick:z.bind(null,"username"),children:r(I,{children:[e("span",{children:l("username")}),e(Dt,{sort:n.sort,column:"username"})]})}),e(we,{position:"sticky",top:{base:"unset",md:w},width:"400px",minW:"150px",cursor:"pointer",children:r(I,{position:"relative",gap:"5px",children:[r(u,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[l("usersTable.status"),n.status?": "+n.status:""]}),e(u,{children:"/"}),e(Dt,{sort:n.sort,column:"expire"}),e(I,{onClick:z.bind(null,"expire"),children:e(u,{children:"Sort by expire"})}),r(Re,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Oe,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:T,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(we,{position:"sticky",top:{base:"unset",md:w},width:"350px",minW:"230px",cursor:"pointer",onClick:z.bind(null,"used_traffic"),children:r(I,{children:[e("span",{children:l("usersTable.dataUsage")}),e(Dt,{sort:n.sort,column:"used_traffic"})]})}),e(we,{position:"sticky",top:{base:"unset",md:w},width:"200px",minW:"180px"})]})}),r(Qt,{children:[c&&(i==null?void 0:i.map((d,h)=>r(Qe,{className:Nt("interactive",{"last-row":h===((i==null?void 0:i.length)||0)-1}),onClick:()=>a(d),children:[e(me,{minW:"140px",children:r("div",{className:"flex-status",children:[e(ln,{lastOnline:d.online_at,lastFetch:d.sub_updated_at,firstFetch:d.first_sub_fetch_at}),d.username,e(cn,{lastOnline:d.online_at}),e(dn,{lastFetch:d.sub_updated_at})]})}),e(me,{width:"400px",minW:"150px",children:e(mr,{expiryDate:d.expire,status:d.status})}),e(me,{width:"350px",minW:"230px",children:e(pn,{totalUsedTraffic:d.lifetime_used_traffic,dataLimitResetStrategy:d.data_limit_reset_strategy,used:d.used_traffic,total:d.data_limit,colorScheme:ft[d.status].bandWidthColor})}),e(me,{width:"200px",minW:"180px",children:e(mn,{user:d})})]},d.username))),((i==null?void 0:i.length)||0)==0&&e(Qe,{children:e(me,{colSpan:4,children:e(ja,{isFiltered:g})})})]})]}),e(Ma,{})]})},mn=({user:t})=>{const{setQRCode:n,setSubLink:i}=V(),s=t.links.join(`\r
`),[a,o]=p.exports.useState([-1,!1]);return p.exports.useEffect(()=>{a[1]&&setTimeout(()=>{o([-1,!1])},1e3)},[a]),r(I,{justifyContent:"flex-end",onClick:l=>{l.preventDefault(),l.stopPropagation()},children:[e(Pr,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{o([0,!0])},children:e("div",{children:e(ze,{label:a[0]==0&&a[1]?Ce("usersTable.copied"):Ce("usersTable.copyLink"),placement:"top",children:e(se,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==0&&a[1]?e(hn,{}):e(Na,{})})})})}),e(Pr,{text:s,onCopy:()=>{o([1,!0])},children:e("div",{children:e(ze,{label:a[0]==1&&a[1]?Ce("usersTable.copied"):Ce("usersTable.copyConfigs"),placement:"top",children:e(se,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==1&&a[1]?e(hn,{}):e(Ea,{})})})})}),e(ze,{label:"QR Code",placement:"top",children:e(se,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{n(t.links),i(t.subscription_url)},children:e(Ra,{})})})]})},ja=({isFiltered:t})=>{const{onCreateUser:n}=V();return r(U,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Ta,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(u,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Ce("usersTable.noUserMatched"):Ce("usersTable.noUser")}),!t&&e(W,{size:"sm",colorScheme:"primary",onClick:()=>n(!0),children:Ce("createUser")})]})},Ha=()=>(p.exports.useEffect(()=>{const t=setTimeout(()=>{try{console.log("Dashboard: Starting initialization..."),V.getState().refetchUsers(),Zo()}catch(n){console.error("Dashboard initialization failed:",n)}},200);return()=>clearTimeout(t)},[]),r(J,{className:"xpert-page-shift",justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,w:"full",minW:0,children:[r(U,{w:"full",children:[e(Zn,{}),e(Vo,{mt:"4"}),e(ms,{}),e(Oa,{}),e(ka,{}),e(ds,{}),e(sa,{}),e(Hs,{}),e(da,{}),e(ha,{}),e(Js,{}),e(ra,{}),e(la,{}),e(Xo,{}),e(ls,{}),e(cs,{})]}),e(Mr,{})]})),$a=L(mo),Va=L(go),Ga=()=>{var Ne,He,Ge;const{t}=te(),n=je(),i=jn(),s=m=>{const N={"user.create":"adminManager.action.userCreate","user.modify":"adminManager.action.userModify","user.delete":"adminManager.action.userDelete","user.reset_usage":"adminManager.action.userResetUsage","user.revoke_sub":"adminManager.action.userRevokeSub","crypto.encrypt":"adminManager.action.cryptoEncrypt","hwid.reset":"adminManager.action.hwidReset","user.ip_limit_set":"adminManager.action.userIpLimitSet","user.traffic_limit_set":"adminManager.action.userTrafficLimitSet","admin.traffic_limit_set":"adminManager.action.adminTrafficLimitSet","admin.users_limit_set":"adminManager.action.adminUsersLimitSet","admin.user_traffic_limit_set":"adminManager.action.adminUserTrafficLimitSet"}[m];return N?t(N):m},a=m=>{if(typeof m!="string")return"-";const C=m.replace(/^UserStatus\./,""),N=`adminManager.status.${C}`,K=t(N);return K===N?C:K},o=m=>{try{return JSON.stringify(m)}catch{return String(m)}},l=m=>{if(m==null)return"-";const C=Number(m);return Number.isNaN(C)||C<0?"-":C>=1024**4?`${(C/1024**4).toFixed(2)} TB`:C>=1024**3?`${(C/1024**3).toFixed(2)} GB`:C>=1024**2?`${(C/1024**2).toFixed(2)} MB`:C>=1024?`${(C/1024).toFixed(2)} KB`:`${C} B`},b=(m,C)=>{if(!C)return"-";if(m==="user.ip_limit_set"){const N=C==null?void 0:C.limit;return typeof N=="number"?t("adminManager.meta.ipLimitSet",{limit:N}):t("adminManager.meta.ipLimitSetUnknown")}if(m==="admin.traffic_limit_set"){const N=C==null?void 0:C.new_gb,K=C==null?void 0:C.new;return typeof N=="number"?t("adminManager.meta.adminTrafficLimitSetGb",{limit:N}):typeof K=="number"?t("adminManager.meta.adminTrafficLimitSetBytes",{limit:K}):t("adminManager.meta.adminTrafficLimitSetUnknown")}if(m==="admin.users_limit_set"){const N=C==null?void 0:C.new;return typeof N=="number"?t("adminManager.meta.adminUsersLimitSet",{limit:N}):t("adminManager.meta.adminUsersLimitSetUnknown")}if(m==="admin.user_traffic_limit_set"){const N=C==null?void 0:C.limit_gb,K=C==null?void 0:C.limit_bytes,Se=C==null?void 0:C.updated_users,_e=C==null?void 0:C.set_by;return typeof N=="number"?t("adminManager.meta.adminUserTrafficLimitSetGb",{limit:N,count:typeof Se=="number"?Se:0,setBy:typeof _e=="string"?_e:"-"}):typeof K=="number"?t("adminManager.meta.adminUserTrafficLimitSetBytes",{limit:K,count:typeof Se=="number"?Se:0,setBy:typeof _e=="string"?_e:"-"}):t("adminManager.meta.adminUserTrafficLimitSetUnknown")}if(m==="user.create"){const N=a(C==null?void 0:C.status),K=C==null?void 0:C.expire,Se=typeof K=="number"?new Date(K*1e3).toLocaleString():"-",_e=l(C==null?void 0:C.data_limit);return t("adminManager.meta.userCreate",{status:N,expire:Se,dataLimit:_e})}if(m==="user.modify")return t("adminManager.meta.userModify");if(m==="user.delete")return t("adminManager.meta.userDelete");if(m==="user.reset_usage")return t("adminManager.meta.userResetUsage");if(m==="user.revoke_sub")return t("adminManager.meta.userRevokeSub");if(m==="crypto.encrypt")return t("adminManager.meta.cryptoEncrypt");if(m==="hwid.reset")return t("adminManager.meta.hwidReset");if(m==="user.traffic_limit_set"){const N=l(C==null?void 0:C.old),K=l(C==null?void 0:C.new);return t("adminManager.meta.userTrafficLimitSet",{oldLimit:N,newLimit:K})}return o(C)},[y,f]=p.exports.useState(!1),[w,x]=p.exports.useState([]),[c,g]=p.exports.useState(""),[z,T]=p.exports.useState(!1),[k,d]=p.exports.useState(0),[h,G]=p.exports.useState([]),[E,F]=p.exports.useState(!1),[M,P]=p.exports.useState([]),[v,B]=p.exports.useState(0),[Y,ce]=p.exports.useState(null),[A,Q]=p.exports.useState(!1),[oe,$]=p.exports.useState("created"),[ae,pe]=p.exports.useState(!1),[de,ke]=p.exports.useState(0),Ae=100,S=p.exports.useMemo(()=>w.find(m=>m.username===c)||null,[w,c]),q=m=>`adminManager.notifications.lastSeen.${m}`,re=m=>!m||Number.isNaN(m)?"-":new Date(m*1e3).toLocaleString(),xe=m=>{var C;if(m.action==="user.ip_limit_set"||m.action==="user.traffic_limit_set"||m.action==="user.create")return!0;if(m.action==="user.modify"){const N=((C=m.meta)==null?void 0:C.changes)||{};return!!((N==null?void 0:N.expire)||(N==null?void 0:N.data_limit))}return!1},ne=m=>{var K,Se,_e,Ye,fe,We,be,vt;const C=(m||[]).filter(xe),N=[];for(const Z of C){const qe=Date.parse(Z.created_at||"")||0,Ar=Z.target_username||"-",Ot=N[N.length-1],ve=!!Ot&&Ot.target===Ar&&Math.abs(Ot.ts-qe)<=8e3?Ot:(()=>{const Pe={id:Z.id,created_at:Z.created_at,ts:qe,target:Ar,admin:Z.admin_username||"-"};return N.push(Pe),Pe})();if(Z.id>ve.id&&(ve.id=Z.id),qe>ve.ts&&(ve.ts=qe,ve.created_at=Z.created_at,ve.admin=Z.admin_username||ve.admin||"-"),Z.action==="user.ip_limit_set"&&typeof((K=Z.meta)==null?void 0:K.limit)=="number"&&(ve.ipLimit=Z.meta.limit),Z.action==="user.traffic_limit_set"&&(ve.trafficOld=(Se=Z.meta)==null?void 0:Se.old,ve.trafficNew=(_e=Z.meta)==null?void 0:_e.new),Z.action==="user.modify"){const Pe=((Ye=Z.meta)==null?void 0:Ye.changes)||{};Pe!=null&&Pe.expire&&(ve.expireFrom=Pe.expire.from,ve.expireTo=Pe.expire.to),Pe!=null&&Pe.data_limit&&(ve.trafficOld=Pe.data_limit.from,ve.trafficNew=Pe.data_limit.to)}Z.action==="user.create"&&(((fe=Z.meta)==null?void 0:fe.expire)!==void 0&&((We=Z.meta)==null?void 0:We.expire)!==null&&(ve.expireTo=Z.meta.expire),((be=Z.meta)==null?void 0:be.data_limit)!==void 0&&((vt=Z.meta)==null?void 0:vt.data_limit)!==null&&(ve.trafficNew=Z.meta.data_limit))}return N.map(Z=>{const qe=[];return(Z.expireFrom!==void 0||Z.expireTo!==void 0)&&qe.push(t("adminManager.notifications.expireChanged",{from:re(Number(Z.expireFrom||0)),to:re(Number(Z.expireTo||0))})),(Z.trafficOld!==void 0||Z.trafficNew!==void 0)&&qe.push(t("adminManager.notifications.trafficChanged",{from:l(Z.trafficOld),to:l(Z.trafficNew)})),Z.ipLimit!==void 0&&qe.push(t("adminManager.notifications.ipChanged",{limit:Z.ipLimit})),qe.length||qe.push(t("adminManager.notifications.updated")),{id:Z.id,created_at:Z.created_at,target_username:Z.target,admin_username:Z.admin||"-",message:qe.join("; ")}})},ie=async(m=!1)=>{var C;try{m||f(!0);const N=await R("/xpert/admin-manager/admins");x(N||[]),!c&&(N==null?void 0:N.length)&&g(N[0].username)}catch(N){n({title:t("adminManager.failed"),description:String((C=N==null?void 0:N.message)!=null?C:N),status:"error",duration:3e3,isClosable:!0})}finally{m||f(!1)}},ue=async(m,C,N=!1)=>{var K,Se,_e,Ye;try{N||T(!0);const[fe,We]=await Promise.all([R(`/xpert/admin-manager/actions/${encodeURIComponent(m)}`,{query:{offset:C,limit:Ae}}),R(`/xpert/admin-manager/actions/${encodeURIComponent(m)}`,{query:{offset:0,limit:200}})]);d((K=fe==null?void 0:fe.total)!=null?K:0),G((Se=fe==null?void 0:fe.items)!=null?Se:[]);const be=ne((_e=We==null?void 0:We.items)!=null?_e:[]);P(be)}catch(fe){n({title:t("adminManager.failed"),description:String((Ye=fe==null?void 0:fe.message)!=null?Ye:fe),status:"error",duration:3e3,isClosable:!0})}finally{N||T(!1)}},he=async(m,C=!1)=>{var N;try{C||Q(!0);const K=await R(`/xpert/admin-manager/lifetime/${encodeURIComponent(m)}`);ce(K||null)}catch(K){C||n({title:t("adminManager.failed"),description:String((N=K==null?void 0:K.message)!=null?N:K),status:"error",duration:3e3,isClosable:!0})}finally{C||Q(!1)}};p.exports.useEffect(()=>{ie()},[]),p.exports.useEffect(()=>{if(!c)return;ke(0);const m=Number(localStorage.getItem(q(c))||"0");B(Number.isNaN(m)?0:m),ue(c,0),he(c)},[c]),p.exports.useEffect(()=>{if(!c)return;const m=window.setInterval(()=>{ie(!0),ue(c,de,!0),he(c,!0)},15e3);return()=>window.clearInterval(m)},[c,de]);const Ve=de>0,Fe=de+Ae<k,_=p.exports.useMemo(()=>M.filter(m=>m.id>v),[M,v]),j=()=>{F(!0);const m=M.length?M[0].id:0;c&&m>v&&(localStorage.setItem(q(c),String(m)),B(m))},ee=m=>{$(m),pe(!0)},ge=m=>t(m==="created"?"adminManager.lifetime.createdUsers":m==="extended"?"adminManager.lifetime.extendedUsers":"adminManager.lifetime.deletedUsers"),ye=()=>Y?oe==="created"?Y.created_users||[]:oe==="extended"?Y.extended_users||[]:Y.deleted_users||[]:[];return r(U,{className:"xpert-page-shift",w:"full",minW:0,children:[e(Zn,{}),r(U,{p:{base:3,md:5},children:[e(xn,{direction:{base:"column",sm:"row"},justify:"space-between",align:{base:"stretch",sm:"center"},spacing:2,children:r(I,{children:[e(se,{"aria-label":t("adminManager.back"),icon:e($a,{}),size:"sm",variant:"ghost",onClick:()=>i("/")}),e(u,{fontSize:"2xl",fontWeight:"semibold",children:t("adminManager.title")})]})}),r(Mt,{mt:4,gap:3,align:"stretch",direction:{base:"column",md:"row"},children:[r(Mt,{w:{base:"full",md:"320px"},gap:3,align:"stretch",direction:"column",children:[r(U,{w:"full",borderWidth:"1px",borderRadius:"lg",p:3,children:[r(I,{justify:"space-between",mb:2,children:[e(u,{fontWeight:"semibold",children:t("adminManager.admins")}),e(W,{size:"xs",variant:"outline",onClick:()=>ie(),isDisabled:y,children:t("adminManager.refresh")})]}),y?e(I,{py:6,justify:"center",children:e(Xe,{size:"sm"})}):e(J,{align:"stretch",spacing:2,maxH:{base:"180px",md:"240px"},overflowY:"auto",children:w.map(m=>e(W,{variant:c===m.username?"solid":"outline",colorScheme:c===m.username?"blue":"gray",size:"sm",justifyContent:"space-between",onClick:()=>g(m.username),children:r(I,{w:"full",justify:"space-between",children:[r(I,{children:[e(u,{children:m.username}),m.is_sudo?e(O,{colorScheme:"purple",children:"sudo"}):null]}),e(O,{colorScheme:"blue",children:m.actions_24h})]})},m.username))})]}),r(U,{w:"full",borderWidth:"1px",borderRadius:"lg",p:3,children:[e(u,{fontSize:"sm",fontWeight:"semibold",mb:2,children:t("adminManager.lifetime.title")}),A?e(I,{py:2,justify:"center",children:e(Xe,{size:"xs"})}):r(J,{align:"stretch",spacing:2,children:[r(I,{justify:"space-between",children:[e(u,{fontSize:"sm",children:t("adminManager.lifetime.created")}),r(I,{spacing:2,children:[e(O,{colorScheme:"green",children:(Ne=Y==null?void 0:Y.created_count)!=null?Ne:0}),e(W,{size:"xs",variant:"outline",onClick:()=>ee("created"),isDisabled:!c,children:t("adminManager.lifetime.viewList")})]})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"sm",children:t("adminManager.lifetime.extended")}),r(I,{spacing:2,children:[e(O,{colorScheme:"blue",children:(He=Y==null?void 0:Y.extended_count)!=null?He:0}),e(W,{size:"xs",variant:"outline",onClick:()=>ee("extended"),isDisabled:!c,children:t("adminManager.lifetime.viewList")})]})]}),r(I,{justify:"space-between",children:[e(u,{fontSize:"sm",children:t("adminManager.lifetime.deleted")}),r(I,{spacing:2,children:[e(O,{colorScheme:"red",children:(Ge=Y==null?void 0:Y.deleted_count)!=null?Ge:0}),e(W,{size:"xs",variant:"outline",onClick:()=>ee("deleted"),isDisabled:!c,children:t("adminManager.lifetime.viewList")})]})]})]})]})]}),r(U,{flex:"1",borderWidth:"1px",borderRadius:"lg",p:3,overflow:"hidden",children:[r(I,{justify:"space-between",mb:3,children:[r(I,{children:[r(u,{fontWeight:"semibold",children:[t("adminManager.details"),": ",c||"-"]}),S?r(Oe,{children:[e(O,{colorScheme:"gray",children:t("adminManager.users",{count:S.total_users})}),e(O,{colorScheme:"blue",children:t("adminManager.actions24h",{count:S.actions_24h})})]}):null]}),r(I,{children:[r(U,{position:"relative",children:[e(se,{"aria-label":t("adminManager.notifications.title"),size:"xs",variant:"outline",icon:e(Va,{w:4,h:4}),onClick:j}),_.length>0?e(O,{position:"absolute",top:"-2",right:"-2",colorScheme:"yellow",borderRadius:"full",fontSize:"10px",children:_.length}):null]}),e(W,{size:"xs",variant:"outline",onClick:()=>{ie(),ue(c,de),he(c)},isDisabled:!c||z||y,children:t("adminManager.refresh")}),e(W,{size:"xs",variant:"outline",onClick:()=>{const m=Math.max(0,de-Ae);ke(m),ue(c,m)},isDisabled:!c||z||!Ve,children:t("adminManager.prev")}),e(W,{size:"xs",variant:"outline",onClick:()=>{const m=de+Ae;ke(m),ue(c,m)},isDisabled:!c||z||!Fe,children:t("adminManager.next")})]})]}),z?e(I,{py:10,justify:"center",children:e(Xe,{size:"sm"})}):e(U,{overflowX:"auto",children:r(qt,{size:"sm",children:[e(Zt,{children:r(Qe,{children:[e(we,{children:t("adminManager.time")}),e(we,{children:t("adminManager.action")}),e(we,{children:t("adminManager.target")}),e(we,{children:t("adminManager.meta")})]})}),r(Qt,{children:[h.map(m=>{var C;return r(Qe,{children:[e(me,{whiteSpace:"nowrap",children:(C=m.created_at)==null?void 0:C.replace("T"," ").slice(0,19)}),e(me,{whiteSpace:"nowrap",children:s(m.action)}),e(me,{whiteSpace:"nowrap",children:m.target_username||"-"}),e(me,{maxW:"520px",overflow:"hidden",textOverflow:"ellipsis",children:e(u,{title:m.meta?o(m.meta):"",fontSize:"xs",color:"gray.600",children:b(m.action,m.meta)})})]},m.id)}),h.length?null:e(Qe,{children:e(me,{colSpan:4,children:e(u,{color:"gray.500",children:t("adminManager.empty")})})})]})]})})]})]})]}),r(Le,{isOpen:E,onClose:()=>F(!1),size:"lg",isCentered:!0,children:[e(De,{}),r(Ue,{children:[e(Me,{children:t("adminManager.notifications.title")}),e(Te,{}),e(Ee,{pb:4,children:r(J,{align:"stretch",spacing:3,maxH:"60vh",overflowY:"auto",children:[M.map(m=>{var N;const C=m.id>v;return r(U,{borderWidth:"1px",borderRadius:"md",p:3,bg:C?"yellow.50":"transparent",borderColor:C?"yellow.200":void 0,_dark:{bg:C?"rgba(245, 158, 11, 0.12)":"rgba(148, 163, 184, 0.06)",borderColor:C?"rgba(251, 191, 36, 0.46)":"rgba(148, 163, 184, 0.24)"},children:[e(u,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:(N=m.created_at)==null?void 0:N.replace("T"," ").slice(0,19)}),e(u,{fontSize:"sm",fontWeight:"semibold",children:m.target_username}),e(u,{fontSize:"xs",color:"gray.600",_dark:{color:"gray.300"},children:t("adminManager.notifications.byAdmin",{admin:m.admin_username||"-"})}),e(u,{fontSize:"sm",children:m.message})]},m.id)}),M.length?null:e(u,{color:"gray.500",children:t("adminManager.notifications.empty")})]})})]})]}),r(Le,{isOpen:ae,onClose:()=>pe(!1),size:"lg",isCentered:!0,children:[e(De,{}),r(Ue,{children:[e(Me,{children:ge(oe)}),e(Te,{}),e(Ee,{pb:4,children:r(J,{align:"stretch",spacing:2,maxH:"60vh",overflowY:"auto",children:[ye().map(m=>r(I,{justify:"space-between",borderWidth:"1px",borderRadius:"md",p:2,children:[e(u,{fontSize:"sm",fontWeight:"semibold",children:m.username}),r(I,{spacing:3,children:[e(O,{colorScheme:"purple",children:t("adminManager.lifetime.countBadge",{count:m.count})}),e(u,{fontSize:"xs",color:"gray.500",children:m.last_at?m.last_at.replace("T"," ").slice(0,19):"-"})]})]},m.username)),ye().length?null:e(u,{color:"gray.500",children:t("adminManager.empty")})]})})]})]}),e(Mr,{})]})},Ya=t=>p.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},p.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),qa=D.object({username:D.string().min(1,"login.fieldRequired"),password:D.string().min(1,"login.fieldRequired")}),Za=L(Ya,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),Qa=L(fo,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),gr=()=>{var x,c;const[t,n]=p.exports.useState(""),[i,s]=p.exports.useState(!1),a=jn(),{t:o}=te();let l=bo();const{register:b,formState:{errors:y},handleSubmit:f}=kt({resolver:Rt(qa)});p.exports.useEffect(()=>{To(),l.pathname!=="/login"&&a("/login",{replace:!0})},[]);const w=g=>{n("");const z=new FormData;z.append("username",g.username),z.append("password",g.password),z.append("grant_type","password"),s(!0),R("/api/admin/token",{method:"post",body:z}).then(({access_token:T})=>{Mo(T),setTimeout(()=>{a("/")},100)}).catch(T=>{var k,d;console.error("Login failed:",T),n(((d=(k=T.response)==null?void 0:k._data)==null?void 0:d.detail)||"Login failed")}).finally(()=>{s(!1)})};return r(J,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[r(U,{w:"full",children:[e(I,{justifyContent:"end",w:"full",children:e(Yn,{})}),e(I,{w:"full",justifyContent:"center",alignItems:"center",children:r(U,{w:"full",maxW:"340px",mt:"6",children:[r(J,{alignItems:"center",w:"full",children:[e(Za,{}),e(u,{fontSize:"2xl",fontWeight:"semibold",children:o("login.loginYourAccount")}),e(u,{color:"gray.600",_dark:{color:"gray.400"},children:o("login.welcomeBack")})]}),e(U,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:f(w),children:r(J,{mt:4,rowGap:2,children:[e(H,{children:e(lt,{w:"full",placeholder:o("username"),...b("username"),error:o((x=y==null?void 0:y.username)==null?void 0:x.message)})}),e(H,{children:e(lt,{w:"full",type:"password",placeholder:o("password"),...b("password"),error:o((c=y==null?void 0:y.password)==null?void 0:c.message)})}),t&&r(Et,{status:"error",rounded:"md",children:[e(tr,{}),e(Mn,{children:t})]}),r(W,{isLoading:i,type:"submit",w:"full",colorScheme:"primary",children:[e(Qa,{marginRight:1}),o("login")]})]})})})]})})]}),e(Mr,{})]})},Jn=async()=>{try{const t=rr();if(!t)throw console.log("Router: No token found, redirecting to login"),new Error("No token found");console.log("Router: Validating admin token...");const n=await R("/admin",{headers:{Authorization:`Bearer ${t}`}});return console.log("Router: Admin validation successful"),n}catch(t){throw console.error("Router: Admin loader failed:",t),t}},Xa=async()=>{const t=await Jn();return t!=null&&t.is_sudo?t:yo("/")},Ja=xo([{path:"/",element:e(Ha,{}),errorElement:e(gr,{}),loader:Jn},{path:"/admin-manager/",element:e(Ga,{}),errorElement:e(gr,{}),loader:Xa},{path:"/login/",element:e(gr,{})}]);function Ka(){return e("main",{className:"p-8",children:e(So,{router:Ja})})}const el=window.fetch.bind(window);window.fetch=async(t,n)=>{const i=((n==null?void 0:n.method)||"GET").toUpperCase(),s=typeof t=="string"?t:t.toString(),a=new Headers((n==null?void 0:n.headers)||{});a.has("authorization")&&a.set("authorization","REDACTED"),a.has("Authorization")&&a.set("Authorization","REDACTED"),console.log("[FETCH]",i,s,{...n,headers:Object.fromEntries(a.entries())});try{const o=await el(t,n);return console.log("[FETCH OK]",i,s,o.status),o}catch(o){throw console.error("[FETCH ERR]",i,s,o),o}};le.extend(_o);le.extend(wo);le.extend(ko);le.extend(Co);le.extend(vo);Hn(Io.get()||"light");zo.createRoot(document.getElementById("root")).render(e(xr.StrictMode,{children:e(Lo,{theme:Uo,children:e(Do,{client:Sr,children:e(Ka,{})})})}));
