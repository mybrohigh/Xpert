import{i as ur,B as Kn,a as ei,b as ti,j as bn,d as le,U as _r,z as ri,r as ni,f as ii,Q as oi,e as si,$ as ai,u as tr,c as T,g as li,C as kr,h as rr,k as ie,l as t,H as E,m as e,T as u,n as He,o as F,p as nr,s as ci,A as yn,q as Ce,t as h,M as de,v as he,w as ue,x as pe,y as me,D as ge,V as te,E as Q,F as M,G as j,S as Ue,N as pr,I as mr,J as gr,K as fr,L as br,O as tt,P as rt,R as ye,W as G,X as nt,Y as H,Z as D,_ as xe,a0 as Fe,a1 as Lt,a2 as di,a3 as A,a4 as xn,a5 as _t,a6 as hi,a7 as ui,a8 as At,a9 as Sn,aa as pi,ab as Wt,ac as Cn,ad as _e,ae as Be,af as re,ag as Bt,ah as Rt,ai as mi,aj as ht,ak as ce,al as wt,am as lt,an as gi,ao as wn,ap as Yt,aq as Ft,ar as Qt,as as fi,at as Jt,au as bi,av as vn,aw as _n,ax as kn,ay as Ie,az as yi,aA as xi,aB as Si,aC as Ci,aD as wi,aE as vi,aF as zr,aG as zn,aH as In,aI as Mt,aJ as ze,aK as _i,aL as ki,aM as yr,aN as zi,aO as Ii,aP as Xt,aQ as Di,aR as Dn,aS as En,aT as Ei,aU as Ht,aV as Tn,aW as jt,aX as Ir,aY as Ti,aZ as Dt,a_ as Et,a$ as xr,b0 as Tt,b1 as Li,b2 as Ge,b3 as qe,b4 as Ze,b5 as Ye,b6 as Qe,b7 as Je,b8 as $r,b9 as Ai,ba as vt,bb as ct,bc as Dr,bd as Ui,be as Ri,bf as Mi,bg as Ln,bh as Er,bi as it,bj as pt,bk as Kt,bl as An,bm as Un,bn as Rn,bo as St,bp as Pi,bq as Ve,br as Ni,bs as Tr,bt as sr,bu as Br,bv as Mn,bw as Oi,bx as Fi,by as Hr,bz as Wi,bA as jr,bB as Pn,bC as $i,bD as Nn,bE as Bi,bF as Hi,bG as On,bH as ji,bI as Vi,bJ as Fn,bK as Wn,bL as $n,bM as Se,bN as Gi,bO as Bn,bP as ut,bQ as Vr,bR as qi,bS as Zi,bT as Yi,bU as Qi,bV as Hn,bW as Ji,bX as Gr,bY as Xi,bZ as Ki,b_ as eo,b$ as Ke,c0 as Oe,c1 as et,c2 as je,c3 as to,c4 as ro,c5 as De,c6 as Ee,c7 as Te,c8 as qr,c9 as no,ca as io,cb as oo,cc as so,cd as ao,ce as lo,cf as co,cg as ho,ch as uo,ci as po,cj as mo,ck as go,cl as fo,cm as bo,cn as yo,co as xo,cp as So}from"./vendor.e0362aa0.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();ur.use(Kn).use(ei).use(ti).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:bn(["/","statics/locales/{{lng}}.json"])}},function(r,i){le.locale(ur.language)});ur.on("languageChanged",r=>{le.locale(r)});_r("zh-cn",ri);_r("ru",ni);_r("fa",ii);const Sr=new oi,jn=r=>{const i=document.querySelector('meta[name="theme-color"]');i==null||i.setAttribute("content",r=="dark"?"#1A202C":"#3B81F6")},Co=si({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const K=()=>localStorage.getItem("token"),wo=r=>{localStorage.setItem("token",r)},vo=()=>{localStorage.removeItem("token")},_o=ai.create({baseURL:"/api/"}),ko=r=>{if(!r)return r;const i={...r};return i.Authorization&&(i.Authorization="REDACTED"),i.authorization&&(i.authorization="REDACTED"),i},zo=(r,i={})=>{K()&&(i.headers={...(i==null?void 0:i.headers)||{},Authorization:`Bearer ${K()}`});const a=((i==null?void 0:i.method)||"GET").toString().toUpperCase();return console.log("[API]",a,r,{...i,headers:ko(i.headers)}),_o(r,i).then(o=>(console.log("[API OK]",a,r,o),o)).catch(o=>{throw console.error("[API ERR]",a,r,o),o})},P=zo,Io=async()=>await P("/admin"),Vn=()=>{const{data:r,isError:i,isLoading:n,isSuccess:a,error:o}=tr({queryFn:()=>Io()});return{userData:r||{discord_webook:"",is_sudo:!1,telegram_id:"",username:""},getUserIsPending:n,getUserIsSuccess:a,getUserIsError:i,getUserError:o}};function Ae(r,i=2,n=!1){if(!+r)return"0 B";const a=1024,o=i<0?0:i,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(r)/Math.log(a));return n?[parseFloat((r/Math.pow(a,l)).toFixed(o)),s[l]]:`${parseFloat((r/Math.pow(a,l)).toFixed(o))} ${s[l]}`}const Zr=r=>{if(r!==null)return r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Do=T(li,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Eo=T(kr,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),To=T(rr,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),ar=({title:r,content:i,icon:n})=>t(He,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[t(E,{alignItems:"center",columnGap:"4",children:[e(F,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:n}),e(u,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:r})]}),e(F,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:i})]}),Cr="statistics-query-key",Lo=r=>{const{version:i}=X(),{data:n,error:a}=tr({queryKey:Cr,queryFn:()=>P("/system"),refetchInterval:5e3,retry:3,retryDelay:1e3,onSuccess:({version:s})=>{i!==s&&X.setState({version:s})},onError:s=>{console.error("Statistics query failed:",s)}}),{t:o}=ie();return t(E,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...r,children:[e(ar,{title:o("activeUsers"),content:n&&t(E,{alignItems:"flex-end",children:[e(u,{children:Zr(n.users_active)}),t(u,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Zr(n.total_user)]})]}),icon:e(Do,{})}),e(ar,{title:o("dataUsage"),content:n&&Ae(n.incoming_bandwidth+n.outgoing_bandwidth),icon:e(Eo,{})}),e(ar,{title:o("memoryUsage"),content:n&&t(E,{alignItems:"flex-end",children:[e(u,{children:Ae(n.mem_used,1,!0)[0]}),t(u,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:[Ae(n.mem_used,1,!0)[1]," /"," ",Ae(n.mem_total,1)]})]}),icon:e(To,{})})]})},Gn="marzban-num-users-per-page",Yr=10,Ao=()=>{const r=localStorage.getItem(Gn)||Yr.toString();return parseInt(r)||Yr},Uo=r=>localStorage.setItem(Gn,r),Ro=r=>{for(const i in r)r[i]||delete r[i];return X.setState({loading:!0}),P("/users",{query:r}).then(i=>(X.setState({users:i}),i)).catch(i=>(console.error("Failed to fetch users:",i),X.setState({users:{users:[],total:0}}),{users:[],total:0})).finally(()=>{X.setState({loading:!1})})},Mo=()=>P("/inbounds").then(r=>{X.setState({inbounds:new Map(Object.entries(r))})}).finally(()=>{X.setState({loading:!1})}),X=nr(ci((r,i)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isShowingNodesUsage:!1,isEditingAdminLimits:!1,isEditingCrypto:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Ao(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{try{Ro(i().filters)}catch(n){console.error("refetchUsers failed:",n)}},resetAllUsage:()=>P("/users/reset",{method:"POST"}).then(()=>{i().onResetAllUsage(!1),i().refetchUsers()}),onResetAllUsage:n=>r({isResetingAllUsage:n}),onCreateUser:n=>r({isCreatingNewUser:n}),onEditingUser:n=>{r({editingUser:n})},onDeletingUser:n=>{r({deletingUser:n})},onFilterChange:n=>{r({filters:{...i().filters,...n}}),i().refetchUsers()},setQRCode:n=>{r({QRcodeLinks:n})},deleteUser:n=>(r({editingUser:null}),P(`/user/${n.username}`,{method:"DELETE"}).then(()=>{r({deletingUser:null}),i().refetchUsers(),Sr.invalidateQueries(Cr)})),createUser:n=>P("/user",{method:"POST",body:n}).then(()=>{r({editingUser:null}),i().refetchUsers(),Sr.invalidateQueries(Cr)}),editUser:n=>P(`/user/${n.username}`,{method:"PUT",body:n}).then(()=>{i().onEditingUser(null),i().refetchUsers()}),fetchUserUsage:(n,a)=>{for(const o in a)a[o]||delete a[o];return P(`/user/${n.username}/usage`,{method:"GET",query:a})},onEditingHosts:n=>{r({isEditingHosts:n})},onEditingNodes:n=>{r({isEditingNodes:n})},onShowingNodesUsage:n=>{r({isShowingNodesUsage:n})},onEditingAdminLimits:n=>{r({isEditingAdminLimits:n})},onEditingCrypto:n=>{r({isEditingCrypto:n})},setSubLink:n=>{r({subscribeUrl:n})},resetDataUsage:n=>P(`/user/${n.username}/reset`,{method:"POST"}).then(()=>{r({resetUsageUser:null}),i().refetchUsers()}),revokeSubscription:n=>P(`/user/${n.username}/revoke_sub`,{method:"POST"}).then(a=>{r({revokeSubscriptionUser:null,editingUser:a}),i().refetchUsers()})}))),Re=({children:r,color:i})=>e(F,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${i}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${i}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${i}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${i}.400`}},children:e(u,{color:`${i}.500`,_dark:{color:`${i}.900`},position:"relative",zIndex:"2",children:r})}),Po=T(yn,{baseStyle:{w:5,h:5}}),No=()=>{const{isEditingAdminLimits:r,onEditingAdminLimits:i}=X(),{t:n}=ie(),{userData:a,getUserIsSuccess:o,getUserIsPending:s}=Vn(),l=Ce(),[g,b]=h.exports.useState([]),[C,y]=h.exports.useState(""),[S,c]=h.exports.useState(!1),[m,z]=h.exports.useState(!1),[w,U]=h.exports.useState(""),[p,d]=h.exports.useState(""),[Y,W]=h.exports.useState("GB"),[_,R]=h.exports.useState(0),V=h.exports.useMemo(()=>g.filter(v=>!v.is_sudo),[g]),J=h.exports.useMemo(()=>V.find(v=>v.username===C)||null,[V,C]),I=v=>{if(v==null)return"-";const q=Math.abs(v);return q>=1024**4?(v/1024**4).toFixed(2)+" TB":q>=1024**3?(v/1024**3).toFixed(2)+" GB":q>=1024**2?(v/1024**2).toFixed(2)+" MB":q>=1024?(v/1024).toFixed(2)+" KB":v+" B"},oe=(v,q)=>Math.floor(q==="TB"?v*1024**4:v*1024**3),fe=v=>v==null?{value:"",unit:"GB"}:v>=1024**4?{value:String(Math.floor(v/1024**4)),unit:"TB"}:{value:String(Math.floor(v/1024**3)),unit:"GB"},B=()=>{i(!1)};h.exports.useEffect(()=>{if(!!r){if(!s&&o&&!a.is_sudo){i(!1);return}c(!0),P("/admins").then(v=>{b(v||[]);const q=(v||[]).find(se=>!se.is_sudo);q&&y(q.username)}).catch(()=>{l({title:n("adminLimits.loadError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>c(!1))}},[r]),h.exports.useEffect(()=>{var q;if(!J){U(""),d(""),W("GB"),R(0);return}const v=fe((q=J.traffic_limit)!=null?q:null);d(v.value),W(v.unit),U(J.users_limit!==null&&J.users_limit!==void 0?String(J.users_limit):""),P("/users",{query:{admin:[J.username],limit:1}}).then(se=>R((se==null?void 0:se.total)||0)).catch(()=>R(0))},[J]);const L=v=>{const q=v.trim();if(!q)return null;const se=Number(q);return Number.isNaN(se)||se<0?null:Math.floor(se)},x=v=>{!v||(z(!0),P(`/admin/usage/reset/${v}`,{method:"POST"}).then(q=>{b(se=>se.map(Me=>Me.username===q.username?q:Me)),l({title:n("adminLimits.resetSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:n("adminLimits.resetError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>z(!1)))},$=v=>!v.traffic_limit||v.users_usage===void 0||v.users_usage===null?!1:v.users_usage>=v.traffic_limit,ae=()=>{if(!J)return;const v=L(p),q={is_sudo:J.is_sudo,traffic_limit:v===null?null:oe(v,Y),users_limit:L(w)};z(!0),P(`/admin/${J.username}`,{method:"PUT",body:q}).then(se=>{b(Me=>Me.map(We=>We.username===se.username?se:We)),l({title:n("adminLimits.saveSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:n("adminLimits.saveError"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>z(!1))};return t(de,{isCentered:!0,isOpen:r,onClose:B,size:"xl",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"primary",children:e(Po,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:n("adminLimits.title")}),e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:n("adminLimits.subtitle")}),t(te,{spacing:4,mt:4,align:"stretch",children:[J&&t(E,{spacing:3,wrap:"wrap",children:[t(Q,{colorScheme:"blue",children:[n("adminLimits.usersCount"),": ",_]}),t(Q,{colorScheme:"purple",children:[n("adminLimits.usedTraffic"),": ",I(J.users_usage)]})]}),t(M,{children:[e(j,{fontSize:"sm",children:n("adminLimits.selectAdmin")}),e(Ue,{size:"sm",value:C,onChange:v=>y(v.target.value),isDisabled:S,children:V.map(v=>e("option",{value:v.username,children:v.username},v.username))})]}),t(E,{spacing:3,align:"flex-start",children:[t(M,{children:[e(j,{fontSize:"sm",children:n("adminLimits.usersLimit")}),t(pr,{size:"sm",min:0,value:w,onChange:v=>U(v),children:[e(mr,{placeholder:n("adminLimits.usersLimitPlaceholder")}),t(gr,{children:[e(fr,{}),e(br,{})]})]})]}),t(M,{children:[e(j,{fontSize:"sm",children:n("adminLimits.trafficLimit")}),t(E,{children:[t(pr,{size:"sm",min:0,value:p,onChange:v=>d(v),children:[e(mr,{placeholder:n("adminLimits.trafficLimitPlaceholder")}),t(gr,{children:[e(fr,{}),e(br,{})]})]}),t(Ue,{size:"sm",value:Y,onChange:v=>W(v.target.value),width:"90px",children:[e("option",{value:"GB",children:"GB"}),e("option",{value:"TB",children:"TB"})]})]})]})]}),t(te,{spacing:2,align:"stretch",children:[e(u,{fontWeight:"semibold",fontSize:"sm",children:n("adminLimits.tableTitle")}),e(F,{overflowX:"auto",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},borderRadius:"md",p:2,children:t(tt,{size:"sm",variant:"simple",children:[e(rt,{children:t(ye,{children:[e(G,{children:n("adminLimits.tableAdmin")}),e(G,{isNumeric:!0,children:n("adminLimits.tableUsers")}),e(G,{isNumeric:!0,children:n("adminLimits.tableUsersLimit")}),e(G,{isNumeric:!0,children:n("adminLimits.tableTrafficUsed")}),e(G,{isNumeric:!0,children:n("adminLimits.tableTrafficLimit")}),e(G,{textAlign:"right",children:n("adminLimits.tableActions")})]})}),e(nt,{children:V.map(v=>{var q;return t(ye,{bg:$(v)?"red.50":void 0,_dark:$(v)?{bg:"red.900"}:void 0,children:[e(H,{children:v.username}),e(H,{isNumeric:!0,children:v.username===C?_:"-"}),e(H,{isNumeric:!0,children:(q=v.users_limit)!=null?q:"-"}),e(H,{isNumeric:!0,children:I(v.users_usage)}),e(H,{isNumeric:!0,children:v.traffic_limit?I(v.traffic_limit):"-"}),e(H,{textAlign:"right",children:e(D,{size:"xs",variant:"outline",onClick:()=>x(v.username),isDisabled:m,children:n("adminLimits.resetUsage")})})]},v.username)})})]})})]})]})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:B,mr:3,w:"full",variant:"outline",children:n("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"primary",onClick:ae,leftIcon:m?e(Fe,{size:"xs"}):void 0,isDisabled:S||!J,children:n("save")})]})]})]})},Oo=nr(r=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{r({isLoading:!0}),Promise.all([P("/core").then(({version:i,started:n,logs_websocket:a})=>r({version:i,started:n,logs_websocket:a})),P("/core/config").then(i=>r({config:i}))]).finally(()=>r({isLoading:!1}))},updateConfig:i=>(r({isPostLoading:!0}),P("/core/config",{method:"PUT",body:i}).finally(()=>{r({isPostLoading:!1})})),restartCore:()=>P("/core/restart",{method:"POST"})}));window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(r,i,n)=>{i.isDark=!0,i.cssClass="ace-nord-dark",r("../lib/dom").importCssString(i.cssText,i.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(r,i,n)=>{i.isDark=!1,i.cssClass="ace-dawn",r("../lib/dom").importCssString(i.cssText,i.cssClass)});const Fo=h.exports.forwardRef(({json:r,onChange:i,mode:n="code"},a)=>{const{colorMode:o}=Lt(),s={mode:n,onChangeText:i,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},l=h.exports.useRef(null),g=h.exports.useRef(null);return h.exports.useEffect(()=>(g.current=new di(l.current,s),()=>{g.current&&g.current.destroy()}),[]),h.exports.useEffect(()=>{g.current&&g.current.update(r)},[r]),e(F,{ref:a,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(F,{height:"full",ref:l})})}),qn=A.object({name:A.string().min(1),address:A.string().min(1),port:A.number().min(1).or(A.string().transform(r=>parseFloat(r))),api_port:A.number().min(1).or(A.string().transform(r=>parseFloat(r))),xray_version:A.string().nullable().optional(),id:A.number().nullable().optional(),status:A.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:A.string().nullable().optional(),add_as_new_host:A.boolean().optional(),usage_coefficient:A.number().or(A.string().transform(r=>parseFloat(r)))}),Wo=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1}),$t="fetch-nodes-query-key",Zn=()=>{const{isEditingNodes:r}=X();return tr({queryKey:$t,queryFn:Vt.getState().fetchNodes,refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1})},Vt=nr((r,i)=>({nodes:[],addNode(n){return P("/node",{method:"POST",body:n})},fetchNodes(){return P("/nodes")},fetchNodesUsage(n){return P("/nodes/usage",{query:n})},updateNode(n){return P(`/node/${n.id}`,{method:"PUT",body:n})},setDeletingNode(n){r({deletingNode:n})},reconnectNode(n){return P(`/node/${n.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var n;return P(`/node/${(n=i().deletingNode)==null?void 0:n.id}`,{method:"DELETE"})}})),Qr=500,$o=T(xn,{baseStyle:{w:5,h:5}}),Bo=T(_t,{baseStyle:{w:4,h:4}}),Ho=T(hi,{baseStyle:{w:4,h:4}}),jo=T(ui,{baseStyle:{w:3,h:3}}),Vo=r=>({[Rt.ReadyState.CONNECTING]:"connecting",[Rt.ReadyState.OPEN]:"connected",[Rt.ReadyState.CLOSING]:"closed",[Rt.ReadyState.CLOSED]:"closed",[Rt.ReadyState.UNINSTANTIATED]:"closed"})[r],Go=r=>{try{let i=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(i.protocol==="https:"?"wss://":"ws://")+bn([i.host+i.pathname,r?`/node/${r}/logs`:"/core/logs"])+"?interval=1&token="+K()}catch(i){return console.error("Unable to generate websocket url"),console.error(i),null}};let xt=[];const qo=()=>{const{colorMode:r}=Lt(),{data:i}=Zn(),n=!1,[a,o]=h.exports.useState(""),s=($,ae)=>{$!==a&&($==="host"?(o(""),U([])):(o($),U([])))},{isEditingCore:l}=X(),{fetchCoreSettings:g,updateConfig:b,isLoading:C,config:y,isPostLoading:S,version:c,restartCore:m}=Oo(),z=h.exports.useRef(null),[w,U]=h.exports.useState([]),{t:p}=ie(),d=Ce(),Y=At({defaultValues:{config:y||{}}});h.exports.useEffect(()=>{y&&Y.setValue("config",y)},[y]),h.exports.useEffect(()=>{l&&g()},[l]);const W=h.exports.useRef(!0),_=h.exports.useCallback(Sn($=>{var v,q,se;const ae=Math.abs((((v=z.current)==null?void 0:v.scrollTop)||0)-(((q=z.current)==null?void 0:q.scrollHeight)||0)+(((se=z.current)==null?void 0:se.offsetHeight)||0))<10;z.current&&ae?W.current=!0:W.current=!1,$.length<40&&U($)},300),[]),{readyState:R}=pi(Go(a),{onMessage:$=>{xt.push($.data),xt.length>Qr&&(xt=xt.splice(0,xt.length-Qr)),_([...xt])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});h.exports.useEffect(()=>{var $;z.current&&W.current&&(z.current.scrollTop=($=z.current)==null?void 0:$.scrollHeight)},[w]),h.exports.useEffect(()=>()=>{xt=[]},[]);const V=Vo(R.toString()),{mutate:J,isLoading:I}=Wt(m),oe=({config:$})=>{b($).then(()=>{d({title:p("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(ae=>{let v=p("core.generalErrorMessage");typeof ae.response._data.detail=="object"&&(v=ae.response._data.detail[Object.keys(ae.response._data.detail)[0]]),typeof ae.response._data.detail=="string"&&(v=ae.response._data.detail),d({title:v,status:"error",isClosable:!0,position:"top",duration:3e3})})},fe=h.exports.useRef(null),[B,L]=h.exports.useState(!1),x=()=>{var $;document.fullscreenElement?(document.exitFullscreen(),L(!1)):(($=fe.current)==null||$.requestFullscreen(),L(!0))};return t("form",{onSubmit:Y.handleSubmit(oe),children:[t(ge,{children:[t(M,{children:[t(E,{justifyContent:"space-between",alignItems:"flex-start",children:[t(j,{children:[p("core.configuration")," ",C&&e(Cn,{isIndeterminate:!0,size:"15px"})]}),e(E,{gap:0,children:e(_e,{label:"Xray Version",placement:"top",children:e(Q,{height:"100%",textTransform:"lowercase",children:c&&`v${c}`})})})]}),t(F,{position:"relative",ref:fe,minHeight:"300px",children:[e(Be,{control:Y.control,name:"config",render:({field:$})=>e(Fo,{json:y,onChange:$.onChange})}),e(re,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:x,children:B?e(jo,{}):e(Ho,{})})]})]}),t(M,{mt:"4",children:[t(E,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[t(E,{children:[(i==null?void 0:i[0])&&t(Ue,{size:"sm",style:{width:"auto"},disabled:n,bg:"transparent",_dark:{bg:"transparent"},sx:{option:{backgroundColor:r==="dark"?"#222C3B":"white"}},onChange:$=>s($.currentTarget.value,$.currentTarget.selectedOptions[0].text),children:[e("option",{value:"host",defaultChecked:!0,children:"Master"},"host"),i&&i.map($=>e("option",{value:String($.id),children:p($.name)},$.address))]}),e(j,{className:"w-au",children:p("core.logs")})]}),e(u,{as:j,children:p(`core.socket.${V}`)})]}),e(F,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:z,children:w.map(($,ae)=>e(u,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:$},ae))})]})]}),e(xe,{children:t(E,{w:"full",justifyContent:"space-between",children:[e(E,{children:e(F,{children:e(D,{size:"sm",leftIcon:e(Bo,{className:Bt({"animate-spin":I})}),onClick:()=>J(),children:p(I?"core.restarting":"core.restartCore")})})}),e(E,{children:e(D,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:C||S,isLoading:S,children:p("core.save")})})]})})]})},Zo=()=>{const{isEditingCore:r}=X(),i=X.setState.bind(null,{isEditingCore:!1}),{t:n}=ie();return t(de,{isOpen:r,onClose:i,size:"3xl",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",w:"full",children:[e(pe,{pt:6,children:t(E,{gap:2,children:[e(Re,{color:"primary",children:e($o,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:n("core.title")})]})}),e(me,{mt:3}),e(qo,{})]})]})};function Yo(){const{t:r}=ie(),i=Ce(),{isEditingCrypto:n,onEditingCrypto:a}=X(),[o,s]=h.exports.useState(""),[l,g]=h.exports.useState(""),[b,C]=h.exports.useState(""),[y,S]=h.exports.useState(""),[c,m]=h.exports.useState(!1),[z,w]=h.exports.useState(""),{onCopy:U,hasCopied:p}=mi(z),d=()=>{a(!1),s(""),g(""),C(""),S(""),m(!1),w("")},Y=async()=>{var _;try{const R=y.trim();if(!R){i({title:r("cryptoLink.hwidResetEmpty"),status:"warning",duration:2e3,isClosable:!0});return}m(!0);const V=await P("/xpert/hwid/reset",{method:"POST",body:{username:R}});V&&V.cleared?i({title:r("cryptoLink.hwidResetDone"),status:"success",duration:1500,isClosable:!0}):i({title:r("cryptoLink.hwidResetNoData"),status:"info",duration:2500,isClosable:!0})}catch(R){i({title:r("cryptoLink.hwidResetFailed"),description:String((_=R==null?void 0:R.message)!=null?_:R),status:"error",duration:3e3,isClosable:!0})}finally{m(!1)}},W=async()=>{var _;try{if(!o.trim()){i({title:r("cryptoLink.empty"),status:"warning",duration:2e3,isClosable:!0});return}const R={url:o.trim()};l.trim()&&(R.hwid=l.trim()),b&&(R.hwid_limit=Number(b));const V=await P("/xpert/crypto-link",{method:"POST",body:R}),J=V&&(V.encrypted_link||V.link||V.url||V.result||V.data||V.encrypted)||V;if(!J||typeof J!="string")throw new Error("Invalid response");w(J),V&&typeof V.notice=="string"&&V.notice.trim()&&i({title:V.notice,status:"info",duration:3500,isClosable:!0}),i({title:r("cryptoLink.done"),status:"success",duration:1500,isClosable:!0})}catch(R){i({title:r("cryptoLink.failed"),description:String((_=R==null?void 0:R.message)!=null?_:R),status:"error",duration:3e3,isClosable:!0})}};return t(de,{isOpen:n,onClose:d,size:"xl",isCentered:!0,children:[e(he,{}),t(ue,{children:[e(pe,{children:r("cryptoLink.title")}),e(me,{}),t(ge,{children:[t(M,{children:[e(j,{children:r("cryptoLink.input")}),e(ht,{value:o,onChange:_=>s(_.target.value),placeholder:r("cryptoLink.inputPlaceholder"),minH:"120px"})]}),t(M,{mt:4,children:[e(j,{children:r("cryptoLink.hwid")}),e(ce,{value:l,onChange:_=>g(_.target.value),placeholder:r("cryptoLink.hwidPlaceholder")})]}),t(M,{mt:4,children:[e(j,{children:r("cryptoLink.hwidLimit")}),t(Ue,{value:b,onChange:_=>C(_.target.value),children:[e("option",{value:"",children:r("cryptoLink.hwidLimitPlaceholder")}),e("option",{value:"1",children:"1"}),e("option",{value:"2",children:"2"}),e("option",{value:"3",children:"3"}),e("option",{value:"4",children:"4"}),e("option",{value:"5",children:"5"})]})]}),t(M,{mt:4,children:[e(j,{children:r("cryptoLink.hwidResetTitle")}),t(E,{spacing:3,align:"stretch",children:[e(ce,{value:y,onChange:_=>S(_.target.value),placeholder:r("cryptoLink.hwidResetPlaceholder")}),e(D,{onClick:Y,isLoading:c,variant:"outline",children:r("cryptoLink.hwidResetButton")})]})]}),t(M,{mt:4,children:[e(j,{children:r("cryptoLink.output")}),e(ht,{value:z,isReadOnly:!0,placeholder:r("cryptoLink.outputPlaceholder"),minH:"120px"})]})]}),t(xe,{children:[e(D,{onClick:W,colorScheme:"blue",mr:3,children:r("cryptoLink.encrypt")}),e(D,{onClick:U,isDisabled:!z,variant:"outline",mr:3,children:r(p?"cryptoLink.copied":"cryptoLink.copy")}),e(D,{variant:"ghost",onClick:d,children:r("general.cancel")})]})]})]})}const Gt=T(wt,{baseStyle:{w:5,h:5}}),Qo=()=>{const[r,i]=h.exports.useState(!1),{deletingUser:n,onDeletingUser:a,deleteUser:o}=X(),{t:s}=ie(),l=Ce(),g=()=>{a(null)},b=()=>{n&&(i(!0),o(n).then(()=>{l({title:s("deleteUser.deleteSuccess",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(g).finally(i.bind(null,!1)))};return t(de,{isCentered:!0,isOpen:!!n,onClose:g,size:"sm",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"red",children:e(Gt,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:s("deleteUser.title")}),n&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(lt,{components:{b:e("b",{})},children:s("deleteUser.prompt",{username:n.username})})})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:s("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"red",onClick:b,leftIcon:r?e(Fe,{size:"xs"}):void 0,children:s("delete")})]})]})]})},Lr={baseStyle:{w:4,h:4}},Jo=T(gi,Lr),Xo=T(wn,Lr),Ar=T(_t,Lr),Ko=Sn(r=>{X.getState().onFilterChange({...X.getState().filters,offset:0,search:r})},300),es=({...r})=>{const{loading:i,filters:n,onFilterChange:a,refetchUsers:o,onCreateUser:s}=X(),{t:l}=ie(),[g,b]=h.exports.useState(""),C=S=>{b(S.target.value),Ko(S.target.value)},y=()=>{b(""),a({...n,offset:0,search:""})};return t(Yt,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...r,children:[e(Ft,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:t(Qt,{children:[e(fi,{pointerEvents:"none",children:e(Jo,{})}),e(ce,{placeholder:l("search"),value:g,borderColor:"light-border",onChange:C}),t(Jt,{children:[i&&e(Fe,{size:"xs"}),n.search&&n.search.length>0&&e(re,{onClick:y,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Xo,{})})]})]})}),e(Ft,{colSpan:2,order:{base:1,md:2},children:t(E,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(re,{"aria-label":"refresh users",disabled:i,onClick:o,size:"sm",variant:"outline",children:e(Ar,{className:Bt({"animate-spin":i})})}),e(D,{colorScheme:"primary",size:"sm",onClick:()=>s(!0),px:5,children:l("createUser")})]})})]})},ir=r=>e(E,{w:"full",py:"0",position:"relative",...r,children:e(u,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:"Xpert (v1.0) from Ashgabat"})}),ts="https://github.com/mybrohigh/Xpert-Panel",rs=T(bi,{baseStyle:{w:4,h:4}}),Yn=({actions:r})=>{const{i18n:i}=ie();var n=a=>{i.changeLanguage(a)};return t(vn,{placement:"bottom-end",children:[e(_n,{as:re,size:"sm",variant:"outline",icon:e(rs,{}),position:"relative"}),t(kn,{minW:"100px",zIndex:9999,children:[e(Ie,{maxW:"100px",fontSize:"sm",onClick:()=>n("en"),children:"English"}),e(Ie,{maxW:"100px",fontSize:"sm",onClick:()=>n("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Ie,{maxW:"100px",fontSize:"sm",onClick:()=>n("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"}),e(Ie,{maxW:"100px",fontSize:"sm",onClick:()=>n("ru"),children:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"})]})]})},Le={baseStyle:{w:4,h:4}},ns=T(yi,Le),is=T(xi,Le),os=T(xn,Le),ss=T(kr,Le),as=T(Si,Le),ls=T(Ci,Le),cs=T(wi,Le),ds=T(vi,Le),hs=T(zr,Le),us=T(zn,Le),ps=T(rr,Le),ms=T(In,Le),gs=T(yn,Le),Jr=T(F,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),Qn="xpert-menu-notification",fs=()=>{const r=localStorage.getItem(Qn);if(!r)return!0;try{return r&&_i(parseInt(r))?ki(new Date,new Date(parseInt(r)))>=7:!0}catch{return!0}},Ur=({actions:r})=>{const{userData:i,getUserIsSuccess:n,getUserIsPending:a}=Vn(),o=()=>!a&&n?i.is_sudo:!1,{onEditingHosts:s,onResetAllUsage:l,onEditingNodes:g,onShowingNodesUsage:b,onEditingAdminLimits:C,onEditingCrypto:y}=X(),{t:S}=ie(),{colorMode:c,toggleColorMode:m}=Lt(),[z,w]=h.exports.useState(fs()),U=()=>{localStorage.setItem(Qn,new Date().getTime().toString()),w(!1)};return t(E,{gap:2,justifyContent:"space-between",__css:{"& .menuList":{direction:"ltr"}},position:"relative",children:[t(E,{children:[e(Mt,{to:"/",children:e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",cursor:"pointer",_hover:{color:"primary.500"},children:S("users")})}),o()&&t(ze,{children:[e(u,{fontSize:"2xl",color:"gray.400",children:"|"}),e(Mt,{to:"/xpert/",children:e(u,{as:"h1",fontWeight:"semibold",fontSize:"2xl",cursor:"pointer",_hover:{color:"primary.500"},children:"Xpert Panel"})})]})]}),z&&e(Jr,{top:"0",right:"0",zIndex:9999}),e(F,{overflow:"auto",css:{direction:"rtl"},children:t(E,{alignItems:"center",children:[t(vn,{children:[e(_n,{as:re,size:"sm",variant:"outline",icon:e(ze,{children:e(ls,{})}),position:"relative"}),t(kn,{minW:"170px",zIndex:99999,className:"menuList",children:[o()&&t(ze,{children:[e(Ie,{maxW:"170px",fontSize:"sm",icon:e(hs,{}),onClick:s.bind(null,!0),children:S("header.hostSettings")}),e(Ie,{maxW:"170px",fontSize:"sm",icon:e(us,{}),onClick:g.bind(null,!0),children:S("header.nodeSettings")}),e(Ie,{maxW:"170px",fontSize:"sm",icon:e(ps,{}),onClick:b.bind(null,!0),children:S("header.nodesUsage")}),e(Ie,{maxW:"170px",fontSize:"sm",icon:e(ms,{}),onClick:l.bind(null,!0),children:S("resetAllUsage")}),e(Ie,{maxW:"170px",fontSize:"sm",icon:e(gs,{}),onClick:C.bind(null,!0),children:S("adminLimits.menu")}),e(Mt,{to:"/traffic/",children:e(Ie,{maxW:"170px",fontSize:"sm",icon:e(ss,{}),onClick:U,children:S("traffic.menu")})})]}),e(Ie,{maxW:"170px",fontSize:"sm",icon:e(as,{}),onClick:y.bind(null,!0),children:S("cryptoLink.menu")}),e(Mt,{to:ts,target:"_blank",children:t(Ie,{maxW:"170px",fontSize:"sm",icon:e(ds,{}),position:"relative",onClick:U,children:[S("header.donation")," ",z&&e(Jr,{top:"3",right:"2"})]})}),e(Mt,{to:"/login",children:e(Ie,{maxW:"170px",fontSize:"sm",icon:e(cs,{}),children:S("header.logout")})})]})]}),o()&&e(re,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{X.setState({isEditingCore:!0})},children:e(os,{})}),e(Yn,{}),e(re,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{jn(c=="dark"?"light":"dark"),m()},children:c==="light"?e(ns,{}):e(is,{})}),e(F,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}}})]})})]})},bs=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],ys=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],xs=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(r=>({title:r,value:r}))],Ss=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],Cs=["aes-128-gcm","aes-256-gcm","chacha20-ietf-poly1305"],ws=nr(r=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{r({isLoading:!0}),P("/hosts").then(i=>r({hosts:i})).finally(()=>r({isLoading:!1}))},setHosts:i=>(r({isPostLoading:!0}),P("/hosts",{method:"PUT",body:i}).finally(()=>{r({isPostLoading:!1})}))}));const vs=T(wn,{baseStyle:{w:4,h:4}}),dt=yr.forwardRef(({disabled:r,step:i,label:n,className:a,startAdornment:o,endAdornment:s,type:l="text",placeholder:g,onChange:b,onBlur:C,name:y,value:S,onClick:c,error:m,clearable:z=!1,...w},U)=>{const p=()=>{b&&b({target:{value:"",name:y}})},{size:d="md"}=w,Y=l=="number"?mr:ce,W=l=="number"?pr:yr.Fragment,_=l=="number"?{keepWithinRange:!0,precision:5,format:R=>isNaN(parseFloat(String(R)))||Number(parseFloat(String(R)).toFixed(5))===0?R:Number(parseFloat(String(R)).toFixed(5)),min:0,step:i,name:y,type:l,placeholder:g,onChange:R=>{b&&b({target:{value:R,name:y}})},onBlur:C,value:S,onClick:c,disabled:r,flexGrow:1,size:d}:{};return t(M,{isInvalid:!!m,children:[n&&e(j,{children:n}),t(Qt,{size:d,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:r?"gray.100":"transparent",_dark:{bg:r?"gray.600":"transparent"},children:[o&&e(zi,{children:o}),t(W,{..._,children:[e(Y,{name:y,ref:U,step:i,className:Bt(a),type:l,placeholder:g,onChange:l=="number"?void 0:b,onBlur:l=="number"?void 0:C,value:l=="number"?void 0:S,onClick:c,disabled:r,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...w,roundedLeft:o?"0":"md",roundedRight:s?"0":"md"}),l=="number"&&e(ze,{children:t(gr,{children:[e(fr,{}),e(br,{})]})})]}),s&&e(Ii,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:s}),z&&S&&S.length&&e(Jt,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:p,cursor:"pointer",children:e(vs,{})})]}),!!m&&e(Xt,{children:m})]})}),_s=T(Di,{baseStyle:{w:5,h:5}}),ks=T(Dn,{baseStyle:{w:5,h:5}}),zs=T(En,{baseStyle:{w:5,h:5}}),lr=T(Ue,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),at=T(dt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Is=T(zr,{baseStyle:{w:5,h:5}}),Xe=T(Ei,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Ds=A.record(A.string().min(1),A.array(A.object({remark:A.string().min(1,"Remark is required"),address:A.string().min(1,"Address is required"),port:A.string().or(A.number()).nullable().transform(r=>typeof r=="number"?r:r!==null&&!isNaN(parseInt(r))?Number(parseInt(r)):null),path:A.string().nullable(),sni:A.string().nullable(),host:A.string().nullable(),mux_enable:A.boolean().default(!1),allowinsecure:A.boolean().nullable().default(!1),is_disabled:A.boolean().default(!0),fragment_setting:A.string().nullable(),noise_setting:A.string().nullable(),random_user_agent:A.boolean().default(!1),security:A.string(),alpn:A.string(),fingerprint:A.string(),use_sni_as_host:A.boolean().default(!1)}))),Ne=T(Xt,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),Es=({hostKey:r,isOpen:i,toggleAccordion:n})=>{const{inbounds:a}=X(),o=[...a.values()].flat().filter(p=>p.tag===r)[0],s=Ir(),{fields:l,append:g,remove:b,insert:C,move:y}=Ti({control:s.control,name:r}),{errors:S}=s.formState,{t:c}=ie(),m=S[r],z=()=>{g({host:"",sni:"",port:null,path:null,address:"",remark:"",mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1})},w=p=>{if(p<0||p>=l.length)return;const d=l[p];C(p+1,d)};h.exports.useEffect(()=>{m&&!i&&n()},[m]);const U=(p,d)=>{d==="up"&&p>0?y(p,p-1):d==="down"&&p<l.length-1&&y(p,p+1)};return t(Dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(Et,{px:2,borderRadius:"3px",onClick:n,children:[e(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:r}),e(xr,{})]}),e(Tt,{px:2,pb:2,children:t(te,{gap:3,children:[l.map((p,d)=>{var Y,W,_,R,V,J,I,oe,fe,B,L,x,$,ae,v,q,se,Me,We,kt,mt,gt,ft,bt,yt,N,ee,be,we,ke,Pe,zt,ne,ot,st,f,k,O,Z,$e,It,Pr,Nr,Or,Fr;return e(Li.div,{layout:!0,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{layout:{type:"spring",stiffness:500,damping:30},opacity:{duration:.1}},id:p.id,whileDrag:{scale:1.05,zIndex:10},style:{width:"100%"},children:t(te,{id:p.id,border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(E,{w:"100%",alignItems:"flex-start",children:t(M,{position:"relative",zIndex:10,isInvalid:!!(m&&((Y=m[d])==null?void 0:Y.remark)),children:[t(Qt,{children:[e(at,{...s.register(r+"."+d+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(Jt,{children:t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(F,{mt:"-8px",children:e(Xe,{})})}),e(Ze,{children:t(Ye,{children:[e(Qe,{}),e(Je,{}),e($r,{children:t(F,{fontSize:"xs",children:[e(u,{pr:"20px",children:c("hostsDialog.desc")}),t(u,{children:[t(Q,{children:["{","SERVER_IP","}"]})," ",c("hostsDialog.currentServer")]}),t(u,{mt:1,children:[t(Q,{children:["{","SERVER_IPV6","}"]})," ",c("hostsDialog.currentServerv6")]}),t(u,{mt:1,children:[t(Q,{children:["{","USERNAME","}"]})," ",c("hostsDialog.username")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_USAGE","}"]})," ",c("hostsDialog.dataUsage")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_LEFT","}"]})," ",c("hostsDialog.remainingData")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_LIMIT","}"]})," ",c("hostsDialog.dataLimit")]}),t(u,{mt:1,children:[t(Q,{children:["{","DAYS_LEFT","}"]})," ",c("hostsDialog.remainingDays")]}),t(u,{mt:1,children:[t(Q,{children:["{","EXPIRE_DATE","}"]})," ",c("hostsDialog.expireDate")]}),t(u,{mt:1,children:[t(Q,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",c("hostsDialog.jalaliExpireDate")]}),t(u,{mt:1,children:[t(Q,{children:["{","TIME_LEFT","}"]})," ",c("hostsDialog.remainingTime")]}),t(u,{mt:1,children:[t(Q,{children:["{","STATUS_TEXT","}"]})," ",c("hostsDialog.statusText")]}),t(u,{mt:1,children:[t(Q,{children:["{","STATUS_EMOJI","}"]})," ",c("hostsDialog.statusEmoji")]}),t(u,{mt:1,children:[t(Q,{children:["{","PROTOCOL","}"]})," ",c("hostsDialog.proxyProtocol")]}),t(u,{mt:1,children:[t(Q,{children:["{","TRANSPORT","}"]})," ",c("hostsDialog.proxyMethod")]})]})})]})})]})})]}),m&&((W=m[d])==null?void 0:W.remark)&&e(Ne,{children:(R=(_=m[d])==null?void 0:_.remark)==null?void 0:R.message})]})}),t(M,{isInvalid:!!(m&&((V=m[d])==null?void 0:V.address)),children:[t(Qt,{children:[e(at,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...s.register(r+"."+d+".address")}),e(Jt,{children:t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(F,{mt:"-8px",children:e(Xe,{})})}),e(Ze,{children:t(Ye,{children:[e(Qe,{}),e(Je,{}),e($r,{children:t(F,{fontSize:"xs",children:[e(u,{pr:"20px",children:c("hostsDialog.desc")}),t(u,{children:[t(Q,{children:["{","SERVER_IP","}"]})," ",c("hostsDialog.currentServer")]}),t(u,{mt:1,children:[t(Q,{children:["{","SERVER_IPV6","}"]})," ",c("hostsDialog.currentServerv6")]}),t(u,{mt:1,children:[t(Q,{children:["{","USERNAME","}"]})," ",c("hostsDialog.username")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_USAGE","}"]})," ",c("hostsDialog.dataUsage")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_LEFT","}"]})," ",c("hostsDialog.remainingData")]}),t(u,{mt:1,children:[t(Q,{children:["{","DATA_LIMIT","}"]})," ",c("hostsDialog.dataLimit")]}),t(u,{mt:1,children:[t(Q,{children:["{","DAYS_LEFT","}"]})," ",c("hostsDialog.remainingDays")]}),t(u,{mt:1,children:[t(Q,{children:["{","EXPIRE_DATE","}"]})," ",c("hostsDialog.expireDate")]}),t(u,{mt:1,children:[t(Q,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",c("hostsDialog.jalaliExpireDate")]}),t(u,{mt:1,children:[t(Q,{children:["{","TIME_LEFT","}"]})," ",c("hostsDialog.remainingTime")]}),t(u,{mt:1,children:[t(Q,{children:["{","STATUS_TEXT","}"]})," ",c("hostsDialog.statusText")]}),t(u,{mt:1,children:[t(Q,{children:["{","STATUS_EMOJI","}"]})," ",c("hostsDialog.statusEmoji")]}),t(u,{mt:1,children:[t(Q,{children:["{","PROTOCOL","}"]})," ",c("hostsDialog.proxyProtocol")]}),t(u,{mt:1,children:[t(Q,{children:["{","TRANSPORT","}"]})," ",c("hostsDialog.proxyMethod")]})]})})]})})]})})]}),m&&((J=m[d])==null?void 0:J.address)&&e(Ne,{children:(oe=(I=m[d])==null?void 0:I.address)==null?void 0:oe.message})]}),e(jt,{w:"full",allowToggle:!0,children:t(Dt,{border:"0",children:[t("div",{style:{display:"flex",alignItems:"center"},children:[t(Et,{display:"flex",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[t(u,{flex:"3",align:"start",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[c("hostsDialog.advancedOptions"),e(xr,{fontSize:"sm",ml:1})]}),t(Ai,{flex:"1",px:"0",display:"contents",children:[e(Be,{control:s.control,name:`${r}.${d}.is_disabled`,render:({field:ve})=>e(vt,{mx:"1.5",colorScheme:"primary",...ve,value:void 0,isChecked:!ve.value,onChange:Wr=>{console.log(Wr.target.checked),ve.onChange(!Wr.target.checked)}})}),e(_e,{label:"Delete",placement:"top",children:e(re,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:b.bind(null,d),children:e(Gt,{})})})]})]}),e(_e,{label:"Duplicate",placement:"top",children:e(re,{"aria-label":"Duplicate",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>w(d),children:e(_s,{})})}),d<l.length-1&&e(_e,{label:"Move Down",placement:"top",children:e(re,{"aria-label":"DownIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>U(d,"down"),children:e(zs,{})})}),d>0&&e(_e,{label:"Move Up",placement:"top",children:e(re,{"aria-label":"UpIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>U(d,"up"),children:e(ks,{})})})]}),e(Tt,{w:"full",p:1,children:t(te,{w:"full",borderRadius:"4px",children:[t(M,{isInvalid:!!(m&&((fe=m[d])==null?void 0:fe.port)),children:[t(j,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:c("hostsDialog.port")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.port.info")})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:String(o.port||"8080"),type:"number",...s.register(r+"."+d+".port")})]}),t(M,{isInvalid:!!(m&&((B=m[d])==null?void 0:B.sni)),children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.sni")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.sni.info")}),e(u,{fontSize:"xs",mt:"2",children:e(lt,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(Q,{})}})}),e(u,{fontSize:"xs",children:e(lt,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(Q,{})}})})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...s.register(r+"."+d+".sni")}),m&&((L=m[d])==null?void 0:L.sni)&&e(Ne,{children:($=(x=m[d])==null?void 0:x.sni)==null?void 0:$.message})]}),t(M,{isInvalid:!!(m&&((ae=m[d])==null?void 0:ae.host)),children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.host")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.host.info")}),e(u,{fontSize:"xs",mt:"2",children:e(lt,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(Q,{})}})}),e(u,{fontSize:"xs",children:e(lt,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(Q,{})}})})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...s.register(r+"."+d+".host")}),m&&((v=m[d])==null?void 0:v.host)&&e(Ne,{children:(se=(q=m[d])==null?void 0:q.host)==null?void 0:se.message})]}),t(M,{isInvalid:!!(m&&((Me=m[d])==null?void 0:Me.path)),children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.path")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.path.info")})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:"path (e.g. /vless)",...s.register(r+"."+d+".path")}),m&&((We=m[d])==null?void 0:We.path)&&e(Ne,{children:(mt=(kt=m[d])==null?void 0:kt.path)==null?void 0:mt.message})]}),t(M,{height:"66px",children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.security")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.security.info")})]})})]})]}),e(lr,{size:"sm",...s.register(r+"."+d+".security"),children:bs.map(ve=>e("option",{value:ve.value,children:ve.title},ve.value))})]}),t(M,{height:"66px",children:[e(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:c("hostsDialog.alpn")})}),e(lr,{size:"sm",...s.register(r+"."+d+".alpn"),children:ys.map(ve=>e("option",{value:ve.value,children:ve.title},ve.value))})]}),t(M,{height:"66px",children:[e(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:c("hostsDialog.fingerprint")})}),e(lr,{size:"sm",...s.register(r+"."+d+".fingerprint"),children:xs.map(ve=>e("option",{value:ve.value,children:ve.title},ve.value))})]}),t(M,{isInvalid:!!(m&&((gt=m[d])==null?void 0:gt.fragment_setting)),children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.fragment")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.fragment.info")}),e(u,{fontSize:"xs",pr:5,pt:2,pb:1,children:c("hostsDialog.fragment.info.examples")}),e(u,{fontSize:"xs",pr:5,children:"100-200,10-20,tlshello"}),e(u,{fontSize:"xs",pr:5,children:"100-200,10-20,1-3"}),e(u,{fontSize:"xs",pr:5,pt:"3",children:c("hostsDialog.fragment.info.attention")})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:"Fragment settings by pattern",...s.register(r+"."+d+".fragment_setting")}),m&&((ft=m[d])==null?void 0:ft.fragment_setting)&&e(Ne,{children:(yt=(bt=m[d])==null?void 0:bt.fragment_setting)==null?void 0:yt.message})]}),t(M,{isInvalid:!!(m&&((N=m[d])==null?void 0:N.noise_setting)),children:[t(j,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:c("hostsDialog.noise")}),t(Ge,{isLazy:!0,placement:"right",children:[e(qe,{children:e(Xe,{})}),e(Ze,{children:t(Ye,{p:2,children:[e(Qe,{}),e(Je,{}),e(u,{fontSize:"xs",pr:5,children:c("hostsDialog.noise.info")}),e(u,{fontSize:"xs",pr:5,pt:2,pb:1,children:c("hostsDialog.noise.info.examples")}),e(u,{fontSize:"xs",pr:5,children:"rand:10-20,10-20"}),e(u,{fontSize:"xs",pr:5,children:"rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25"}),e(u,{fontSize:"xs",pr:5,pt:"3",children:c("hostsDialog.noise.info.attention")})]})})]})]}),e(at,{size:"sm",borderRadius:"4px",placeholder:"Noise settings by pattern",...s.register(r+"."+d+".noise_setting")}),m&&((ee=m[d])==null?void 0:ee.noise_setting)&&e(Ne,{children:(we=(be=m[d])==null?void 0:be.noise_setting)==null?void 0:we.message})]}),t(M,{isInvalid:!!(m&&((ke=m[d])==null?void 0:ke.use_sni_as_host)),children:[e(ct,{...s.register(r+"."+d+".use_sni_as_host"),children:e(j,{children:c("hostsDialog.useSniAsHost")})}),m&&((Pe=m[d])==null?void 0:Pe.use_sni_as_host)&&e(Ne,{children:(ne=(zt=m[d])==null?void 0:zt.use_sni_as_host)==null?void 0:ne.message})]}),e(M,{isInvalid:!!(m&&((ot=m[d])==null?void 0:ot.allowinsecure)),children:t(ct,{...s.register(r+"."+d+".allowinsecure"),name:r+"."+d+".allowinsecure",children:[e(j,{children:c("hostsDialog.allowinsecure")}),m&&((st=m[d])==null?void 0:st.allowinsecure)&&e(Ne,{children:(k=(f=m[d])==null?void 0:f.allowinsecure)==null?void 0:k.message})]})}),t(M,{isInvalid:!!(m&&((O=m[d])==null?void 0:O.mux_enable)),children:[e(ct,{...s.register(r+"."+d+".mux_enable"),children:e(j,{children:c("hostsDialog.muxEnable")})}),m&&((Z=m[d])==null?void 0:Z.mux_enable)&&e(Ne,{children:(It=($e=m[d])==null?void 0:$e.mux_enable)==null?void 0:It.message})]}),t(M,{isInvalid:!!(m&&((Pr=m[d])==null?void 0:Pr.random_user_agent)),children:[e(ct,{...s.register(r+"."+d+".random_user_agent"),children:e(j,{children:c("hostsDialog.randomUserAgent")})}),m&&((Nr=m[d])==null?void 0:Nr.random_user_agent)&&e(Ne,{children:(Fr=(Or=m[d])==null?void 0:Or.random_user_agent)==null?void 0:Fr.message})]})]},d)})]})})]},p.id)},p.id)}),e(D,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:z,children:c("hostsDialog.addHost")})]})})]})},Ts=()=>{const{isEditingHosts:r,onEditingHosts:i,refetchUsers:n,inbounds:a}=X(),{isLoading:o,hosts:s,fetchHosts:l,isPostLoading:g,setHosts:b}=ws(),C=Ce(),{t:y}=ie(),[S,c]=h.exports.useState({});h.exports.useEffect(()=>{r&&l()},[r]);const m=At({resolver:Ht(Ds)});h.exports.useEffect(()=>{s&&r&&m.reset(s)},[s]);const z=()=>{c({}),i(!1)},w=p=>{b(p).then(()=>{C({title:y("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),n()}).catch(d=>{var Y,W,_,R,V;(((Y=d==null?void 0:d.response)==null?void 0:Y.status)===409||((W=d==null?void 0:d.response)==null?void 0:W.status)===400)&&C({title:(R=(_=d.response)==null?void 0:_._data)==null?void 0:R.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((V=d==null?void 0:d.response)==null?void 0:V.status)===422&&Object.keys(d.response._data.detail).forEach(J=>{C({title:d.response._data.detail[J]+" ("+J+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},U=p=>{S[String(p)]?delete S[String(p)]:S[String(p)]={},c({...S})};return t(de,{isOpen:r,onClose:z,children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(pe,{pt:6,children:e(Re,{color:"primary",children:e(Is,{color:"white"})})}),e(me,{mt:3}),e(ge,{w:"440px",pb:3,pt:3,children:e(Tn,{...m,children:t("form",{onSubmit:m.handleSubmit(w),children:[e(u,{mb:3,opacity:.8,fontSize:"sm",children:y("hostsDialog.title")}),o&&y("hostsDialog.loading"),!o&&s&&(Object.keys(s).length>0?e(jt,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(S).map(p=>parseInt(p)),children:e(te,{w:"full",children:Object.keys(s).map((p,d)=>e(Es,{toggleAccordion:()=>U(d),isOpen:S[String(d)],hostKey:p},p))})}):"No inbound found. Please check your Xray config file."),e(E,{justifyContent:"flex-end",py:2,children:e(D,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:g,disabled:g,children:y("hostsDialog.apply")})})]})})})]})]})},Rr=(r,i,n)=>{if(r.response&&r.response._data){if(typeof r.response._data.detail=="string")return i({title:r.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof r.response._data.detail=="object"&&n){Object.keys(r.response._data.detail).forEach(a=>n.setError(a,{message:r.response._data.detail[a]}));return}}return i({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Mr=(r,i)=>i({title:r,status:"success",isClosable:!0,position:"top",duration:3e3}),Ls=({deleteCallback:r})=>{const{deleteNode:i,deletingNode:n,setDeletingNode:a}=Vt(),{t:o}=ie(),s=Ce(),l=Dr(),g=()=>{a(null)},{isLoading:b,mutate:C}=Wt(i,{onSuccess:()=>{Mr(o("deleteNode.deleteSuccess",{name:n&&n.name}),s),a(null),l.invalidateQueries($t),r&&r()},onError:y=>{Rr(y,s)}});return t(de,{isCentered:!0,isOpen:!!n,onClose:g,size:"sm",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"red",children:e(Gt,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),n&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(lt,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:n.name})})})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"red",onClick:()=>C(),leftIcon:b?e(Fe,{size:"xs"}):void 0,children:o("delete")})]})]})]})},qt={baseStyle:{strokeWidth:"2px",w:4,h:4}},Xr=T(Ui,qt),As=T(Ri,qt),Kr=T(Mi,qt),en=T(Ln,qt),Us=T(Ln,qt),wr=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Ct={active:{statusColor:"green",bandWidthColor:"primary",icon:Xr},connected:{statusColor:"green",bandWidthColor:"primary",icon:Xr},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:As},expired:{statusColor:"orange",bandWidthColor:"orange",icon:en},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Us},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:en},limited:{statusColor:"red",bandWidthColor:"red",icon:Kr},error:{statusColor:"red",bandWidthColor:"red",icon:Kr}},or=r=>{let i={status:"",time:""};if(r){le(r*1e3).utc().isAfter(le().utc())?i.status="expires":i.status="expired";const n=[],a=le.duration(le(r*1e3).utc().diff(le()));a.years()!=0&&n.push(Math.abs(a.years())+" year"+(Math.abs(a.years())!=1?"s":"")),a.months()!=0&&n.push(Math.abs(a.months())+" month"+(Math.abs(a.months())!=1?"s":"")),a.days()!=0&&n.push(Math.abs(a.days())+" day"+(Math.abs(a.days())!=1?"s":"")),n.length===0&&(a.hours()!=0&&n.push(Math.abs(a.hours())+" hour"+(Math.abs(a.hours())!=1?"s":"")),a.minutes()!=0&&n.push(Math.abs(a.minutes())+" min"+(Math.abs(a.minutes())!=1?"s":""))),i.time=n.join(", ")}return i},Rs=({expiryDate:r,status:i,compact:n=!1,showDetail:a=!0,extraText:o})=>{const{t:s}=ie(),l=or(r),g=Ct[i].icon;return t(ze,{children:[t(Q,{colorScheme:Ct[i].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(g,{w:n?3:4}),a&&t(u,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[i&&s(`nodeModal.status.${i}`),o&&`: ${o}`]})]}),a&&r&&e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:s(l.status,{time:l.time})})]})},Pt=T(dt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Ms=T(zn,{baseStyle:{w:5,h:5}}),Ps=T(Er,{baseStyle:{w:5,h:5,strokeWidth:2}}),Ns=({toggleAccordion:r,node:i})=>{const{updateNode:n,reconnectNode:a,setDeletingNode:o}=Vt(),{t:s}=ie(),l=Dr(),g=Ce(),b=At({defaultValues:i,resolver:Ht(qn)}),C=o.bind(null,i),{isLoading:y,mutate:S}=Wt(n,{onSuccess:()=>{Mr("Node updated successfully",g),l.invalidateQueries($t)},onError:w=>{Rr(w,g,b)}}),{isLoading:c,mutate:m}=Wt(a.bind(null,i),{onSuccess:()=>{l.invalidateQueries($t)}}),z=c?"connecting":i.status?i.status:"error";return t(Dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(Et,{px:2,borderRadius:"3px",onClick:r,children:[t(E,{w:"full",justifyContent:"space-between",pr:2,children:[e(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:i.name}),t(E,{children:[i.xray_version&&e(Q,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:t(u,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",i.xray_version]})}),i.status&&e(Rs,{status:z,compact:!0})]})]}),e(xr,{})]}),t(Tt,{px:2,pb:2,children:[e(te,{pb:3,alignItems:"flex-start",children:z==="error"&&e(it,{status:"error",size:"xs",children:t(F,{children:[t(E,{w:"full",children:[e(pt,{w:4}),e(u,{marginInlineEnd:0,children:i.message})]}),e(E,{justifyContent:"flex-end",w:"full",children:e(D,{size:"sm","aria-label":"reconnect node",leftIcon:e(Ar,{}),onClick:()=>m(),disabled:c,children:s(c?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(Jn,{form:b,mutate:S,isLoading:y,submitBtnText:s("nodes.editNode"),btnLeftAdornment:e(_e,{label:s("delete"),placement:"top",children:e(re,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:C,children:e(Gt,{})})})})]})]})},Os=({toggleAccordion:r,resetAccordions:i})=>{const n=Ce(),{t:a}=ie(),o=Dr(),{addNode:s}=Vt(),l=At({resolver:Ht(qn),defaultValues:{...Wo(),add_as_new_host:!1}}),{isLoading:g,mutate:b}=Wt(s,{onSuccess:()=>{Mr(a("nodes.addNodeSuccess",{name:l.getValues("name")}),n),o.invalidateQueries($t),l.reset(),i()},onError:C=>{Rr(C,n,l)}});return t(Dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(Et,{px:2,borderRadius:"3px",onClick:r,children:t(u,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(Ps,{display:"inline-block"})," ",e("span",{children:a("nodes.addNewMarzbanNode")})]})}),e(Tt,{px:2,py:4,children:e(Jn,{form:l,mutate:b,isLoading:g,submitBtnText:a("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},Jn=({form:r,mutate:i,isLoading:n,submitBtnText:a,btnProps:o={},btnLeftAdornment:s,addAsHost:l=!1})=>{var m,z,w,U,p,d,Y,W,_,R,V,J,I,oe,fe;const{t:g}=ie(),[b,C]=h.exports.useState(!1),{data:y,isLoading:S}=tr({queryKey:"node-settings",queryFn:()=>P("/node/settings")});function c(B){if(document.body.createTextRange){const L=document.body.createTextRange();L.moveToElementText(B),L.select()}else if(window.getSelection){const L=window.getSelection(),x=document.createRange();x.selectNodeContents(B),L.removeAllRanges(),L.addRange(x)}else console.warn("Could not select text in node: Unsupported browser.")}return e("form",{onSubmit:r.handleSubmit(B=>i(B)),children:t(te,{children:[y&&y.certificate&&e(it,{status:"info",alignItems:"start",children:t(Kt,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e("span",{children:g("nodes.connection-hint")}),t(E,{justify:"end",py:2,children:[e(D,{as:"a",colorScheme:"primary",size:"xs",download:"ssl_client_cert.pem",href:URL.createObjectURL(new Blob([y.certificate],{type:"text/plain"})),children:g("nodes.download-certificate")}),e(_e,{placement:"top",label:g("nodes.show-certificate"),children:e(re,{"aria-label":g("nodes.show-certificate"),onClick:C.bind(null,!b),colorScheme:"whiteAlpha",color:"primary",size:"xs",children:b?e(Un,{width:"15px"}):e(An,{width:"15px"})})})]}),e(Rn,{in:b,animateOpacity:!0,children:e(u,{bg:"rgba(255,255,255,.5)",_dark:{bg:"rgba(255,255,255,.2)"},rounded:"md",p:"2",lineHeight:"1.2",fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",onClick:B=>{c(B.target)},children:y.certificate})})]})}),t(E,{w:"full",children:[e(M,{children:e(Pt,{label:g("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...r.register("name"),error:(w=(z=(m=r.formState)==null?void 0:m.errors)==null?void 0:z.name)==null?void 0:w.message})}),e(E,{px:1,children:e(Be,{name:"status",control:r.control,render:({field:B})=>e(_e,{placement:"top",label:`${g("usersTable.status")}: `+(B.value!=="disabled"?g("active"):g("disabled")),textTransform:"capitalize",children:e(F,{mt:"6",children:e(vt,{colorScheme:"primary",isChecked:B.value!=="disabled",onChange:L=>{L.target.checked?B.onChange("connecting"):B.onChange("disabled")}})})},B.value)})})]}),e(E,{alignItems:"flex-start",w:"100%",children:e(F,{w:"100%",children:e(Pt,{label:g("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...r.register("address"),error:(d=(p=(U=r.formState)==null?void 0:U.errors)==null?void 0:p.address)==null?void 0:d.message})})}),t(E,{alignItems:"flex-start",w:"100%",children:[e(F,{children:e(Pt,{label:g("nodes.nodePort"),size:"sm",placeholder:"62050",...r.register("port"),error:(_=(W=(Y=r.formState)==null?void 0:Y.errors)==null?void 0:W.port)==null?void 0:_.message})}),e(F,{children:e(Pt,{label:g("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...r.register("api_port"),error:(J=(V=(R=r.formState)==null?void 0:R.errors)==null?void 0:V.api_port)==null?void 0:J.message})}),e(F,{children:e(Pt,{label:g("nodes.usageCoefficient"),size:"sm",placeholder:"1",...r.register("usage_coefficient"),error:(fe=(oe=(I=r.formState)==null?void 0:I.errors)==null?void 0:oe.usage_coefficient)==null?void 0:fe.message})})]}),l&&e(M,{py:1,children:e(ct,{...r.register("add_as_new_host"),children:e(j,{m:0,children:g("nodes.addHostForEveryInbound")})})}),t(E,{w:"full",children:[s,e(D,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:n,...o,children:a})]})]})})},Fs=()=>{const{isEditingNodes:r,onEditingNodes:i}=X(),{t:n}=ie(),[a,o]=h.exports.useState({}),{data:s,isLoading:l}=Zn(),g=()=>{o({}),i(!1)},b=C=>{a[String(C)]?delete a[String(C)]:a[String(C)]={},o({...a})};return t(ze,{children:[t(de,{isOpen:r,onClose:g,children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(pe,{pt:6,children:e(Re,{color:"primary",children:e(Ms,{color:"white"})})}),e(me,{mt:3}),t(ge,{w:"440px",pb:6,pt:3,children:[e(u,{mb:3,opacity:.8,fontSize:"sm",children:n("nodes.title")}),l&&"loading...",e(jt,{w:"full",allowToggle:!0,index:Object.keys(a).map(C=>parseInt(C)),children:t(te,{w:"full",children:[!l&&s&&s.map((C,y)=>e(Ns,{toggleAccordion:()=>b(y),node:C},C.name)),e(Os,{toggleAccordion:()=>b((s||[]).length),resetAccordions:()=>o({})})]})})]})]})]}),e(Ls,{deleteCallback:()=>o({})})]})};function Ws(r){const i=360/r,n=90,a=47,o=[];for(let s=0;s<r;s++){const l=s*i%360+140,g=$s(l,n,a);o.push(g)}return o}function $s(r,i,n){r/=360,i/=100,n/=100;let a,o,s;if(i===0)a=o=s=n;else{const g=(y,S,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?y+(S-y)*6*c:c<.5?S:c<.6666666666666666?y+(S-y)*(.6666666666666666-c)*6:y),b=n<.5?n*(1+i):n+i-n*i,C=2*n-b;a=Math.round(g(C,b,r+1/3)*255),o=Math.round(g(C,b,r)*255),s=Math.round(g(C,b,r-1/3)*255)}const l=g=>{const b=g.toString(16);return b.length===1?"0"+b:b};return`#${l(a)}${l(o)}${l(s)}`}const tn=({border:r,...i})=>{const{getInputProps:n,getRadioProps:a}=$i(i),o=St({base:"xs",md:"sm"});return t(F,{as:"label",children:[e("input",{...n()}),e(F,{...a(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:r?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:i.children})]})},Xn=({onChange:r,defaultValue:i,...n})=>{const{t:a,i18n:o}=ie();Lt();const s=St({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),l={h:"hour",d:"day",w:"week",m:"month",y:"year"},g=St({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:b,getRadioProps:C,setValue:y}=Pi({name:"filter",defaultValue:i,onChange:B=>{if(B==="custom")return;m(),s.indexOf(B)>=0?(U(a("userDialog.custom")),d(!1)):(U(a("userDialog.custom")+` (${B})`),d(!0));const L=Number(B.substring(0,B.length-1)),x=l[B[B.length-1]];r(B,{start:le().utc().subtract(L,x).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:S,onOpen:c,onClose:m}=Ve(),z=h.exports.useRef(null);Ni({ref:z,handler:m});const[w,U]=h.exports.useState(a("userDialog.custom")),[p,d]=h.exports.useState(!1),[Y,W]=h.exports.useState(0),_=St({base:1,md:2}),R=St({base:"xs",md:"sm"}),[V,J]=h.exports.useState(null),[I,oe]=h.exports.useState(null),fe=B=>{const[L,x]=B;I&&!x?(J(null),oe(null)):(J(L),oe(x),L&&x&&(m(),r("custom",{start:le(L).format("YYYY-MM-DDT00:00:00"),end:le(x).format("YYYY-MM-DDT23:59:59")})))};return t(te,{...n,children:[Y==0&&t(Tr,{...b(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[s.map(B=>e(tn,{...C({value:B}),children:B},B)),e(F,{onClick:()=>{J(null),oe(null),c()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:R,px:3,py:1,bg:p?"primary.500":"unset",color:p?"white":"unset",borderColor:p?"primary.500":"unset",children:t(E,{children:[e(u,{children:w}),e(sr,{as:Br,boxSize:"18px"})]})})]}),Y==1&&t(E,{onClick:c,cursor:"pointer",fontSize:R,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(u,{w:"full",color:V?"unset":"gray.500",children:V?le(V).format("YYYY-MM-DD (00:00)"):a("userDialog.startDate")}),e(sr,{as:Mn,boxSize:"18px"}),e(u,{w:"full",color:I?"unset":"gray.500",children:I?le(I).format("YYYY-MM-DD (23:59)"):a("userDialog.endDate")}),e(sr,{as:Br,boxSize:"18px"})]}),e(te,{ref:z,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:S?"unset":"none",children:t(Oi,{onChange:B=>W(B),children:[t(Fi,{children:[e(Hr,{fontSize:R,children:a("userDialog.relative")}),e(Hr,{fontSize:R,children:a("userDialog.absolute")})]}),t(Wi,{children:[e(jr,{children:g.map(B=>e(te,{alignItems:"start",pl:2,pr:2,children:t(E,{justifyItems:"flex-start",mb:4,children:[e(u,{fontSize:R,minW:"60px",children:a("userDialog."+B.title)}),B.options.map(L=>e(tn,{border:!0,...C({value:L}),children:L},L+".custom"))]})},B.title))}),e(jr,{className:"datepicker-panel",children:e(te,{children:e(Pn,{locale:o.language.toLocaleLowerCase(),selected:V,onChange:fe,startDate:V,endDate:I,selectsRange:!0,maxDate:new Date,monthsShown:_,peekNextMonth:!1,inline:!0})})})]})]})})]})};function er(r,i,n=[],a=[]){const o=Ae(n.reduce((s,l)=>s+=l,0));return{series:n,options:{labels:a,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${i}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:r==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:r==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(s,{seriesIndex:l,w:g})=>Ae(g.config.series[l],1)},tooltip:{custom:({series:s,seriesIndex:l,dataPointIndex:g,w:b})=>{const C=Ae(s[l],1),y=Math.max(s.reduce((c,m)=>c+=m),1),S=Math.round(s[l]/y*1e3)/10+"%";return`
            <div style="
                    background-color: ${b.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${b.config.labels[l]}: <b>${S}, ${C}</b>
            </div>
          `}},colors:Ws(n.length)}}}const Bs=T(rr,{baseStyle:{w:5,h:5}}),Hs=()=>{const{isShowingNodesUsage:r,onShowingNodesUsage:i}=X(),{fetchNodesUsage:n}=Vt(),{t:a}=ie(),[o,s]=h.exports.useState(!1),{colorMode:l}=Lt(),g=a("userDialog.total"),[b,C]=h.exports.useState(er(l,g)),[y,S]=h.exports.useState("1m"),c=w=>{n(w).then(U=>{const p=[],d=[];for(const Y in U.usages){const W=U.usages[Y];d.push(W.uplink+W.downlink),p.push(W.node_name)}C(er(l,g,d,p))})};h.exports.useEffect(()=>{r&&c({start:le().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[r]);const m=()=>{i(!1),S("1m")},z=o;return t(de,{isOpen:r,onClose:m,size:"2xl",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",w:"full",children:[e(pe,{pt:6,children:t(E,{gap:2,children:[e(Re,{color:"primary",children:e(Bs,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:a("header.nodesUsage")})]})}),e(me,{mt:3,disabled:z}),e(ge,{children:t(te,{gap:4,children:[e(Xn,{defaultValue:y,onChange:(w,U)=>{S(w),c(U)}}),e(F,{justifySelf:"center",w:"full",maxW:"300px",mt:"4",children:e(h.exports.Suspense,{fallback:e(Cn,{isIndeterminate:!0}),children:e(Nn,{options:b.options,series:b.series,type:"donut",height:"500px"})})})]})}),e(xe,{mt:"3"})]})]})},rn=T(Bi),js=T(Mn,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Vs=T(Hi,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Gs=T(On,{baseStyle:{w:5,h:5}}),qs=()=>{const{QRcodeLinks:r,setQRCode:i,setSubLink:n,subscribeUrl:a}=X(),o=r!==null,[s,l]=h.exports.useState(0),{t:g}=ie(),b=()=>{i(null),n(null)},C=String(a).startsWith("/")?window.location.origin+a:String(a);return t(de,{isOpen:o,onClose:b,children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(pe,{pt:6,children:e(Re,{color:"primary",children:e(Gs,{color:"white"})})}),e(me,{mt:3}),r&&t(ge,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[a&&t(te,{children:[e(rn,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:C,bg:"white"}),e(u,{display:"block",textAlign:"center",pb:3,mt:1,children:g("qrcodeDialog.sublink")})]}),t(F,{w:"300px",children:[e(ji,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:l,onInit:()=>l(0),nextArrow:e(re,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(js,{})}),prevArrow:e(re,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Vs,{})}),children:r.map((y,S)=>e(E,{children:e(rn,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:y,bg:"white"})},S))}),t(u,{display:"block",textAlign:"center",pb:3,mt:1,children:[s+1," / ",r.length]})]})]})]})]})},Zs=T(In,{baseStyle:{w:5,h:5}}),Ys=()=>{const[r,i]=h.exports.useState(!1),{isResetingAllUsage:n,onResetAllUsage:a,resetAllUsage:o}=X(),{t:s}=ie(),l=Ce(),g=()=>{a(!1)},b=()=>{i(!0),o().then(()=>{l({title:s("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:s("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{i(!1)})};return t(de,{isCentered:!0,isOpen:n,onClose:g,size:"sm",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"red",children:e(Zs,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:s("resetAllUsage.title")}),n&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:s("resetAllUsage.prompt")})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:s("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"red",onClick:b,leftIcon:r?e(Fe,{size:"xs"}):void 0,children:s("reset")})]})]})]})},Qs=T(_t,{baseStyle:{w:5,h:5}}),Js=()=>{const[r,i]=h.exports.useState(!1),{resetUsageUser:n,resetDataUsage:a}=X(),{t:o}=ie(),s=Ce(),l=()=>{X.setState({resetUsageUser:null})},g=()=>{n&&(i(!0),a(n).then(()=>{s({title:o("resetUserUsage.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{s({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{i(!1)}))};return t(de,{isCentered:!0,isOpen:!!n,onClose:l,size:"sm",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"blue",children:e(Qs,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),n&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(lt,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:n.username})})})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"blue",onClick:g,leftIcon:r?e(Fe,{size:"xs"}):void 0,children:o("reset")})]})]})]})},Xs=T(_t,{baseStyle:{w:5,h:5}}),Ks=()=>{const[r,i]=h.exports.useState(!1),{revokeSubscriptionUser:n,revokeSubscription:a}=X(),{t:o}=ie(),s=Ce(),l=()=>{X.setState({revokeSubscriptionUser:null})},g=()=>{n&&(i(!0),a(n).then(()=>{s({title:o("revokeUserSub.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{s({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{i(!1)}))};return t(de,{isCentered:!0,isOpen:!!n,onClose:l,size:"sm",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(ue,{mx:"3",children:[e(pe,{pt:6,children:e(Re,{color:"blue",children:e(Xs,{})})}),e(me,{mt:3}),t(ge,{children:[e(u,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),n&&e(u,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(lt,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:n.username})})})]}),t(xe,{display:"flex",children:[e(D,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(D,{size:"sm",w:"full",colorScheme:"blue",onClick:g,leftIcon:r?e(Fe,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},ea=T(Vi,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),ta=({inbound:r,...i})=>{const{getCheckboxProps:n,getInputProps:a,getLabelProps:o,htmlProps:s}=Wn(i),l=a();return t(F,{as:"label",children:[e("input",{...l}),t(F,{w:"fll",position:"relative",...s,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...n(),children:[e(ct,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:l.checked,pointerEvents:"none",flexGrow:1,children:e(E,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:t(u,{isTruncated:!0,...o(),fontSize:"xs",children:[r.tag," ",t(u,{as:"span",children:["(",r.network,")"]})]})})}),r.tls&&r.tls!="none"&&e(Q,{fontSize:"xs",opacity:".8",size:"xs",children:r.tls})]})]})},ra=({disabled:r,title:i,description:n,toggleAccordion:a,isSelected:o,...s})=>{const l=Ir(),{inbounds:g}=X(),{getCheckboxProps:b,getInputProps:C,getLabelProps:y,htmlProps:S}=Wn(s),c=C(),[m]=$n({name:[`inbounds.${i}`],control:l.control}),{getCheckboxProps:z}=Fn({value:m,onChange:d=>{if(l.setValue(`inbounds.${i}`,d),d.length===0){const Y=l.getValues("selected_proxies");l.setValue("selected_proxies",Y.filter(W=>W!==i)),a()}}}),w=m&&o&&(X.getState().inbounds.get(i)||[]).length!==m.length,U=(X.getState().inbounds.get(i)||[]).length>0,p=!o&&!U;return t(Dt,{isDisabled:!U,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:p?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:p?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...b(),children:[t(F,{as:p?"span":"label",position:"relative",children:[w&&e(F,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{...c}),t(F,{w:"fll",position:"relative",...S,borderRadius:"md",cursor:p?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...b(),children:[e(Et,{display:c.checked&&U?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:a,children:e(re,{size:"sm","aria-label":"inbound settings",children:e(ea,{})})}),e(u,{fontSize:"sm",color:p?"gray.400":"gray.700",_dark:{color:p?"gray.500":"gray.300"},...y(),children:i}),e(u,{fontWeight:"medium",color:p?"gray.400":"gray.600",_dark:{color:p?"gray.500":"gray.400"},fontSize:"xs",children:n})]})]}),e(Tt,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:c.checked&&"gray.750"},children:t(te,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[t(te,{alignItems:"flex-start",w:"full",children:[e(u,{fontSize:"sm",children:Se("inbound")}),e(Tr,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(g.get(i)||[]).map(d=>e(ta,{...z({value:d.tag}),inbound:d},d.tag))})]}),i==="vmess"&&o&&e(te,{alignItems:"flex-start",w:"full",children:t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"ID"}),e(ce,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Se("userDialog.generatedByDefault"),...l.register("proxies.vmess.id")})]})}),i==="vless"&&o&&t(te,{alignItems:"flex-start",w:"full",children:[t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"ID"}),e(ce,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Se("userDialog.generatedByDefault"),...l.register("proxies.vless.id")})]}),t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:"Flow"}),e(Ue,{fontSize:"xs",size:"sm",borderRadius:"6px",...l.register("proxies.vless.flow"),children:Ss.map(d=>e("option",{value:d.value,children:d.title},d.title))})]})]}),i==="trojan"&&o&&e(te,{alignItems:"flex-start",w:"full",children:t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Se("password")}),e(ce,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Se("userDialog.generatedByDefault"),...l.register("proxies.trojan.password")})]})}),i==="shadowsocks"&&o&&t(te,{alignItems:"flex-start",w:"full",children:[t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Se("password")}),e(ce,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Se("userDialog.generatedByDefault"),...l.register("proxies.shadowsocks.password")})]}),t(M,{height:"66px",children:[e(u,{fontSize:"sm",pb:1,children:Se("userDialog.method")}),e(Ue,{fontSize:"xs",size:"sm",borderRadius:"6px",...l.register("proxies.shadowsocks.method"),children:Cs.map(d=>e("option",{value:d,children:d},d))})]})]})]})})]})},na=h.exports.forwardRef(({name:r,list:i,onChange:n,disabled:a,...o},s)=>{const l=Ir(),[g,b]=h.exports.useState([]),C=S=>{g.includes(S)?g.splice(g.indexOf(S),1):g.push(S),b([...g])},{getCheckboxProps:y}=Fn({value:o.value,onChange:S=>{var m;const c=S.filter(z=>!o.value.includes(z));c[0]&&l.setValue(`inbounds.${c[0]}`,(m=X.getState().inbounds.get(c[0]))==null?void 0:m.map(z=>z.tag)),b(g.filter(z=>S.find(w=>w===i[z].title))),n({target:{value:S,name:r}})}});return e(jt,{allowToggle:!0,index:g,children:e(Tr,{ref:s,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:i.map((S,c)=>e(ra,{toggleAccordion:C.bind(null,c),disabled:a,title:S.title,description:S.description,isSelected:!!o.value.find(m=>m===S.title),...y({value:S.title})},S.title))})})}),ia=T(Gi,{baseStyle:{w:5,h:5}}),oa=T(Bn,{baseStyle:{w:5,h:5}}),sa=T(rr,{baseStyle:{w:5,h:5}}),aa=r=>({...r,data_limit:r.data_limit?Number((r.data_limit/1073741824).toFixed(5)):r.data_limit,on_hold_expire_duration:r.on_hold_expire_duration?Number(r.on_hold_expire_duration/(24*60*60)):r.on_hold_expire_duration,selected_proxies:Object.keys(r.proxies),unique_ip_limit:"3"}),cr=()=>{const r=Object.fromEntries(X.getState().inbounds),i={};for(const n in r)i[n]=r[n].map(a=>a.tag);return{selected_proxies:Object.keys(r),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",unique_ip_limit:"3",inbounds:i,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}}}},la=(r,i)=>{const n=r.reduce((a,o)=>({...a,[o]:{}}),{});return i&&r.forEach(a=>{i[a]&&(n[a]=i[a])}),n},Nt={username:A.string().min(1,{message:"Required"}),selected_proxies:A.array(A.string()).refine(r=>r.length>0,{message:"userDialog.selectOneProtocol"}),note:A.string().nullable(),unique_ip_limit:A.string().default("3"),proxies:A.record(A.string(),A.record(A.string(),A.any())).transform(r=>{const i=(n,a)=>{n&&n[a]===""&&delete n[a]};return i(r.vmess,"id"),i(r.vless,"id"),i(r.trojan,"password"),i(r.shadowsocks,"password"),i(r.shadowsocks,"method"),r}),data_limit:A.string().min(0).or(A.number()).nullable().transform(r=>r?Number((parseFloat(String(r))*1073741824).toFixed(5)):0),expire:A.number().nullable(),data_limit_reset_strategy:A.string(),inbounds:A.record(A.string(),A.array(A.string())).transform(r=>(Object.keys(r).forEach(i=>{var n;Array.isArray(r[i])&&!((n=r[i])!=null&&n.length)&&delete r[i]}),r))},ca=A.discriminatedUnion("status",[A.object({status:A.literal("active"),...Nt}),A.object({status:A.literal("disabled"),...Nt}),A.object({status:A.literal("limited"),...Nt}),A.object({status:A.literal("expired"),...Nt}),A.object({status:A.literal("on_hold"),on_hold_expire_duration:A.coerce.number().min(.1,"Required").transform(r=>r*(24*60*60)),...Nt})]),da=()=>{var mt,gt,ft,bt,yt;const{editingUser:r,isCreatingNewUser:i,onCreateUser:n,editUser:a,fetchUserUsage:o,onEditingUser:s,createUser:l,onDeletingUser:g}=X(),b=!!r,C=i||b,[y,S]=h.exports.useState(!1),[c,m]=h.exports.useState(""),z=Ce(),{t:w,i18n:U}=ie(),{colorMode:p}=Lt(),[d,Y]=h.exports.useState(!1),W=()=>{Y(N=>!N)},_=At({defaultValues:cr(),resolver:Ht(ca)});h.exports.useEffect(()=>X.subscribe(N=>N.inbounds,()=>{_.reset(cr())}),[]);const[R,V]=$n({control:_.control,name:["data_limit","status"]}),J=w("userDialog.total"),[I,oe]=h.exports.useState(er(p,J)),[fe,B]=h.exports.useState("1m"),L=N=>{o(r,N).then(ee=>{const be=[],we=[];for(const ke in ee.usages)we.push(ee.usages[ke].used_traffic),be.push(ee.usages[ke].node_name);oe(er(p,J,we,be))})};h.exports.useEffect(()=>{r&&(_.reset(aa(r)),P(`/xpert/ip-limit/${encodeURIComponent(r.username)}`).then(N=>{var be;const ee=(be=N==null?void 0:N.limit)!=null?be:3;_.setValue("unique_ip_limit",String(ee))}).catch(()=>{_.setValue("unique_ip_limit","3")}),L({start:le().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[r]);const x=N=>{S(!0);const ee={edited:a,created:l},be=b?"edited":"created";m(null);const{selected_proxies:we,unique_ip_limit:ke,...Pe}=N;let zt={...Pe,data_limit:N.data_limit,proxies:la(we,N.proxies),data_limit_reset_strategy:N.data_limit&&N.data_limit>0?N.data_limit_reset_strategy:"no_reset",status:N.status==="active"||N.status==="disabled"||N.status==="on_hold"?N.status:"active"};ee[be](zt).then(async()=>{const ne=Number(ke||"3");try{await P("/xpert/ip-limit",{method:"POST",body:{username:N.username,limit:ne}})}catch{z({title:w("userDialog.uniqueIpLimitFailed"),status:"warning",isClosable:!0,position:"top",duration:3e3})}z({title:w(b?"userDialog.userEdited":"userDialog.userCreated",{username:N.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),$()}).catch(ne=>{var ot,st,f,k,O,Z,$e;(((ot=ne==null?void 0:ne.response)==null?void 0:ot.status)===409||((st=ne==null?void 0:ne.response)==null?void 0:st.status)===400)&&m((k=(f=ne==null?void 0:ne.response)==null?void 0:f._data)==null?void 0:k.detail),((O=ne==null?void 0:ne.response)==null?void 0:O.status)===422?Object.keys(ne.response._data.detail).forEach(It=>{m(ne==null?void 0:ne.response._data.detail[It]),_.setError(It,{type:"custom",message:ne==null?void 0:ne.response._data.detail[It]})}):m((($e=(Z=ne==null?void 0:ne.response)==null?void 0:Z._data)==null?void 0:$e.detail)||"Unknown error occurred")}).finally(()=>{S(!1)})},$=()=>{_.reset(cr()),n(!1),s(null),m(null),Y(!1),B("1m")},ae=()=>{X.setState({resetUsageUser:r})},v=()=>{X.setState({revokeSubscriptionUser:r})},q=y,se=V==="on_hold",[Me,We]=h.exports.useState(!1),kt=()=>{We(!0);let N="";const ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",be=ee.length;let we=0;for(;we<6;)N+=ee.charAt(Math.floor(Math.random()*be)),we+=1;return N};return t(de,{isOpen:C,onClose:$,size:"2xl",children:[e(he,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Tn,{..._,children:e(ue,{mx:"3",children:t("form",{onSubmit:_.handleSubmit(x),children:[e(pe,{pt:6,children:t(E,{gap:2,children:[e(Re,{color:"primary",children:b?e(oa,{color:"white"}):e(ia,{color:"white"})}),e(u,{fontWeight:"semibold",fontSize:"lg",children:w(b?"userDialog.editUserTitle":"createNewUser")})]})}),e(me,{mt:3,disabled:q}),t(ge,{children:[t(Yt,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(Ft,{children:t(te,{justifyContent:"space-between",children:[t(ut,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[t(ut,{flexDirection:"row",w:"full",gap:2,children:[t(M,{mb:"10px",children:[e(j,{children:t(ut,{gap:2,alignItems:"center",children:[w("username"),!b&&e(Ar,{cursor:"pointer",className:Bt({"animate-spin":Me}),onClick:()=>{const N=kt();_.setValue("username",N),setTimeout(()=>{We(!1)},350)}})]})}),t(E,{children:[e(dt,{size:"sm",type:"text",borderRadius:"6px",error:(mt=_.formState.errors.username)==null?void 0:mt.message,disabled:q||b,..._.register("username")}),b&&e(E,{px:1,children:e(Be,{name:"status",control:_.control,render:({field:N})=>e(_e,{placement:"top",label:"status: "+w(`status.${N.value}`),textTransform:"capitalize",children:e(F,{children:e(vt,{colorScheme:"primary",isChecked:N.value==="active",onChange:ee=>{ee.target.checked?N.onChange("active"):N.onChange("disabled")}})})})})})]})]}),!b&&t(M,{flex:"1",children:[e(j,{whiteSpace:"nowrap",children:w("userDialog.onHold")}),e(Be,{name:"status",control:_.control,render:({field:N})=>{const ee=N.value;return e(ze,{children:ee?e(vt,{colorScheme:"primary",isChecked:ee==="on_hold",onChange:be=>{be.target.checked?N.onChange("on_hold"):N.onChange("active")}}):""})}})]})]}),t(M,{mb:"10px",children:[e(j,{children:w("userDialog.dataLimit")}),e(Be,{control:_.control,name:"data_limit",render:({field:N})=>{var ee;return e(dt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:N.onChange,disabled:q,error:(ee=_.formState.errors.data_limit)==null?void 0:ee.message,value:N.value?String(N.value):""})}})]}),e(Rn,{in:!!(R&&R>0),animateOpacity:!0,style:{width:"100%"},children:t(M,{height:"66px",children:[e(j,{children:w("userDialog.periodicUsageReset")}),e(Be,{control:_.control,name:"data_limit_reset_strategy",render:({field:N})=>e(Ue,{size:"sm",...N,disabled:q,bg:q?"gray.100":"transparent",_dark:{bg:q?"gray.600":"transparent"},sx:{option:{backgroundColor:p==="dark"?"#222C3B":"white"}},children:wr.map(ee=>e("option",{value:ee.value,children:w("userDialog.resetStrategy"+ee.title)},ee.value))})})]})}),t(M,{mb:"10px",children:[e(j,{children:w(se?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),se&&e(Be,{control:_.control,name:"on_hold_expire_duration",render:({field:N})=>{var ee;return e(dt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:be=>{_.setValue("expire",null),N.onChange({target:{value:be}})},disabled:q,error:(ee=_.formState.errors.on_hold_expire_duration)==null?void 0:ee.message,value:N.value?String(N.value):""})}}),!se&&e(Be,{name:"expire",control:_.control,render:({field:N})=>{var ke;function ee(Pe){return le(le(Pe*1e3).utc()).toDate()}const{status:be,time:we}=or(N.value);return t(ze,{children:[e(Pn,{locale:U.language.toLocaleLowerCase(),dateFormat:w("dateFormat"),minDate:new Date,selected:N.value?ee(N.value):void 0,onChange:Pe=>{_.setValue("on_hold_expire_duration",null),N.onChange({target:{value:Pe?le(le(Pe).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(dt,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:q,error:(ke=_.formState.errors.expire)==null?void 0:ke.message})}),N.value?e(Vr,{children:w(be,{time:we})}):""]})}})]}),t(M,{mb:"10px",isInvalid:!!_.formState.errors.note,children:[e(j,{children:w("userDialog.note")}),e(ht,{..._.register("note"),minH:"70px"}),e(Xt,{children:(ft=(gt=_.formState.errors)==null?void 0:gt.note)==null?void 0:ft.message})]}),t(M,{mb:"10px",children:[e(j,{children:w("userDialog.uniqueIpLimit")}),t(Ue,{size:"sm",..._.register("unique_ip_limit"),children:[e("option",{value:"1",children:"1"}),e("option",{value:"2",children:"2"}),e("option",{value:"3",children:"3"}),e("option",{value:"4",children:"4"}),e("option",{value:"5",children:"5"})]}),e(Vr,{children:w("userDialog.uniqueIpLimitHelp")})]})]}),c&&t(it,{status:"error",display:{base:"none",md:"flex"},children:[e(pt,{}),c]})]})}),e(Ft,{children:t(M,{isInvalid:!!((bt=_.formState.errors.selected_proxies)!=null&&bt.message),children:[e(j,{children:w("userDialog.protocols")}),e(Be,{control:_.control,name:"selected_proxies",render:({field:N})=>e(na,{list:[{title:"vmess",description:w("userDialog.vmessDesc")},{title:"vless",description:w("userDialog.vlessDesc")},{title:"trojan",description:w("userDialog.trojanDesc")},{title:"shadowsocks",description:w("userDialog.shadowsocksDesc")}],disabled:q,...N})}),e(Xt,{children:w((yt=_.formState.errors.selected_proxies)==null?void 0:yt.message)})]})}),b&&d&&e(Ft,{pt:6,colSpan:{base:1,md:2},children:t(te,{gap:4,children:[e(Xn,{defaultValue:fe,onChange:(N,ee)=>{B(N),L(ee)}}),e(F,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Nn,{options:I.options,series:I.series,type:"donut"})})]})})]}),c&&t(it,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(pt,{}),c]})]}),e(xe,{mt:"3",children:t(E,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(E,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:b&&t(ze,{children:[e(_e,{label:w("delete"),placement:"top",children:e(re,{"aria-label":"Delete",size:"sm",onClick:()=>{g(r),$()},children:e(Gt,{})})}),e(_e,{label:w("userDialog.usage"),placement:"top",children:e(re,{"aria-label":"usage",size:"sm",onClick:W,children:e(sa,{})})}),e(D,{onClick:ae,size:"sm",children:w("userDialog.resetUsage")}),e(D,{onClick:v,size:"sm",children:w("userDialog.revokeSubscription")})]})}),e(E,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(D,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:y?e(Fe,{size:"xs"}):void 0,disabled:q,children:w(b?"userDialog.editUser":"createUser")})})]})})]})})})]})},ha=r=>h.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...r},h.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),h.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),h.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),h.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),h.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),h.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),h.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),h.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),h.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),dr=r=>{if(!r)return null;const i=new Date(`${r}Z`);return Math.floor(i.getTime()/1e3)},nn=({lastOnline:r,lastFetch:i,firstFetch:n})=>{const a=Math.floor(Date.now()/1e3),o=dr(r),s=dr(i),l=dr(n);return!r&&!i&&!n?e(F,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):o!==null&&a-o<=60?e(F,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):l!==null&&s!==null&&l===s?e(F,{bg:"blue.400",_dark:{bg:"blue.500"},className:"circle"}):s!==null?e(F,{bg:"cyan.300",_dark:{bg:"cyan.500"},className:"circle"}):e(F,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},ua=r=>{if(!r)return null;const i=new Date(r+"Z");return Math.floor(i.getTime()/1e3)},on=({lastOnline:r})=>{const i=Math.floor(Date.now()/1e3),n=ua(r),a=n?i-n:null,o=n?or(n):{status:"",time:"Not Connected Yet"};return e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a&&a<=60?"Online":a?`${o.time} ago`:o.time})},pa=r=>{if(!r)return null;const i=new Date(r+"Z");return Math.floor(i.getTime()/1e3)},ma=(r,i)=>{const n=Math.max(0,r),a=Math.floor(n/86400),o=Math.floor(n%86400/3600),s=Math.floor(n%3600/60),l=i.startsWith("ru"),g=i.startsWith("fa"),b=i.startsWith("zh"),C=l?{d:"\u0434",h:"\u0447",m:"\u043C"}:g?{d:"\u0631\u0648\u0632",h:"\u0633",m:"\u062F"}:b?{d:"\u5929",h:"\u65F6",m:"\u5206"}:{d:"d",h:"h",m:"m"};return a>0?`${a}${C.d} ${o}${C.h}`:o>0?`${o}${C.h} ${s}${C.m}`:`${Math.max(1,s)}${C.m}`},sn=({lastFetch:r})=>{const{t:i,i18n:n}=ie(),a=n.language||"en",o="usersTable.lastSubscriptionFetch",s="usersTable.never",l=a.startsWith("ru")?"\u0417\u0430\u043F\u0440\u043E\u0441 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0438":a.startsWith("fa")?"\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0634\u062A\u0631\u0627\u06A9":a.startsWith("zh")?"\u8BA2\u9605\u83B7\u53D6":"Sub fetch",g=a.startsWith("ru")?"\u041D\u0435\u0442":a.startsWith("fa")?"\u0647\u06CC\u0686\u200C\u0648\u0642\u062A":a.startsWith("zh")?"\u4ECE\u672A":"Never",b=i(o)===o?l:i(o),C=i(s)===s?g:i(s),y=pa(r),S=Math.floor(Date.now()/1e3),c=y?S-y:null,m=c===null?C:ma(c,a);return t(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:[b,": ",m]})},ga=T(qi,{baseStyle:{w:4,h:4}}),fa=T(Zi,{baseStyle:{w:4,h:4}}),an=5;function ba(r,i,n){if(n<an)throw new Error(`Must allow at least ${an} page items`);if(n%2===0)throw new Error("Must allow odd number of page items");if(r<n)return[...new Array(r).keys()];const a=Math.max(0,Math.min(r-n,i-Math.floor(n/2))),o=new Array(n);for(let s=0;s<n;s+=1)o[s]=s+a;return o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<r-1&&(o[o.length-1]=r-1,o[o.length-2]="next-more"),o}const ya=()=>{const{filters:r,onFilterChange:i,users:{total:n}}=X(),{limit:a,offset:o}=r,s=(o||0)/(a||1),l=Math.ceil(n/(a||1)),g=ba(l,s,7),b=S=>{i({...r,offset:S*a})},C=S=>{i({...r,limit:parseInt(S.target.value)}),Uo(S.target.value)},{t:y}=ie();return t(E,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(F,{order:{base:2,md:1},children:t(E,{children:[t(Ue,{minW:"60px",value:a,onChange:C,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(u,{whiteSpace:"nowrap",fontSize:"sm",children:y("itemsPerPage")})]})}),t(Yi,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(D,{leftIcon:e(ga,{}),onClick:b.bind(null,s-1),isDisabled:s===0||l===0,children:y("previous")}),g.map(S=>typeof S=="string"?e(D,{children:"..."},S):e(D,{variant:S===s?"solid":"outline",onClick:b.bind(null,S),children:S+1},S)),e(D,{rightIcon:e(fa,{}),onClick:b.bind(null,s+1),isDisabled:s+1===l||l===0,children:y("next")})]})]})},hr=({expiryDate:r,status:i,compact:n=!1,showDetail:a=!0,extraText:o})=>{const{t:s}=ie(),l=or(r),g=Ct[i].icon;return t(ze,{children:[t(Q,{colorScheme:Ct[i].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(g,{w:n?3:4}),a&&t(u,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[i&&s(`status.${i}`),o&&`: ${o}`]})]}),a&&r&&e(u,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:s(l.status,{time:l.time})})]})},xa=T(ha),Ut={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Sa=T(Qi,Ut),Ca=T(Hn,Ut),ln=T(Ji,Ut),wa=T(zr,Ut),va=T(On,Ut),_a=T(Bn,Ut),ka=T(Hn,{baseStyle:{width:"15px",height:"15px"}}),za=r=>{for(var i=0;i<wr.length;i++){const n=wr[i];if(n.value==r)return n.title}return"No"},Ia=r=>{const{used:i,total:n,dataLimitResetStrategy:a,totalUsedTraffic:o}=r,s=n===0||n===null;return e(E,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t(u,{children:[Ae(i)," /"," ",s?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ae(n)]})})},cn=r=>{const{used:i,total:n,dataLimitResetStrategy:a,totalUsedTraffic:o,...s}=r,l=n===0||n===null,g=!l&&i/n*100>=100;return t(ze,{children:[e(Xi,{orientation:"horizontal",value:l?100:Math.min(i/n*100,100),colorScheme:g?"red":"primary",...s,children:e(Ki,{h:"6px",borderRadius:"full",children:e(eo,{borderRadius:"full"})})}),t(E,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[t(u,{children:[Ae(i)," /"," ",l?e(u,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Ae(n)+(a&&a!=="no_reset"?" "+Se("userDialog.resetStrategy"+za(a)):"")]}),t(u,{children:[Se("usersTable.total"),": ",Ae(o)]})]})]})},Ot=({sort:r,column:i})=>r.includes(i)?e(ka,{transform:r.startsWith("-")?void 0:"rotate(180deg)"}):null,Da=r=>{const{filters:i,users:{users:n,total:a},onEditingUser:o,onFilterChange:s}=X(),{t:l}=ie(),[g,b]=h.exports.useState(void 0),C=St({base:120,lg:72})||72,[y,S]=h.exports.useState(`${C}px`),c=St({base:!1,md:!0});h.exports.useEffect(()=>{const p=()=>{const d=document.querySelector("#filters");!d||S(`${d.offsetHeight}px`)};return p(),window.addEventListener("scroll",p),()=>window.removeEventListener("scroll",p)},[]);const m=(n==null?void 0:n.length)!==a,z=p=>{let d=i.sort;d.includes(p)?d.startsWith("-")?d="-created_at":d="-"+p:d=p,s({sort:d})},w=p=>{s({status:p.target.value.length>0?p.target.value:void 0})},U=p=>{b(p===g?void 0:p)};return t(F,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(jt,{allowMultiple:!0,display:{base:"block",md:"none"},index:g,children:t(tt,{orientation:"vertical",zIndex:"docked",...r,children:[e(rt,{zIndex:"docked",position:"relative",children:t(ye,{children:[e(G,{position:"sticky",top:y,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:z.bind(null,"username"),children:t(E,{children:[e("span",{children:l("users")}),e(Ot,{sort:i.sort,column:"username"})]})}),e(G,{position:"sticky",top:y,minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:t(E,{spacing:0,position:"relative",children:[t(u,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[l("usersTable.status"),i.status?": "+i.status:""]}),t(Ue,{value:i.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(ze,{}),_focusVisible:{border:"0 !important"},onChange:w,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(G,{position:"sticky",top:y,minW:"100px",cursor:"pointer",pr:0,onClick:z.bind(null,"used_traffic"),children:t(E,{children:[e("span",{children:l("usersTable.dataUsage")}),e(Ot,{sort:i.sort,column:"used_traffic"})]})}),e(G,{position:"sticky",top:y,minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(nt,{children:!c&&(n==null?void 0:n.map((p,d)=>t(h.exports.Fragment,{children:[t(ye,{onClick:U.bind(null,d),cursor:"pointer",children:[e(H,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:t("div",{className:"flex-status",children:[e(nn,{lastOnline:p.online_at,lastFetch:p.sub_updated_at,firstFetch:p.first_sub_fetch_at}),e(u,{isTruncated:!0,children:p.username})]})}),e(H,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(hr,{compact:!0,showDetail:!1,expiryDate:p.expire,status:p.status})}),e(H,{borderBottom:0,minW:"100px",pr:0,children:e(Ia,{totalUsedTraffic:p.lifetime_used_traffic,dataLimitResetStrategy:p.data_limit_reset_strategy,used:p.used_traffic,total:p.data_limit,colorScheme:Ct[p.status].bandWidthColor})}),e(H,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Ca,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:g===d?"rotate(180deg)":"0deg"})})]}),e(ye,{className:"collapsible",onClick:U.bind(null,d),children:e(H,{p:0,colSpan:4,children:t(Dt,{border:0,children:[e(Et,{display:"none"}),e(Tt,{border:0,cursor:"pointer",px:6,py:3,children:t(te,{justifyContent:"space-between",spacing:"4",children:[t(te,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(u,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:l("usersTable.dataUsage")}),e(F,{width:"full",minW:"230px",children:e(cn,{totalUsedTraffic:p.lifetime_used_traffic,dataLimitResetStrategy:p.data_limit_reset_strategy,used:p.used_traffic,total:p.data_limit,colorScheme:Ct[p.status].bandWidthColor})})]}),t(E,{w:"full",justifyContent:"space-between",children:[t(F,{width:"full",children:[e(hr,{compact:!0,expiryDate:p.expire,status:p.status}),e(on,{lastOnline:p.online_at}),e(sn,{lastFetch:p.sub_updated_at})]}),t(E,{children:[e(dn,{user:p}),e(_e,{label:l("userDialog.editUser"),placement:"top",children:e(re,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:Y=>{Y.stopPropagation(),o(p)},children:e(_a,{})})})]})]})]})})]})})})]},p.username)))})]})}),t(tt,{orientation:"vertical",display:{base:"none",md:"table"},...r,children:[e(rt,{zIndex:"docked",position:"relative",children:t(ye,{children:[e(G,{position:"sticky",top:{base:"unset",md:y},minW:"140px",cursor:"pointer",onClick:z.bind(null,"username"),children:t(E,{children:[e("span",{children:l("username")}),e(Ot,{sort:i.sort,column:"username"})]})}),e(G,{position:"sticky",top:{base:"unset",md:y},width:"400px",minW:"150px",cursor:"pointer",children:t(E,{position:"relative",gap:"5px",children:[t(u,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[l("usersTable.status"),i.status?": "+i.status:""]}),e(u,{children:"/"}),e(Ot,{sort:i.sort,column:"expire"}),e(E,{onClick:z.bind(null,"expire"),children:e(u,{children:"Sort by expire"})}),t(Ue,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(ze,{}),_focusVisible:{border:"0 !important"},value:i.sort,onChange:w,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(G,{position:"sticky",top:{base:"unset",md:y},width:"350px",minW:"230px",cursor:"pointer",onClick:z.bind(null,"used_traffic"),children:t(E,{children:[e("span",{children:l("usersTable.dataUsage")}),e(Ot,{sort:i.sort,column:"used_traffic"})]})}),e(G,{position:"sticky",top:{base:"unset",md:y},width:"200px",minW:"180px"})]})}),t(nt,{children:[c&&(n==null?void 0:n.map((p,d)=>t(ye,{className:Bt("interactive",{"last-row":d===((n==null?void 0:n.length)||0)-1}),onClick:()=>o(p),children:[e(H,{minW:"140px",children:t("div",{className:"flex-status",children:[e(nn,{lastOnline:p.online_at,lastFetch:p.sub_updated_at,firstFetch:p.first_sub_fetch_at}),p.username,e(on,{lastOnline:p.online_at}),e(sn,{lastFetch:p.sub_updated_at})]})}),e(H,{width:"400px",minW:"150px",children:e(hr,{expiryDate:p.expire,status:p.status})}),e(H,{width:"350px",minW:"230px",children:e(cn,{totalUsedTraffic:p.lifetime_used_traffic,dataLimitResetStrategy:p.data_limit_reset_strategy,used:p.used_traffic,total:p.data_limit,colorScheme:Ct[p.status].bandWidthColor})}),e(H,{width:"200px",minW:"180px",children:e(dn,{user:p})})]},p.username))),((n==null?void 0:n.length)||0)==0&&e(ye,{children:e(H,{colSpan:4,children:e(Ea,{isFiltered:m})})})]})]}),e(ya,{})]})},dn=({user:r})=>{const{setQRCode:i,setSubLink:n}=X(),a=r.links.join(`\r
`),[o,s]=h.exports.useState([-1,!1]);return h.exports.useEffect(()=>{o[1]&&setTimeout(()=>{s([-1,!1])},1e3)},[o]),t(E,{justifyContent:"flex-end",onClick:l=>{l.preventDefault(),l.stopPropagation()},children:[e(Gr,{text:r.subscription_url.startsWith("/")?window.location.origin+r.subscription_url:r.subscription_url,onCopy:()=>{s([0,!0])},children:e("div",{children:e(_e,{label:o[0]==0&&o[1]?Se("usersTable.copied"):Se("usersTable.copyLink"),placement:"top",children:e(re,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(ln,{}):e(wa,{})})})})}),e(Gr,{text:a,onCopy:()=>{s([1,!0])},children:e("div",{children:e(_e,{label:o[0]==1&&o[1]?Se("usersTable.copied"):Se("usersTable.copyConfigs"),placement:"top",children:e(re,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(ln,{}):e(Sa,{})})})})}),e(_e,{label:"QR Code",placement:"top",children:e(re,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{i(r.links),n(r.subscription_url)},children:e(va,{})})})]})},Ea=({isFiltered:r})=>{const{onCreateUser:i}=X();return t(F,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(xa,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(u,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:r?Se("usersTable.noUserMatched"):Se("usersTable.noUser")}),!r&&e(D,{size:"sm",colorScheme:"primary",onClick:()=>i(!0),children:Se("createUser")})]})},Ta=()=>(h.exports.useEffect(()=>{const r=setTimeout(()=>{try{console.log("Dashboard: Starting initialization..."),X.getState().refetchUsers(),Mo()}catch(i){console.error("Dashboard initialization failed:",i)}},200);return()=>clearTimeout(r)},[]),t(te,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[t(F,{w:"full",children:[e(Ur,{}),e(Lo,{mt:"4"}),e(es,{}),e(Da,{}),e(da,{}),e(Qo,{}),e(qs,{}),e(Ts,{}),e(Js,{}),e(Ks,{}),e(Fs,{}),e(Hs,{}),e(Ys,{}),e(No,{}),e(Zo,{}),e(Yo,{})]}),e(ir,{})]})),hn=wt,La=()=>{const[r,i]=h.exports.useState([]),[n,a]=h.exports.useState(null),[o,s]=h.exports.useState([]),[l,g]=h.exports.useState(!0),[b,C]=h.exports.useState({name:"",description:""}),[y,S]=h.exports.useState({host:"",description:"",country:""}),c=Ce(),{isOpen:m,onOpen:z,onClose:w}=Ve(),{isOpen:U,onOpen:p,onClose:d}=Ve(),Y=async()=>{g(!0);try{const I=await P("/api/xpert/whitelists",{headers:{Authorization:`Bearer ${K()}`}});i(I.whitelists||[])}catch(I){console.error("Failed to load whitelists:",I),c({title:"Error loading whitelists",description:"Failed to load whitelist data",status:"error",duration:5e3,isClosable:!0})}finally{g(!1)}},W=async I=>{try{const oe=await P(`/api/xpert/whitelists/${I}/hosts`,{headers:{Authorization:`Bearer ${K()}`}});s(oe.hosts||[])}catch(oe){console.error("Failed to load whitelist hosts:",oe),c({title:"Error loading hosts",description:"Failed to load whitelist hosts",status:"error",duration:3e3})}};h.exports.useEffect(()=>{Y()},[]);const _=async()=>{if(!b.name){c({title:"Please enter whitelist name",status:"warning",duration:3e3});return}try{await P("/api/xpert/whitelists",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify(b)}),c({title:"Whitelist created",status:"success",duration:3e3}),C({name:"",description:""}),w(),Y()}catch{c({title:"Error creating whitelist",status:"error",duration:3e3})}},R=async()=>{if(!y.host||!n){c({title:"Please enter host and select whitelist",status:"warning",duration:3e3});return}try{await P(`/api/xpert/whitelists/${n.id}/hosts`,{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify(y)}),c({title:"Host added",status:"success",duration:3e3}),S({host:"",description:"",country:""}),d(),W(n.id),Y()}catch{c({title:"Error adding host",status:"error",duration:3e3})}},V=async I=>{try{await P(`/api/xpert/whitelists/${I}`,{method:"DELETE",headers:{Authorization:`Bearer ${K()}`}}),c({title:"Whitelist deleted",status:"success",duration:3e3}),Y()}catch{c({title:"Error deleting whitelist",status:"error",duration:3e3})}},J=async I=>{if(!!n)try{await P(`/api/xpert/whitelists/${n.id}/hosts/${I}`,{method:"DELETE",headers:{Authorization:`Bearer ${K()}`}}),c({title:"Host deleted",status:"success",duration:3e3}),W(n.id),Y()}catch{c({title:"Error deleting host",status:"error",duration:3e3})}};return l?e(F,{children:"Loading..."}):t(He,{children:[e(Ke,{children:t(E,{justify:"space-between",align:"center",children:[e(Oe,{size:"md",children:"IP/Domain Whitelists"}),e(D,{colorScheme:"purple",onClick:z,children:"Create Whitelist"})]})}),t(et,{children:[t(tt,{variant:"simple",children:[e(rt,{children:t(ye,{children:[e(G,{children:"Name"}),e(G,{children:"Description"}),e(G,{children:"Hosts"}),e(G,{children:"Active"}),e(G,{children:"Created"}),e(G,{children:"Actions"})]})}),e(nt,{children:r.map(I=>t(ye,{children:[e(H,{fontWeight:"bold",children:I.name}),e(H,{fontSize:"sm",children:I.description||"-"}),e(H,{children:t(Q,{colorScheme:"blue",children:[I.active_hosts,"/",I.hosts_count]})}),e(H,{children:e(Q,{colorScheme:I.is_active?"green":"red",children:I.is_active?"Active":"Inactive"})}),e(H,{fontSize:"sm",children:new Date(I.created_at).toLocaleDateString()}),e(H,{children:t(E,{children:[e(D,{size:"sm",colorScheme:"blue",onClick:()=>{a(I),W(I.id),p()},children:"View Hosts"}),e(re,{"aria-label":"Delete",icon:e(hn,{}),colorScheme:"red",size:"sm",onClick:()=>V(I.id)})]})})]},I.id))})]}),r.length===0&&e(u,{textAlign:"center",color:"gray.500",py:4,children:"No whitelists created yet. Create a whitelist to filter servers by IP/domain."})]}),t(de,{isOpen:m,onClose:w,children:[e(he,{}),t(ue,{children:[e(pe,{children:"Create IP/Domain Whitelist"}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Name"}),e(ce,{value:b.name,onChange:I=>C({...b,name:I.target.value}),placeholder:"Working Servers"})]}),t(M,{children:[e(j,{children:"Description"}),e(ht,{value:b.description,onChange:I=>C({...b,description:I.target.value}),placeholder:"List of working server IPs and domains",rows:3})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:w,children:"Cancel"}),e(D,{colorScheme:"purple",onClick:_,isLoading:l,children:"Create Whitelist"})]})]})]}),t(de,{isOpen:U,onClose:d,size:"lg",children:[e(he,{}),t(ue,{children:[t(pe,{children:["Add Host to ",n==null?void 0:n.name]}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Host (IP or Domain)"}),e(ce,{value:y.host,onChange:I=>S({...y,host:I.target.value}),placeholder:"1.2.3.4 or server.example.com"})]}),t(M,{children:[e(j,{children:"Description"}),e(ce,{value:y.description,onChange:I=>S({...y,description:I.target.value}),placeholder:"Main server"})]}),t(M,{children:[e(j,{children:"Country"}),e(ce,{value:y.country,onChange:I=>S({...y,country:I.target.value}),placeholder:"US"})]}),n&&o.length>0&&t(F,{children:[e(j,{children:"Current Hosts"}),t(tt,{variant:"simple",size:"sm",children:[e(rt,{children:t(ye,{children:[e(G,{children:"Host"}),e(G,{children:"Description"}),e(G,{children:"Country"}),e(G,{children:"Status"}),e(G,{children:"Actions"})]})}),e(nt,{children:o.map(I=>t(ye,{children:[e(H,{fontFamily:"monospace",children:I.host}),e(H,{fontSize:"sm",children:I.description||"-"}),e(H,{children:I.country||"-"}),e(H,{children:e(Q,{colorScheme:I.is_active?"green":"red",children:I.is_active?"Active":"Inactive"})}),e(H,{children:e(re,{"aria-label":"Delete",icon:e(hn,{}),colorScheme:"red",size:"sm",onClick:()=>J(I.host)})})]},I.host))})]})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:d,children:"Close"}),e(D,{colorScheme:"blue",onClick:R,isLoading:l,children:"Add Host"})]})]})]})]})},un=Er,pn=_t,Aa=An,Ua=Un,Ra=ro,mn=Dn,gn=En,Ma=()=>{var st;const[r,i]=h.exports.useState([]),[n,a]=h.exports.useState(!0),[o,s]=h.exports.useState({raw:"",remarks:"",added_by:"admin"}),[l,g]=h.exports.useState({configs:"",added_by:"admin"}),[b,C]=h.exports.useState(!1),[y,S]=h.exports.useState(null),[c,m]=h.exports.useState(null),[z,w]=h.exports.useState(null),[U,p]=h.exports.useState(!1),[d,Y]=h.exports.useState({}),[W,_]=h.exports.useState([]),[R,V]=h.exports.useState(!1),[J,I]=h.exports.useState(!1),[oe,fe]=h.exports.useState(!1),[B,L]=h.exports.useState(null),x=Ce(),$=Ve(),ae=Ve(),v=Ve(),q=async()=>{a(!0);try{const f=await P("/api/xpert/direct-configs",{headers:{Authorization:`Bearer ${K()}`}});i(f.configs||[])}catch(f){console.error("Failed to load direct configs:",f),x({title:"Error loading direct configs",description:"Failed to load direct configurations",status:"error",duration:5e3,isClosable:!0})}finally{a(!1)}};h.exports.useEffect(()=>{q()},[]);const se=async()=>{if(!o.raw.trim()){x({title:"Please enter a configuration",status:"warning",duration:3e3});return}C(!0);try{console.log("Validating config:",o.raw);const f=await globalThis.fetch("/api/xpert/direct-configs/validate",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({raw:o.raw})}),k=await f.text();let O=null;try{O=k?JSON.parse(k):null}catch{O=null}if(!f.ok){const Z=O&&(O.detail||O.error||O.message)||k||`Server error: ${f.status}`;throw console.error("Validation error:",f.status,Z),new Error(Z)}if(!O)throw new Error("Empty response from server");console.log("Validation result:",O),S(O),O.valid?x({title:"Configuration is valid",description:`${O.protocol}://${O.server}:${O.port}`,status:"success",duration:3e3}):x({title:"Invalid configuration",description:O.error||"Unknown error",status:"error",duration:5e3})}catch(f){console.error("Validation error:",f),x({title:"Validation failed",description:f.message||"Failed to validate configuration",status:"error",duration:5e3})}finally{C(!1)}},Me=async()=>{if(!o.raw.trim()){x({title:"Please enter a configuration",status:"warning",duration:3e3});return}try{const f=await globalThis.fetch("/api/xpert/direct-configs",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify(o)}),k=await f.text();let O=null;try{O=k?JSON.parse(k):null}catch{O=null}if(!f.ok){const Z=O&&(O.detail||O.error||O.message)||k||`Server error: ${f.status}`;throw new Error(Z)}x({title:"Direct config added",description:"Configuration added successfully and synced to Marzban",status:"success",duration:3e3}),s({raw:"",remarks:"",added_by:"admin"}),S(null),$.onClose(),q()}catch(f){x({title:"Error adding config",description:(f==null?void 0:f.message)||"Failed to add configuration",status:"error",duration:3e3})}},We=async()=>{const f=l.configs.split(`
`).map(k=>k.trim()).filter(k=>k.length>0);if(f.length===0){x({title:"Please enter configurations",status:"warning",duration:3e3});return}try{const k=await globalThis.fetch("/api/xpert/direct-configs/batch",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({configs:f,added_by:l.added_by})}),O=await k.text();let Z=null;try{Z=O?JSON.parse(O):null}catch{Z=null}if(!k.ok){const $e=Z&&(Z.detail||Z.error||Z.message)||O||`Server error: ${k.status}`;throw console.error("Batch add error:",k.status,$e),new Error($e)}if(!Z)throw new Error("Empty response from server");console.log("Batch add result:",Z),x({title:"Batch addition complete",description:`${Z.successful_added}/${Z.total_provided} configs added successfully`,status:Z.successful_added>0?"success":"warning",duration:5e3}),g({configs:"",added_by:"admin"}),ae.onClose(),q()}catch(k){console.error("Batch add error:",k),x({title:"Error adding batch configs",description:k.message,status:"error",duration:3e3})}},kt=async f=>{try{await P(`/api/xpert/direct-configs/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${K()}`}}),x({title:"Config deleted",status:"success",duration:3e3}),q()}catch{x({title:"Error deleting config",status:"error",duration:3e3})}},mt=async()=>{if(W.length===0){x({title:"Select configs first",status:"warning",duration:2e3});return}if(!!window.confirm(`Delete ${W.length} selected configs?`))try{I(!0);let k=0,O=0;for(const Z of W)try{await P(`/api/xpert/direct-configs/${Z}`,{method:"DELETE",headers:{Authorization:`Bearer ${K()}`}}),k+=1}catch{O+=1}k>0?x({title:"Configs deleted",description:`${k} deleted${O?`, ${O} failed`:""}`,status:O?"warning":"success",duration:3e3}):x({title:"Error deleting selected configs",status:"error",duration:3e3}),_([]),await q()}catch{x({title:"Error deleting selected configs",status:"error",duration:3e3})}finally{I(!1)}},gt=async f=>{try{await P(`/api/xpert/direct-configs/${f}/toggle`,{method:"PUT",headers:{Authorization:`Bearer ${K()}`}}),q()}catch{x({title:"Error toggling config",status:"error",duration:3e3})}},ft=async f=>{try{await P(`/api/xpert/direct-configs/${f}/sync-to-marzban`,{method:"POST",headers:{Authorization:`Bearer ${K()}`}}),x({title:"Config synced to Marzban",status:"success",duration:3e3})}catch{x({title:"Error syncing to Marzban",status:"error",duration:3e3})}},bt=async()=>{try{fe(!0),await P("/api/xpert/direct-configs/ping-refresh",{method:"POST",headers:{Authorization:`Bearer ${K()}`}}),await q(),x({title:"Ping refreshed",status:"success",duration:2e3})}catch{x({title:"Error refreshing ping",status:"error",duration:3e3})}finally{fe(!1)}},yt=f=>{Y(k=>({...k,[f]:!k[f]}))},N=f=>{m({id:f.id,raw:f.raw,remarks:f.remarks,added_by:f.added_by}),w(null),v.onOpen()},ee=async()=>{var f;if(!((f=c==null?void 0:c.raw)!=null&&f.trim())){x({title:"Please enter a configuration",status:"warning",duration:3e3});return}C(!0);try{const k=await globalThis.fetch("/api/xpert/direct-configs/validate",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({raw:c.raw})}),O=await k.text();let Z=null;try{Z=O?JSON.parse(O):null}catch{Z=null}if(!k.ok){const $e=Z&&(Z.detail||Z.error||Z.message)||O||`Server error: ${k.status}`;throw new Error($e)}if(!Z)throw new Error("Empty response from server");w(Z),Z.valid?x({title:"Configuration is valid",description:`${Z.protocol}://${Z.server}:${Z.port}`,status:"success",duration:3e3}):x({title:"Invalid configuration",description:Z.error||"Unknown error",status:"error",duration:5e3})}catch(k){x({title:"Validation failed",description:k.message||"Failed to validate configuration",status:"error",duration:5e3})}finally{C(!1)}},be=async()=>{if(!!c)try{p(!0);const f=await globalThis.fetch(`/api/xpert/direct-configs/${c.id}`,{method:"PUT",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({raw:c.raw,remarks:c.remarks,added_by:c.added_by})}),k=await f.text();let O=null;try{O=k?JSON.parse(k):null}catch{O=null}if(!f.ok){const Z=O&&(O.detail||O.error||O.message)||k||`Server error: ${f.status}`;throw new Error(Z)}x({title:"Config updated",status:"success",duration:3e3}),v.onClose(),m(null),w(null),q()}catch(f){x({title:"Error updating config",description:(f==null?void 0:f.message)||"Failed to update configuration",status:"error",duration:3e3})}finally{p(!1)}},we=async(f,k)=>{try{await ke(f,k),q()}catch{x({title:"Error moving config",status:"error",duration:3e3})}},ke=async(f,k)=>{await P(`/api/xpert/direct-configs/${f}/move`,{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({direction:k})})},Pe=f=>{_(k=>k.includes(f)?k.filter(O=>O!==f):[...k,f])},zt=()=>{if(W.length===r.length){_([]);return}_(r.map(f=>f.id))},ne=async f=>{if(W.length===0){x({title:"Select configs first",status:"warning",duration:2e3});return}try{V(!0);const k=await globalThis.fetch("/api/xpert/direct-configs/move-batch",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({config_ids:W,direction:f})});if(!k.ok){const O=await k.text();throw new Error(O||`HTTP ${k.status}`)}await q()}catch{x({title:"Error moving selected configs",status:"error",duration:3e3})}finally{V(!1)}},ot=async f=>{if(B===null||B===f){L(null);return}const k=r.findIndex(Z=>Z.id===B),O=r.findIndex(Z=>Z.id===f);if(k===-1||O===-1){L(null);return}try{if(V(!0),k<O)for(let Z=k;Z<O;Z+=1)await ke(B,"down");else if(k>O)for(let Z=k;Z>O;Z-=1)await ke(B,"up");await q()}catch{x({title:"Error reordering config",status:"error",duration:3e3})}finally{V(!1),L(null)}};return n?e(te,{justifyContent:"center",p:8,children:e(Fe,{size:"xl"})}):t(He,{mt:"4",children:[e(Ke,{children:t(E,{justify:"space-between",align:"center",children:[t(Oe,{size:"md",children:["Direct Configurations (",r.filter(f=>f.is_active).length," active)",e(Q,{ml:2,colorScheme:"green",children:"Bypass Whitelist"})]}),t(E,{wrap:"wrap",spacing:2,children:[e(D,{leftIcon:e(un,{}),colorScheme:"green",onClick:$.onOpen,children:"Add Single"}),e(D,{leftIcon:e(un,{}),colorScheme:"blue",onClick:ae.onOpen,children:"Add Batch"}),e(D,{leftIcon:e(pn,{}),variant:"outline",onClick:bt,isLoading:oe,children:"Ping Check"}),e(D,{leftIcon:e(mn,{}),variant:"outline",onClick:()=>ne("up"),isDisabled:W.length===0||R,isLoading:R,children:"Move Selected Up"}),e(D,{leftIcon:e(gn,{}),variant:"outline",onClick:()=>ne("down"),isDisabled:W.length===0||R,isLoading:R,children:"Move Selected Down"}),e(D,{leftIcon:e(wt,{}),colorScheme:"red",variant:"outline",onClick:mt,isDisabled:W.length===0||J,isLoading:J,children:"Delete Selected"}),t(u,{fontSize:"sm",color:"gray.500",children:["Selected: ",W.length]})]})]})}),t(et,{children:[t(tt,{variant:"simple",size:"sm",children:[e(rt,{children:t(ye,{children:[e(G,{children:e(ct,{isChecked:r.length>0&&W.length===r.length,isIndeterminate:W.length>0&&W.length<r.length,onChange:zt})}),e(G,{children:"Status"}),e(G,{children:"Protocol"}),e(G,{children:"Server"}),e(G,{children:"Port"}),e(G,{children:"Remarks"}),e(G,{children:"Ping"}),e(G,{children:"Added"}),e(G,{children:"Actions"})]})}),e(nt,{children:r.map((f,k)=>t(ye,{draggable:!0,onDragStart:()=>L(f.id),onDragOver:O=>{O.preventDefault()},onDrop:()=>ot(f.id),onDragEnd:()=>L(null),cursor:"move",bg:B===f.id?"blue.50":void 0,children:[e(H,{children:e(ct,{isChecked:W.includes(f.id),onChange:()=>Pe(f.id)})}),e(H,{children:e(vt,{isChecked:f.is_active,onChange:()=>gt(f.id),size:"sm"})}),e(H,{children:e(Q,{colorScheme:"blue",children:f.protocol.toUpperCase()})}),e(H,{fontSize:"sm",children:f.server}),e(H,{children:f.port}),e(H,{fontSize:"sm",maxW:"200px",isTruncated:!0,children:f.remarks}),t(H,{children:[f.ping_ms.toFixed(0)," ms"]}),e(H,{fontSize:"sm",children:new Date(f.added_at).toLocaleDateString()}),e(H,{children:t(E,{spacing:1,children:[e(re,{"aria-label":"Move Up",icon:e(mn,{}),size:"sm",variant:"outline",onClick:()=>we(f.id,"up"),isDisabled:k===0}),e(re,{"aria-label":"Move Down",icon:e(gn,{}),size:"sm",variant:"outline",onClick:()=>we(f.id,"down"),isDisabled:k===r.length-1}),e(re,{"aria-label":"Edit",icon:e(Ra,{}),size:"sm",variant:"outline",onClick:()=>N(f)}),e(re,{"aria-label":d[f.id]?"Hide":"Show",icon:d[f.id]?e(Ua,{}):e(Aa,{}),size:"sm",variant:"outline",onClick:()=>yt(f.id)}),e(re,{"aria-label":"Sync to Marzban",icon:e(pn,{}),size:"sm",colorScheme:"purple",variant:"outline",onClick:()=>ft(f.id)}),e(re,{"aria-label":"Delete",icon:e(wt,{}),colorScheme:"red",size:"sm",onClick:()=>kt(f.id)})]})})]},f.id))})]}),r.length===0&&e(u,{textAlign:"center",color:"gray.500",py:8,children:"No direct configurations found. Add configs to bypass whitelist filtering."}),Object.keys(d).some(f=>d[parseInt(f)])&&t(F,{mt:4,children:[e(to,{mb:4}),e(Oe,{size:"sm",mb:2,children:"Raw Configurations"}),e(te,{spacing:2,align:"stretch",children:r.filter(f=>d[f.id]).map(f=>t(F,{p:3,bg:"gray.50",borderRadius:"md",children:[t(u,{fontSize:"xs",color:"gray.600",mb:1,children:[f.protocol.toUpperCase(),"://",f.server,":",f.port]}),e(u,{fontSize:"xs",fontFamily:"mono",wordBreak:"break-all",children:f.raw})]},f.id))})]})]}),t(de,{isOpen:$.isOpen,onClose:$.onClose,size:"lg",children:[e(he,{}),t(ue,{children:[e(pe,{children:"Add Direct Configuration"}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Configuration"}),e(ht,{value:o.raw,onChange:f=>s({...o,raw:f.target.value}),placeholder:"vless://uuid@server:port?encryption=none&security=tls&type=ws&host=example.com&path=/#remarks",rows:4,fontFamily:"mono",fontSize:"sm"}),e(D,{mt:2,size:"sm",colorScheme:"blue",variant:"outline",onClick:se,isLoading:b,w:"full",children:b?"Validating...":"Validate Config"})]}),y&&t(it,{status:y.valid?"success":"error",children:[e(pt,{}),t(F,{children:[e(u,{fontWeight:"bold",children:y.valid?"Valid Configuration":"Invalid Configuration"}),y.valid?t(u,{fontSize:"sm",children:[y.protocol,"://",y.server,":",y.port]}):e(u,{fontSize:"sm",children:y.error})]})]}),t(M,{children:[e(j,{children:"Remarks"}),e(ce,{value:o.remarks,onChange:f=>s({...o,remarks:f.target.value}),placeholder:"Optional description"})]}),t(M,{children:[e(j,{children:"Added By"}),e(ce,{value:o.added_by,onChange:f=>s({...o,added_by:f.target.value}),placeholder:"admin"})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:$.onClose,children:"Cancel"}),e(D,{colorScheme:"green",onClick:Me,isDisabled:!(y!=null&&y.valid),children:"Add Config"})]})]})]}),t(de,{isOpen:v.isOpen,onClose:v.onClose,size:"lg",children:[e(he,{}),t(ue,{children:[e(pe,{children:"Edit Direct Configuration"}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Configuration"}),e(ht,{value:(c==null?void 0:c.raw)||"",onChange:f=>m(k=>k&&{...k,raw:f.target.value}),placeholder:"vless://uuid@server:port?encryption=none&security=tls&type=ws&host=example.com&path=/#remarks",rows:4,fontFamily:"mono",fontSize:"sm"}),e(D,{mt:2,size:"sm",colorScheme:"blue",variant:"outline",onClick:ee,isLoading:b,w:"full",children:b?"Validating...":"Validate Config"})]}),z&&t(it,{status:z.valid?"success":"error",children:[e(pt,{}),t(F,{children:[e(u,{fontWeight:"bold",children:z.valid?"Valid Configuration":"Invalid Configuration"}),z.valid?t(u,{fontSize:"sm",children:[z.protocol,"://",z.server,":",z.port]}):e(u,{fontSize:"sm",children:z.error})]})]}),t(M,{children:[e(j,{children:"Remarks"}),e(ce,{value:(c==null?void 0:c.remarks)||"",onChange:f=>m(k=>k&&{...k,remarks:f.target.value}),placeholder:"Optional description"})]}),t(M,{children:[e(j,{children:"Added By"}),e(ce,{value:(c==null?void 0:c.added_by)||"",onChange:f=>m(k=>k&&{...k,added_by:f.target.value}),placeholder:"admin"})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:v.onClose,children:"Cancel"}),e(D,{colorScheme:"green",onClick:be,isLoading:U,isDisabled:!((st=c==null?void 0:c.raw)!=null&&st.trim()),children:"Save Changes"})]})]})]}),t(de,{isOpen:ae.isOpen,onClose:ae.onClose,size:"lg",children:[e(he,{}),t(ue,{children:[e(pe,{children:"Add Batch Configurations"}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Configurations (one per line)"}),e(ht,{value:l.configs,onChange:f=>g({...l,configs:f.target.value}),placeholder:`vless://uuid1@server1:port?params#remarks1
vless://uuid2@server2:port?params#remarks2
vmess://encoded-config`,rows:10,fontFamily:"mono",fontSize:"sm"})]}),t(M,{children:[e(j,{children:"Added By"}),e(ce,{value:l.added_by,onChange:f=>g({...l,added_by:f.target.value}),placeholder:"admin"})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:ae.onClose,children:"Cancel"}),e(D,{colorScheme:"blue",onClick:We,children:"Add Batch"})]})]})]})]})};T(Er,{baseStyle:{w:4,h:4}});const fn=T(_t,{baseStyle:{w:4,h:4}}),Pa=()=>{const[r,i]=h.exports.useState([]),[n,a]=h.exports.useState(null),[o,s]=h.exports.useState([]),[l,g]=h.exports.useState(!0),[b,C]=h.exports.useState(!1),[y,S]=h.exports.useState({name:"",url:"",priority:1}),[c,m]=h.exports.useState(!1),[z,w]=h.exports.useState(""),U=Ce(),{isOpen:p,onOpen:d,onClose:Y}=Ve(),W=Ve(),_=async()=>{g(!0);try{const[x,$,ae]=await Promise.all([P("/api/xpert/sources",{headers:{Authorization:`Bearer ${K()}`}}),P("/api/xpert/stats",{headers:{Authorization:`Bearer ${K()}`}}),P("/api/xpert/configs",{headers:{Authorization:`Bearer ${K()}`}})]);i(x),a($),s(ae)}catch(x){console.error("Failed to load Xpert data:",x),U({title:"Error loading data",description:"Failed to load Xpert Panel data",status:"error",duration:5e3,isClosable:!0})}finally{g(!1)}};h.exports.useEffect(()=>{_()},[]);const R=async()=>{if(!y.name||!y.url){U({title:"Please fill all fields",status:"warning",duration:3e3});return}try{await P("/api/xpert/sources",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify(y)}),U({title:"Source added",status:"success",duration:3e3}),S({name:"",url:"",priority:1}),Y(),_()}catch{U({title:"Error adding source",status:"error",duration:3e3})}},V=async()=>{if(!y.url){U({title:"Please enter URL to test",status:"warning",duration:3e3});return}m(!0);try{const $=await(await P("/api/xpert/test-url",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({url:y.url})})).json();$.success?U({title:"URL Test Successful",description:`Found ${$.config_count} configs`,status:"success",duration:5e3}):U({title:"URL Test Failed",description:$.error||"Unknown error",status:"error",duration:5e3})}catch{U({title:"Error testing URL",description:"Failed to connect to the URL",status:"error",duration:3e3})}finally{m(!1)}},J=async x=>{try{await P(`/api/xpert/sources/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${K()}`}}),U({title:"Source deleted",status:"success",duration:3e3}),_()}catch{U({title:"Error deleting source",status:"error",duration:3e3})}},I=async x=>{try{await P(`/api/xpert/sources/${x}/toggle`,{method:"POST",headers:{Authorization:`Bearer ${K()}`}}),_()}catch{U({title:"Error toggling source",status:"error",duration:3e3})}},oe=async()=>{C(!0);try{const x=await P("/api/xpert/update",{method:"POST",headers:{Authorization:`Bearer ${K()}`}});U({title:"Update complete",description:`${x.active_configs}/${x.total_configs} active configs`,status:"success",duration:5e3}),_()}catch{U({title:"Error updating",status:"error",duration:3e3})}finally{C(!1)}},fe=async()=>{C(!0);try{const $=await(await P("/api/xpert/sync-marzban",{method:"POST",headers:{Authorization:`Bearer ${K()}`}})).json();U({title:"Marzban sync complete",description:`${$.total_synced||0} configs synced to Marzban`,status:"success",duration:5e3}),_()}catch{U({title:"Error syncing to Marzban",status:"error",duration:3e3})}finally{C(!1)}},B=()=>{w(((n==null?void 0:n.target_ips)||[]).join(", ")),W.onOpen()},L=async()=>{try{const x=z.split(/[,\n]/).map($=>$.trim()).filter($=>$.length>0);if(x.length===0)throw new Error("Target IP list cannot be empty");await P("/api/xpert/target-ips",{method:"PUT",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({target_ips:x})}),U({title:"Target IPs updated",status:"success",duration:3e3}),W.onClose(),await _()}catch(x){U({title:"Error updating Target IPs",description:(x==null?void 0:x.message)||"Failed to update Target IPs",status:"error",duration:4e3})}};return l?e(te,{justifyContent:"center",minH:"100vh",children:e(Fe,{size:"xl"})}):t(te,{justifyContent:"space-between",minH:"100vh",p:6,rowGap:4,children:[t(F,{w:"full",children:[e(Ur,{}),n&&t(He,{mt:"4",children:[e(Ke,{children:e(Oe,{size:"md",children:"Xpert Panel Statistics"})}),t(et,{children:[t(ut,{gap:4,flexWrap:"wrap",children:[t(De,{children:[e(Ee,{children:"Total Sources"}),e(Te,{children:n.total_sources})]}),t(De,{children:[e(Ee,{children:"Enabled Sources"}),e(Te,{children:n.enabled_sources})]}),t(De,{children:[e(Ee,{children:"Total Configs"}),e(Te,{children:n.total_configs})]}),t(De,{children:[e(Ee,{children:"Active Configs"}),e(Te,{color:"green.500",children:n.active_configs})]}),t(De,{children:[e(Ee,{children:"Avg Ping"}),t(Te,{children:[n.avg_ping.toFixed(0)," ms"]})]})]}),t(F,{mt:4,children:[t(E,{spacing:3,align:"center",mb:1,children:[t(u,{fontSize:"sm",color:"gray.500",children:["Target IPs: ",n.target_ips.join(", ")]}),e(D,{size:"xs",variant:"outline",onClick:B,children:"Edit"})]}),t(u,{fontSize:"sm",color:"gray.500",children:["Domain: ",n.domain]})]})]})]}),e(La,{}),e(Ma,{}),t(He,{mt:"4",children:[e(Ke,{children:t(ut,{justify:"space-between",align:"center",children:[e(Oe,{size:"md",children:"Subscription Sources"}),t(E,{children:[e(D,{leftIcon:e(fn,{}),colorScheme:"blue",onClick:oe,isLoading:b,children:"Update Now"}),e(D,{leftIcon:e(fn,{}),colorScheme:"purple",onClick:fe,isLoading:b,children:"Sync to Marzban"}),e(D,{colorScheme:"green",onClick:d,children:"Add Source"})]})]})}),e(et,{children:t(tt,{variant:"simple",children:[e(rt,{children:t(ye,{children:[e(G,{children:"Name"}),e(G,{children:"URL"}),e(G,{children:"Configs"}),e(G,{children:"Success Rate"}),e(G,{children:"Last Fetched"}),e(G,{children:"Enabled"}),e(G,{children:"Actions"})]})}),e(nt,{children:r.map(x=>t(ye,{children:[e(H,{children:x.name}),e(H,{fontSize:"sm",maxW:"300px",isTruncated:!0,children:x.url}),e(H,{children:x.config_count}),t(H,{children:[x.success_rate.toFixed(1),"%"]}),e(H,{fontSize:"sm",children:x.last_fetched?new Date(x.last_fetched).toLocaleString():"Never"}),e(H,{children:e(vt,{isChecked:x.enabled,onChange:()=>I(x.id)})}),e(H,{children:e(re,{"aria-label":"Delete",icon:e(wt,{}),colorScheme:"red",size:"sm",onClick:()=>J(x.id)})})]},x.id))})]})})]}),t(He,{mt:"4",children:[e(Ke,{children:t(Oe,{size:"md",children:["Active Configurations (",o.filter(x=>x.is_active).length,")"]})}),t(et,{children:[t(tt,{variant:"simple",size:"sm",children:[e(rt,{children:t(ye,{children:[e(G,{children:"Protocol"}),e(G,{children:"Server"}),e(G,{children:"Port"}),e(G,{children:"Remarks"}),e(G,{children:"Ping"}),e(G,{children:"Loss"}),e(G,{children:"Status"})]})}),e(nt,{children:o.filter(x=>x.is_active).slice(0,20).map(x=>t(ye,{children:[e(H,{children:x.protocol.toUpperCase()}),e(H,{fontSize:"sm",children:x.server}),e(H,{children:x.port}),e(H,{fontSize:"sm",children:x.remarks}),t(H,{children:[x.ping_ms.toFixed(0)," ms"]}),t(H,{children:[x.packet_loss.toFixed(0),"%"]}),e(H,{children:e(u,{color:"green.500",fontWeight:"bold",children:"Active"})})]},x.id))})]}),o.filter(x=>x.is_active).length>20&&t(u,{mt:2,fontSize:"sm",color:"gray.500",children:["Showing 20 of ",o.filter(x=>x.is_active).length," active configs"]})]})]})]}),e(ir,{}),t(de,{isOpen:p,onClose:Y,children:[e(he,{}),t(ue,{children:[e(pe,{children:"Add Subscription Source"}),e(me,{}),e(ge,{children:t(je,{spacing:4,children:[t(M,{isRequired:!0,children:[e(j,{children:"Name"}),e(ce,{value:y.name,onChange:x=>S({...y,name:x.target.value}),placeholder:"My Subscription"})]}),t(M,{isRequired:!0,children:[e(j,{children:"URL"}),e(ce,{value:y.url,onChange:x=>S({...y,url:x.target.value}),placeholder:"https://example.com/subscription"}),e(D,{mt:2,size:"sm",colorScheme:"blue",variant:"outline",onClick:V,isLoading:c,w:"full",children:c?"Testing...":"Test URL"})]}),t(M,{children:[e(j,{children:"Priority"}),e(ce,{type:"number",value:y.priority,onChange:x=>S({...y,priority:parseInt(x.target.value)||1}),placeholder:"1"})]})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:Y,children:"Cancel"}),e(D,{colorScheme:"blue",onClick:R,isLoading:l,children:"Add Source"})]})]})]}),t(de,{isOpen:W.isOpen,onClose:W.onClose,size:"lg",children:[e(he,{}),t(ue,{children:[e(pe,{children:"Edit Target IPs"}),e(me,{}),e(ge,{children:t(M,{children:[e(j,{children:"Target IPs (comma or new line)"}),e(ht,{value:z,onChange:x=>w(x.target.value),rows:6,placeholder:"93.171.220.198, 185.69.186.175"})]})}),t(xe,{children:[e(D,{variant:"ghost",onClick:W.onClose,children:"Cancel"}),e(D,{colorScheme:"blue",onClick:L,children:"Save"})]})]})]})]})},Na=()=>{const[r,i]=h.exports.useState(null),[n,a]=h.exports.useState(null),[o,s]=h.exports.useState([]),[l,g]=h.exports.useState(!0),[b,C]=h.exports.useState(!1),[y,S]=h.exports.useState(""),[c,m]=h.exports.useState(30),[z,w]=h.exports.useState(!0),{isOpen:U,onOpen:p,onClose:d}=Ve(),{isOpen:Y,onOpen:W,onClose:_}=Ve(),R=Ce(),V=async()=>{g(!0);try{const[L,x]=await Promise.all([P("/api/xpert/marzban-traffic-stats",{headers:{Authorization:`Bearer ${K()}`}}),P("/api/xpert/traffic-stats/database/info",{headers:{Authorization:`Bearer ${K()}`}})]);i(L.users_traffic),a(x)}catch(L){console.error("Failed to load traffic data:",L),R({title:"Error loading traffic data",description:"Failed to load traffic statistics",status:"error",duration:5e3})}finally{g(!1)}},J=async()=>{if(!!y)try{const L=await P(`/api/xpert/traffic-stats/${y}?days=${c}`,{headers:{Authorization:`Bearer ${K()}`}});s([L])}catch(L){console.error("Failed to load user stats:",L),R({title:"Error loading user stats",description:"Failed to load user traffic statistics",status:"error",duration:5e3})}},I=async()=>{C(!0);try{await P("/api/xpert/traffic-stats/cleanup",{method:"POST",headers:{Authorization:`Bearer ${K()}`},body:JSON.stringify({days:0})}),R({title:"Traffic reset successful",description:"All traffic statistics have been cleared",status:"success",duration:3e3}),d(),await V()}catch(L){console.error("Failed to reset traffic:",L),R({title:"Error resetting traffic",description:"Failed to reset traffic statistics",status:"error",duration:5e3})}finally{C(!1)}},oe=async()=>{C(!0);try{const L=await P("/api/xpert/traffic-stats/cleanup",{method:"POST",headers:{Authorization:`Bearer ${K()}`,"Content-Type":"application/json"},body:JSON.stringify({days:90})});R({title:"Cleanup successful",description:`Deleted ${L.deleted_rows} old traffic records`,status:"success",duration:3e3}),_(),await V()}catch(L){console.error("Failed to cleanup traffic:",L),R({title:"Error cleaning up traffic",description:"Failed to cleanup old traffic records",status:"error",duration:5e3})}finally{C(!1)}},fe=async()=>{C(!0),await V(),C(!1)};h.exports.useEffect(()=>{V()},[]),h.exports.useEffect(()=>{y&&J()},[y,c]);const B=L=>L<1?`${(L*1024).toFixed(0)} MB`:`${L.toFixed(2)} GB`;return l?e(ut,{justify:"center",align:"center",height:"200px",children:e(Fe,{size:"xl"})}):t(F,{p:6,children:[t(te,{spacing:6,align:"stretch",children:[t(ut,{justify:"space-between",align:"center",children:[t(Oe,{size:"lg",display:"flex",alignItems:"center",gap:2,children:[e(kr,{width:24,height:24}),"Traffic Monitoring"]}),t(E,{children:[e(D,{leftIcon:e(_t,{}),onClick:fe,isLoading:b,variant:"outline",children:"Refresh"}),e(D,{leftIcon:e(wt,{}),onClick:p,colorScheme:"red",variant:"outline",children:"Reset All"})]})]}),!(r!=null&&r.external_servers)&&t(it,{status:"warning",children:[e(pt,{}),e(qr,{children:"Traffic Tracking Disabled"}),e(Kt,{children:"External traffic tracking is not enabled. Enable it in configuration to monitor external VPN servers."})]}),t(He,{children:[e(Ke,{children:e(Oe,{size:"md",children:"Global Statistics"})}),e(et,{children:e(je,{spacing:4,children:r&&t(Yt,{templateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:4,children:[t(De,{children:[t(Ee,{display:"flex",alignItems:"center",gap:2,children:[e(no,{width:16,height:16}),"Total Users"]}),e(Te,{children:r.total_users})]}),t(De,{children:[t(Ee,{display:"flex",alignItems:"center",gap:2,children:[e(io,{width:16,height:16}),"Total Servers"]}),e(Te,{children:r.total_servers})]}),t(De,{children:[e(Ee,{children:"Traffic Used"}),e(Te,{children:B(r.total_gb_used)})]}),t(De,{children:[e(Ee,{children:"Total Connections"}),e(Te,{children:r.total_connections})]})]})})})]}),n&&t(He,{children:[e(Ke,{children:e(Oe,{size:"md",children:"Database Information"})}),e(et,{children:t(je,{spacing:4,children:[t(Yt,{templateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:4,children:[t(De,{children:[e(Ee,{children:"Total Records"}),e(Te,{children:n.total_records.toLocaleString()})]}),t(De,{children:[e(Ee,{children:"Unique Users"}),e(Te,{children:n.unique_users})]}),t(De,{children:[e(Ee,{children:"Unique Servers"}),e(Te,{children:n.unique_servers})]}),t(De,{children:[e(Ee,{children:"Database Size"}),t(Te,{children:[n.database_size_mb.toFixed(2)," MB"]})]})]}),t(ut,{justify:"space-between",align:"center",mt:4,children:[t(u,{fontSize:"sm",color:"gray.600",children:["Retention: ",n.retention_days===0?"Infinite":`${n.retention_days} days`]}),e(D,{leftIcon:e(wt,{}),onClick:W,size:"sm",variant:"outline",children:"Cleanup Old Data"})]})]})})]}),t(He,{children:[e(Ke,{children:e(Oe,{size:"md",children:"User Statistics"})}),e(et,{children:t(je,{spacing:4,children:[t(E,{spacing:4,children:[t(M,{children:[e(j,{children:"User Token"}),e(ce,{placeholder:"Enter user token...",value:y,onChange:L=>S(L.target.value)})]}),t(M,{children:[e(j,{children:"Days"}),e(ce,{type:"number",value:c,onChange:L=>m(parseInt(L.target.value)||30),min:"1",max:"365"})]})]}),o.length>0&&t(F,{children:[t(u,{fontWeight:"bold",mb:2,children:[y," - Last ",c," days"]}),t(tt,{variant:"simple",children:[e(rt,{children:t(ye,{children:[e(G,{children:"Server"}),e(G,{children:"Protocol"}),e(G,{children:"Traffic"}),e(G,{children:"Connections"}),e(G,{children:"Last Used"})]})}),e(nt,{children:o[0].servers.map((L,x)=>t(ye,{children:[e(H,{children:t(u,{fontWeight:"medium",children:[L.server,":",L.port]})}),e(H,{children:e(Q,{colorScheme:"blue",children:L.protocol})}),e(H,{children:B(L.total_gb)}),e(H,{children:L.connections}),e(H,{children:e(u,{fontSize:"sm",color:"gray.600",children:new Date(L.last_used).toLocaleString()})})]},x))})]})]})]})})]}),t(He,{children:[e(Ke,{children:e(Oe,{size:"md",children:"Configuration"})}),e(et,{children:t(je,{spacing:4,children:[t(M,{display:"flex",alignItems:"center",children:[e(j,{mb:"0",children:"Enable Traffic Tracking"}),e(vt,{isChecked:z,onChange:L=>w(L.target.checked)})]}),e(u,{fontSize:"sm",color:"gray.600",children:"When enabled, external VPN server traffic will be monitored and included in statistics."})]})})]})]}),t(de,{isOpen:U,onClose:d,children:[e(he,{}),t(ue,{children:[e(pe,{children:"Reset All Traffic Statistics"}),e(me,{}),e(ge,{children:t(it,{status:"warning",children:[e(pt,{}),e(qr,{children:"Warning"}),e(Kt,{children:"This will permanently delete ALL traffic statistics. This action cannot be undone. All user traffic data, server statistics, and usage history will be lost."})]})}),t(xe,{children:[e(D,{variant:"outline",onClick:d,children:"Cancel"}),e(D,{colorScheme:"red",onClick:I,isLoading:b,ml:3,children:"Reset All Traffic"})]})]})]}),t(de,{isOpen:Y,onClose:_,children:[e(he,{}),t(ue,{children:[e(pe,{children:"Cleanup Old Traffic Data"}),e(me,{}),e(ge,{children:e(u,{children:"This will delete traffic records older than 90 days to free up database space. Recent traffic data will be preserved."})}),t(xe,{children:[e(D,{variant:"outline",onClick:_,children:"Cancel"}),e(D,{colorScheme:"orange",onClick:oe,isLoading:b,ml:3,children:"Cleanup Old Data"})]})]})]})]})},Oa=()=>t(ze,{children:[e(Ur,{}),e(Na,{}),e(ir,{})]}),Fa=r=>h.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},h.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),Wa=A.object({username:A.string().min(1,"login.fieldRequired"),password:A.string().min(1,"login.fieldRequired")}),$a=T(Fa,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),Ba=T(oo,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Zt=()=>{var S,c;const[r,i]=h.exports.useState(""),[n,a]=h.exports.useState(!1),o=so(),{t:s}=ie();let l=ao();const{register:g,formState:{errors:b},handleSubmit:C}=At({resolver:Ht(Wa)});h.exports.useEffect(()=>{vo(),l.pathname!=="/login"&&o("/login",{replace:!0})},[]);const y=m=>{i("");const z=new FormData;z.append("username",m.username),z.append("password",m.password),z.append("grant_type","password"),a(!0),P("/api/admin/token",{method:"post",body:z}).then(({access_token:w})=>{wo(w),setTimeout(()=>{o("/")},100)}).catch(w=>{var U,p;console.error("Login failed:",w),i(((p=(U=w.response)==null?void 0:U._data)==null?void 0:p.detail)||"Login failed")}).finally(()=>{a(!1)})};return t(te,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[t(F,{w:"full",children:[e(E,{justifyContent:"end",w:"full",children:e(Yn,{})}),e(E,{w:"full",justifyContent:"center",alignItems:"center",children:t(F,{w:"full",maxW:"340px",mt:"6",children:[t(te,{alignItems:"center",w:"full",children:[e($a,{}),e(u,{fontSize:"2xl",fontWeight:"semibold",children:s("login.loginYourAccount")}),e(u,{color:"gray.600",_dark:{color:"gray.400"},children:s("login.welcomeBack")})]}),e(F,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:C(y),children:t(te,{mt:4,rowGap:2,children:[e(M,{children:e(dt,{w:"full",placeholder:s("username"),...g("username"),error:s((S=b==null?void 0:b.username)==null?void 0:S.message)})}),e(M,{children:e(dt,{w:"full",type:"password",placeholder:s("password"),...g("password"),error:s((c=b==null?void 0:b.password)==null?void 0:c.message)})}),r&&t(it,{status:"error",rounded:"md",children:[e(pt,{}),e(Kt,{children:r})]}),t(D,{isLoading:n,type:"submit",w:"full",colorScheme:"primary",children:[e(Ba,{marginRight:1}),s("login")]})]})})})]})})]}),e(ir,{})]})},vr=async()=>{try{const r=K();if(!r)throw console.log("Router: No token found, redirecting to login"),new Error("No token found");console.log("Router: Validating admin token...");const i=await P("/admin",{headers:{Authorization:`Bearer ${r}`}});return console.log("Router: Admin validation successful"),i}catch(r){throw console.error("Router: Admin loader failed:",r),r}},Ha=async()=>{const r=await vr();return r!=null&&r.is_sudo?r:co("/")},ja=lo([{path:"/",element:e(Ta,{}),errorElement:e(Zt,{}),loader:vr},{path:"/xpert/",element:e(Pa,{}),errorElement:e(Zt,{}),loader:Ha},{path:"/traffic/",element:e(Oa,{}),errorElement:e(Zt,{}),loader:vr},{path:"/login/",element:e(Zt,{})}]);function Va(){return e("main",{className:"p-8",children:e(ho,{router:ja})})}const Ga=window.fetch.bind(window);window.fetch=async(r,i)=>{const n=((i==null?void 0:i.method)||"GET").toUpperCase(),a=typeof r=="string"?r:r.toString(),o=new Headers((i==null?void 0:i.headers)||{});o.has("authorization")&&o.set("authorization","REDACTED"),o.has("Authorization")&&o.set("Authorization","REDACTED"),console.log("[FETCH]",n,a,{...i,headers:Object.fromEntries(o.entries())});try{const s=await Ga(r,i);return console.log("[FETCH OK]",n,a,s.status),s}catch(s){throw console.error("[FETCH ERR]",n,a,s),s}};le.extend(uo);le.extend(po);le.extend(mo);le.extend(go);le.extend(fo);jn(bo.get()||"light");yo.createRoot(document.getElementById("root")).render(e(yr.StrictMode,{children:e(xo,{theme:Co,children:e(So,{client:Sr,children:e(Va,{})})})}));
